<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>深入理解 Java 乱码问题 | Mflyyou</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/mflyyou/favicon.ico">
    <meta name="description" content="张攀钦的笔记">
    <meta name="theme-color" content="#3eaf7c">
    
    <link rel="preload" href="/mflyyou/assets/css/0.styles.69128c36.css" as="style"><link rel="preload" href="/mflyyou/assets/js/app.e7c34c1e.js" as="script"><link rel="preload" href="/mflyyou/assets/js/4.527dd67c.js" as="script"><link rel="preload" href="/mflyyou/assets/js/2.40ff7517.js" as="script"><link rel="preload" href="/mflyyou/assets/js/72.2e14eb54.js" as="script"><link rel="preload" href="/mflyyou/assets/js/13.5f8596a1.js" as="script"><link rel="prefetch" href="/mflyyou/assets/js/10.e86c6c73.js"><link rel="prefetch" href="/mflyyou/assets/js/100.9ba4221b.js"><link rel="prefetch" href="/mflyyou/assets/js/101.01e93d9e.js"><link rel="prefetch" href="/mflyyou/assets/js/102.ffa032d0.js"><link rel="prefetch" href="/mflyyou/assets/js/103.2a87ff24.js"><link rel="prefetch" href="/mflyyou/assets/js/104.1ec6fa83.js"><link rel="prefetch" href="/mflyyou/assets/js/105.4573f16a.js"><link rel="prefetch" href="/mflyyou/assets/js/106.fbaeedbc.js"><link rel="prefetch" href="/mflyyou/assets/js/107.fd860e32.js"><link rel="prefetch" href="/mflyyou/assets/js/108.06d8d7ec.js"><link rel="prefetch" href="/mflyyou/assets/js/109.84146d88.js"><link rel="prefetch" href="/mflyyou/assets/js/11.4a6286e0.js"><link rel="prefetch" href="/mflyyou/assets/js/110.87dacd75.js"><link rel="prefetch" href="/mflyyou/assets/js/111.712c964e.js"><link rel="prefetch" href="/mflyyou/assets/js/12.436a56d6.js"><link rel="prefetch" href="/mflyyou/assets/js/14.79a24b30.js"><link rel="prefetch" href="/mflyyou/assets/js/15.4831c6e8.js"><link rel="prefetch" href="/mflyyou/assets/js/16.15dd012d.js"><link rel="prefetch" href="/mflyyou/assets/js/17.5caf6777.js"><link rel="prefetch" href="/mflyyou/assets/js/18.e114ea09.js"><link rel="prefetch" href="/mflyyou/assets/js/19.30d7fbf2.js"><link rel="prefetch" href="/mflyyou/assets/js/20.6e5f7e5d.js"><link rel="prefetch" href="/mflyyou/assets/js/21.60bf2ff6.js"><link rel="prefetch" href="/mflyyou/assets/js/22.111044cd.js"><link rel="prefetch" href="/mflyyou/assets/js/23.61ff4b4a.js"><link rel="prefetch" href="/mflyyou/assets/js/24.fcb3d2d9.js"><link rel="prefetch" href="/mflyyou/assets/js/25.ef1851a7.js"><link rel="prefetch" href="/mflyyou/assets/js/26.e3cadf96.js"><link rel="prefetch" href="/mflyyou/assets/js/27.28246669.js"><link rel="prefetch" href="/mflyyou/assets/js/28.a749a29d.js"><link rel="prefetch" href="/mflyyou/assets/js/29.3afd32f8.js"><link rel="prefetch" href="/mflyyou/assets/js/3.9aaa48c6.js"><link rel="prefetch" href="/mflyyou/assets/js/30.47874b53.js"><link rel="prefetch" href="/mflyyou/assets/js/31.2bac6e3e.js"><link rel="prefetch" href="/mflyyou/assets/js/32.45719415.js"><link rel="prefetch" href="/mflyyou/assets/js/33.67a3584a.js"><link rel="prefetch" href="/mflyyou/assets/js/34.40132ce2.js"><link rel="prefetch" href="/mflyyou/assets/js/35.fbf599c1.js"><link rel="prefetch" href="/mflyyou/assets/js/36.2b1418da.js"><link rel="prefetch" href="/mflyyou/assets/js/37.89871563.js"><link rel="prefetch" href="/mflyyou/assets/js/38.4f34dca0.js"><link rel="prefetch" href="/mflyyou/assets/js/39.fe4d8235.js"><link rel="prefetch" href="/mflyyou/assets/js/40.8a4e265c.js"><link rel="prefetch" href="/mflyyou/assets/js/41.ecda4f10.js"><link rel="prefetch" href="/mflyyou/assets/js/42.76eabfb7.js"><link rel="prefetch" href="/mflyyou/assets/js/43.2d9f58f4.js"><link rel="prefetch" href="/mflyyou/assets/js/44.11f3ceab.js"><link rel="prefetch" href="/mflyyou/assets/js/45.46a220e7.js"><link rel="prefetch" href="/mflyyou/assets/js/46.63b9ccf0.js"><link rel="prefetch" href="/mflyyou/assets/js/47.de93721c.js"><link rel="prefetch" href="/mflyyou/assets/js/48.7536d656.js"><link rel="prefetch" href="/mflyyou/assets/js/49.118bb9e6.js"><link rel="prefetch" href="/mflyyou/assets/js/5.5690f932.js"><link rel="prefetch" href="/mflyyou/assets/js/50.02c00523.js"><link rel="prefetch" href="/mflyyou/assets/js/51.a3e94aee.js"><link rel="prefetch" href="/mflyyou/assets/js/52.800d2bbd.js"><link rel="prefetch" href="/mflyyou/assets/js/53.facb222c.js"><link rel="prefetch" href="/mflyyou/assets/js/54.5ec28964.js"><link rel="prefetch" href="/mflyyou/assets/js/55.042fc13c.js"><link rel="prefetch" href="/mflyyou/assets/js/56.a5ffdebe.js"><link rel="prefetch" href="/mflyyou/assets/js/57.98b3cd75.js"><link rel="prefetch" href="/mflyyou/assets/js/58.26e60f48.js"><link rel="prefetch" href="/mflyyou/assets/js/59.12e56810.js"><link rel="prefetch" href="/mflyyou/assets/js/6.9bd6c0f8.js"><link rel="prefetch" href="/mflyyou/assets/js/60.b8d9096c.js"><link rel="prefetch" href="/mflyyou/assets/js/61.b4a76c5b.js"><link rel="prefetch" href="/mflyyou/assets/js/62.4a73cb4a.js"><link rel="prefetch" href="/mflyyou/assets/js/63.76e2483a.js"><link rel="prefetch" href="/mflyyou/assets/js/64.969198b0.js"><link rel="prefetch" href="/mflyyou/assets/js/65.4fe1ca39.js"><link rel="prefetch" href="/mflyyou/assets/js/66.d6181f89.js"><link rel="prefetch" href="/mflyyou/assets/js/67.52efb8b3.js"><link rel="prefetch" href="/mflyyou/assets/js/68.13f6ef50.js"><link rel="prefetch" href="/mflyyou/assets/js/69.fe9f6ad2.js"><link rel="prefetch" href="/mflyyou/assets/js/7.b3070f80.js"><link rel="prefetch" href="/mflyyou/assets/js/70.7bc80c52.js"><link rel="prefetch" href="/mflyyou/assets/js/71.ca7b589d.js"><link rel="prefetch" href="/mflyyou/assets/js/73.233ad3c2.js"><link rel="prefetch" href="/mflyyou/assets/js/74.b439919d.js"><link rel="prefetch" href="/mflyyou/assets/js/75.c7b7f42b.js"><link rel="prefetch" href="/mflyyou/assets/js/76.7b42229e.js"><link rel="prefetch" href="/mflyyou/assets/js/77.3b220ee5.js"><link rel="prefetch" href="/mflyyou/assets/js/78.3e829a87.js"><link rel="prefetch" href="/mflyyou/assets/js/79.969a3ebc.js"><link rel="prefetch" href="/mflyyou/assets/js/8.0476bdcb.js"><link rel="prefetch" href="/mflyyou/assets/js/80.b563c0eb.js"><link rel="prefetch" href="/mflyyou/assets/js/81.77689652.js"><link rel="prefetch" href="/mflyyou/assets/js/82.8d888d81.js"><link rel="prefetch" href="/mflyyou/assets/js/83.866c1af6.js"><link rel="prefetch" href="/mflyyou/assets/js/84.78ab0ebe.js"><link rel="prefetch" href="/mflyyou/assets/js/85.d1bf46c0.js"><link rel="prefetch" href="/mflyyou/assets/js/86.7ae2b20a.js"><link rel="prefetch" href="/mflyyou/assets/js/87.0e6ffedd.js"><link rel="prefetch" href="/mflyyou/assets/js/88.8df4755a.js"><link rel="prefetch" href="/mflyyou/assets/js/89.f3cc4967.js"><link rel="prefetch" href="/mflyyou/assets/js/9.d6cb3b5c.js"><link rel="prefetch" href="/mflyyou/assets/js/90.d626a497.js"><link rel="prefetch" href="/mflyyou/assets/js/91.3ca93c61.js"><link rel="prefetch" href="/mflyyou/assets/js/92.e369ff4e.js"><link rel="prefetch" href="/mflyyou/assets/js/93.79768caa.js"><link rel="prefetch" href="/mflyyou/assets/js/94.60d0a3cf.js"><link rel="prefetch" href="/mflyyou/assets/js/95.fdd06ba3.js"><link rel="prefetch" href="/mflyyou/assets/js/96.cbf5ce8f.js"><link rel="prefetch" href="/mflyyou/assets/js/97.d33fcf38.js"><link rel="prefetch" href="/mflyyou/assets/js/98.4cc70c16.js"><link rel="prefetch" href="/mflyyou/assets/js/99.48464bb8.js">
    <link rel="stylesheet" href="/mflyyou/assets/css/0.styles.69128c36.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mflyyou/" class="home-link router-link-active"><!----> <span class="site-name">Mflyyou</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mflyyou/java/base/java-messy-code.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Java
</a></div><div class="nav-item"><a href="/mflyyou/go/base/go-command.html" class="nav-link">
  Go
</a></div><div class="nav-item"><a href="/mflyyou/springboot/" class="nav-link">
  SpringBoot
</a></div><div class="nav-item"><a href="/mflyyou/tcp-ip/http/http-cors-jsonp/" class="nav-link">
  TCP/IP
</a></div><div class="nav-item"><a href="/mflyyou/dev-tools/asdf/" class="nav-link">
  开发工具
</a></div><div class="nav-item"><a href="/mflyyou/devops/docker/" class="nav-link">
  DevOps
</a></div> <a href="https://github.com/zhangpanqin/mflyyou" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mflyyou/java/base/java-messy-code.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Java
</a></div><div class="nav-item"><a href="/mflyyou/go/base/go-command.html" class="nav-link">
  Go
</a></div><div class="nav-item"><a href="/mflyyou/springboot/" class="nav-link">
  SpringBoot
</a></div><div class="nav-item"><a href="/mflyyou/tcp-ip/http/http-cors-jsonp/" class="nav-link">
  TCP/IP
</a></div><div class="nav-item"><a href="/mflyyou/dev-tools/asdf/" class="nav-link">
  开发工具
</a></div><div class="nav-item"><a href="/mflyyou/devops/docker/" class="nav-link">
  DevOps
</a></div> <a href="https://github.com/zhangpanqin/mflyyou" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Java 基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mflyyou/java/base/java-messy-code.html" aria-current="page" class="active sidebar-link">深入理解 Java 乱码问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mflyyou/java/base/java-messy-code.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/mflyyou/java/base/java-messy-code.html#java-中字符串" class="sidebar-link">Java 中字符串</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mflyyou/java/base/java-messy-code.html#在-java-中定义字符串" class="sidebar-link">在 java 中定义字符串</a></li><li class="sidebar-sub-header"><a href="/mflyyou/java/base/java-messy-code.html#java-中字符串与-unicode-有什么关系呢" class="sidebar-link">java 中字符串与 Unicode 有什么关系呢？</a></li><li class="sidebar-sub-header"><a href="/mflyyou/java/base/java-messy-code.html#java-乱码思考题" class="sidebar-link">java 乱码思考题</a></li></ul></li><li class="sidebar-sub-header"><a href="/mflyyou/java/base/java-messy-code.html#unicode-和-utf-8-的关系" class="sidebar-link">Unicode 和 UTF-8 的关系</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mflyyou/java/base/java-messy-code.html#代码验证猜想" class="sidebar-link">代码验证猜想</a></li><li class="sidebar-sub-header"><a href="/mflyyou/java/base/java-messy-code.html#uinocde-与-gbk-转码" class="sidebar-link">Uinocde 与 GBK 转码</a></li></ul></li><li class="sidebar-sub-header"><a href="/mflyyou/java/base/java-messy-code.html#上述思考题见解" class="sidebar-link">上述思考题见解</a></li></ul></li><li><a href="/mflyyou/java/base/java-run-command.html" class="sidebar-link">java command</a></li><li><a href="/mflyyou/java/base/java-reference.html" class="sidebar-link">java 中强软弱虚引用的妙用</a></li><li><a href="/mflyyou/java/base/how-to-read-file-in-java.html" class="sidebar-link">Java-中读取文件内容的-n-中方式</a></li><li><a href="/mflyyou/java/base/java-asynchronous-programming.html" class="sidebar-link">java 异步编程</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>IO</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mflyyou/java/io/io-module.html" class="sidebar-link">从linux内核理解Java怎样实现Socket通信</a></li><li><a href="/mflyyou/java/io/java-io.html" class="sidebar-link">从Linux内核理解Java中的IO</a></li><li><a href="/mflyyou/java/io/java-nio.html" class="sidebar-link">从Linux内核理解JAVA的NIO</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JUC</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mflyyou/java/juc/synchronized.html" class="sidebar-link">从锁升级的角度理解 synchronized</a></li><li><a href="/mflyyou/java/juc/volatile.html" class="sidebar-link">你需要了解 Lock 的前提-volatile</a></li><li><a href="/mflyyou/java/juc/thread-pool-executor.html" class="sidebar-link">ThreadPoolExecutor</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JVM</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mflyyou/java/jvm/" class="sidebar-link">JVM 参数查看</a></li><li><a href="/mflyyou/java/jvm/jvm-memory-model.html" class="sidebar-link">认识 Java 运行时数据区</a></li><li><a href="/mflyyou/java/jvm/class-loader.html" class="sidebar-link">Java 类加载器及类加载过程</a></li><li><a href="/mflyyou/java/jvm/jvm-gc.html" class="sidebar-link">了解垃圾回收和常用虚拟机参数</a></li><li><a href="/mflyyou/java/jvm/jvm-gc-demo.html" class="sidebar-link">GC 示例</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>通用工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mflyyou/java/lib/snowflake.html" class="sidebar-link">雪花算法</a></li><li><a href="/mflyyou/java/lib/distributed_lock.html" class="sidebar-link">分布式锁</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>乱码问题说难不难，一句话解决，编码和解码采用相同的 charset (字符集)。</p> <p>如果深究，需要了解的东西挺多的：</p> <ul><li>Java 中字符串和 Unicode 的关系</li> <li>Unicode 和 UTF-8、GBK 的关系</li> <li>原码，反码，补码（因为 java 采用补码存储）</li></ul> <h2 id="java-中字符串"><a href="#java-中字符串" class="header-anchor">#</a> Java 中字符串</h2> <h3 id="在-java-中定义字符串"><a href="#在-java-中定义字符串" class="header-anchor">#</a> 在 java 中定义字符串</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> a <span class="token operator">=</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> b <span class="token operator">=</span> <span class="token string">&quot;\u261d&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ☝</span>
    <span class="token class-name">String</span> ding <span class="token operator">=</span> <span class="token string">&quot;\u4E00&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ding<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 一</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="java-中字符串与-unicode-有什么关系呢"><a href="#java-中字符串与-unicode-有什么关系呢" class="header-anchor">#</a> java 中字符串与 Unicode 有什么关系呢？</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Str</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">char</span> char1 <span class="token operator">=</span> <span class="token char">'一'</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> str1 <span class="token operator">=</span> <span class="token string">&quot;丁万&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>char1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>编译之后的 class 文件，采用了 Uincode 字符集。</p> <p>比如你源码 java 文件为 utf-8，编译之后采用 Uincode 字符集。</p> <p>源码文件为 GBK，编译之后采用 Uincode 字符集。</p> <p>从下图展示结果可以推出上述结论。</p> <p><a href="https://tool.lu/hexconvert/" target="_blank" rel="noopener noreferrer">在线进制转换<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><code>一</code> 对应 Uincode 码点为 <code>4E00</code>，十进制为：<code>19968</code></p> <p><code>丁</code> 对应 Uincode 码点为 <code>4E01</code></p> <p><code>万</code> 对应 Uincode 码点为 <code>4E07</code></p> <p>idea 自带的插件 ByteCodeViewer 和安装的插件 jclasslib。在导航栏 View 下可以看到。</p> <p><img src="/blog/20200606172050.png?author=zhangpanqin" alt="image-20200606172050099"></p> <p><font color="red"> java 内存中的字符串采用的是 unicode 字符集，也就是内编码。不管怎么编码解码，最后的字符串都会用 unicode 字符集   </font></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Str</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UnsupportedEncodingException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;字符串编译之后为 unicode 字符集&quot;</span><span class="token punctuation">;</span>

        <span class="token keyword">final</span> <span class="token class-name">String</span> charsetName <span class="token operator">=</span> <span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">// 使用 UTF-8 编码为字节</span>
        <span class="token keyword">final</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span>charsetName<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 解码为字符串,编码和解码采用同样的编码规则 UTF-8</span>
        <span class="token keyword">final</span> <span class="token class-name">String</span> x <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> charsetName<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 打印 23383,字的 16 进制码点为 5B57 转为十进制为 23383</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">codePointAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token keyword">final</span> <span class="token class-name">String</span> gbk <span class="token operator">=</span> <span class="token string">&quot;GBK&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">// 使用 GBK 编码为字节</span>
        <span class="token keyword">final</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> gbks <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span>gbk<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 解码为字符串,编码和解码采用同样的编码规则 GBK</span>
        <span class="token keyword">final</span> <span class="token class-name">String</span> x1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>gbks<span class="token punctuation">,</span> gbk<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 打印 23383,字的 16 进制码点为 5B57 转为十进制为 23383</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>x1<span class="token punctuation">.</span><span class="token function">codePointAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>x1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="java-乱码思考题"><a href="#java-乱码思考题" class="header-anchor">#</a> java 乱码思考题</h3> <p>来个例子体验下怎样解决乱码问题，这个算是模拟乱码解决的场景了</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run100</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UnsupportedEncodingException</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;张攀钦&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> gbks <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;GBK&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>gbks<span class="token punctuation">,</span> <span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 以上代码不允许修改</span>

    <span class="token comment">// 你有办法将 s 变为不乱码吗</span>
<span class="token punctuation">}</span>
</code></pre></div><p><font color="red">以上内容你了解了，基本不用往下看了，下面是我验证我对 Uincode 字符集和 UTF-8 、GBK   理解 。</font></p> <h2 id="unicode-和-utf-8-的关系"><a href="#unicode-和-utf-8-的关系" class="header-anchor">#</a> Unicode 和 UTF-8 的关系</h2> <p><a href="http://www.chi2ko.com/tool/CJK.htm" target="_blank" rel="noopener noreferrer">Uincode 编码表<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Uincode 是一个字符集。它规定了我们使用到的字或符号的码点（code point）。码点使用 16 进制保存。</p> <p><img src="/blog/20200606164146.png?author=zhangpanqin" alt=""></p> <p>Uincode 字符集规定 <code>一</code> 的码点为 4E00。</p> <p>Uincode 字符集规定 <code>丁</code> 的码点为 4E01。</p> <p>计算机呢只能识别二进制的 0 和 1。而 UTF-8 指的是编码规则，定义了 <code>码点</code> 怎么保存成二进制。</p> <table><thead><tr><th>十进制</th> <th>Unicode 符号范围(十六进制)</th> <th>UTF-8 编码方式（二进制）</th></tr></thead> <tbody><tr><td>0-127</td> <td>0000 0000-0000 007F</td> <td>0xxxxxxx</td></tr> <tr><td>128-2047</td> <td>0000 0080-0000 07FF</td> <td>110xxxxx 10xxxxxx</td></tr> <tr><td>2048-65535</td> <td>0000 0800-0000 FFFF</td> <td>1110xxxx 10xxxxxx 10xxxxxx</td></tr> <tr><td>65536-1114111</td> <td>0001 0000-0010 FFFF</td> <td>11110xxx 10xxxxxx 10xxxxxx 10xxxxxx</td></tr></tbody></table> <p>上述表格简单描述了 Unicode 按 UTF-8 编码的格式。</p> <ul><li>首先将 16 进制的码点，通过<a href="https://tool.lu/hexconvert/" target="_blank" rel="noopener noreferrer">进制转换<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 为十进制</li> <li>然后使用十进制的数字查找上述表格处于哪个范围中，得出编码规则。</li> <li>然后将码点转换为 2 进制，从低位到高位替换 x 即可得到字二进制的原码</li> <li>将二进制的原码转换为补码存储。</li></ul> <p><a href="https://www.cnblogs.com/yinzhengjie/p/8666354.html" target="_blank" rel="noopener noreferrer">Java 基础-原码反码补码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="代码验证猜想"><a href="#代码验证猜想" class="header-anchor">#</a> 代码验证猜想</h3> <p>以 <code>赵</code> 为例子讲解，<code>赵</code> 的码点为：<code>8D75</code></p> <p><code>赵</code> 的 16 进制的码点转换为 10 进制：<code>36213</code></p> <p>36213 处于 2048-65535 ，得出对应的 UTF-8 编码格式为：<code>1110xxxx 10xxxxxx 10xxxxxx</code></p> <p>赵的 16 进制码点 8D75 转换为二进制 <code>1000 110101 110101</code></p> <p>将 <code>1000 110101 110101</code> 二进制填充在 <code>1110xxxx 10xxxxxx 10xxxxxx</code> 中的 x 中，不足的补 0.</p> <p>补充完为：<code>11101000 10110101 10110101</code>。</p> <p>对三个字节分别求补码为：</p> <p>原码：11101000 10110101 10110101</p> <p>补码：10011000 11001011 11001011</p> <p>每个字节的第一位表示是正数还是负数。 1 表示负数，0 表示正数。</p> <p>补码对应 java 中的字节数组为：{-24,-75,-75}</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run454</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UnsupportedEncodingException</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> str <span class="token operator">=</span><span class="token string">&quot;赵&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">StringBuilder</span> stringBuilder <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">byte</span> aByte <span class="token operator">:</span> bytes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        stringBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>aByte<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stringBuilder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>为了再次确认我的逻辑是否正确，我再使用 <code>且</code> 字验证</p> <p><code>且</code> 的码点: <code>4E14</code></p> <p>16 进制的码点转换为 10 进制：<code>19988</code></p> <p>19988 处于 2048-65535 ，得出对应的 UTF-8 编码格式为：1110xxxx 10xxxxxx 10xxxxxx</p> <p>16 进制的码点转换成二进制：100111000010100。</p> <p>将 <code>100 111000 010100</code> 填入对应的编码格式 <code>1110xxxx 10xxxxxx 10xxxxxx</code> 的 x，没有填充的 x 用 0 替换。</p> <p>原码：11100100 10111000 10010100</p> <p>补码：10011100 11001000 11101100</p> <p>补码对应的字节数组为：{-28,-72,-108}</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run43</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UnsupportedEncodingException</span> <span class="token punctuation">{</span>

    <span class="token comment">// {-28,-72,-108}</span>
    <span class="token class-name">String</span> str <span class="token operator">=</span><span class="token string">&quot;且&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">StringBuilder</span> stringBuilder <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">byte</span> aByte <span class="token operator">:</span> bytes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        stringBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>aByte<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stringBuilder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="uinocde-与-gbk-转码"><a href="#uinocde-与-gbk-转码" class="header-anchor">#</a> Uinocde 与 GBK 转码</h3> <p><a href="https://www.qqxiuzi.cn/zh/hanzi-gbk-bianma.php" target="_blank" rel="noopener noreferrer">GBK 编码表<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>赵的 <code>GBK</code> 码点为：<code>D5D4</code></p> <p>十六进制码点转换为二进制：11010101 11010100
源码：11010101 11010100
补码：10101011 10101100</p> <p>补码对应的字节数组为：{-43,-44}</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run454</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UnsupportedEncodingException</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> str <span class="token operator">=</span><span class="token string">&quot;赵&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;GBK&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">StringBuilder</span> stringBuilder <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">byte</span> aByte <span class="token operator">:</span> bytes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        stringBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>aByte<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// -43,-44</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stringBuilder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="上述思考题见解"><a href="#上述思考题见解" class="header-anchor">#</a> 上述思考题见解</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run100</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UnsupportedEncodingException</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;张攀钦&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> gbks <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;GBK&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>gbks<span class="token punctuation">,</span> <span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 以上代码不允许修改</span>

    <span class="token comment">// 你有办法将 s 变为不乱码吗</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可能你会这样想</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run100</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UnsupportedEncodingException</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;张攀钦&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> gbks <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;GBK&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>gbks<span class="token punctuation">,</span> <span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 以上代码不允许修改</span>

    <span class="token comment">// 你有办法将 s 变为不乱码吗</span>

    <span class="token keyword">final</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> error_s <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 打印依然是乱码</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>error_s<span class="token punctuation">,</span><span class="token string">&quot;GBK&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>编码：字符串到字节。</p> <p>解码：字节到字符串。</p> <p>当我们读取文件的时候实际读取的是字节。然后根据文件的编码格式，将字节解码成字符串。乱码问题容易出现的地方就是这里。</p> <p>不要妄想在 java 中将一个乱码的字符串变量变成一个非乱码的。这个思路是错误的。应该从乱码之前的字节着手处理。</p> <p>这里的 <code>s</code> 实际上就是乱码的字符串了，你怎么改变它都回不到 <code>str</code>。</p> <p>因为 <code>s</code> 和 <code>str</code> 的字节压根不是一个东西了。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run100</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UnsupportedEncodingException</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;张攀钦&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> gbks <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;GBK&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>gbks<span class="token punctuation">,</span> <span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>解决乱码问题的思路，是先确定在哪里开始的乱码，这里开始向上查代码，看哪里解码采用了错误的编码规则。</p> <p><img src="/blog/20200606190126.png?author=zhangpanqin" alt="image-20200606190126427"></p> <p>上述场景实际是对不乱码的 gbks 采用了错误的解码规则，我们只要换一下解码规则就行了。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run100</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UnsupportedEncodingException</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;张攀钦&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> gbks <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;GBK&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>gbks<span class="token punctuation">,</span> <span class="token string">&quot;GBK&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/zhangpanqin/mflyyou/edit/main/docs/java/base/java-messy-code.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/7/5 上午3:18:45</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/mflyyou/java/base/java-run-command.html">
                java command
            </a>
            →
        </span></p></div> </main> <aside class="right-sidebar"> <div class="right-sidebar-toc-container" style="display:;"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="max-height:650px"><div style="font-weight:bold;text-align:center;">深入理解 Java 乱码问题</div> <hr> <div class="toc-box"><ul><li><a href="/mflyyou/java/base/java-messy-code.html#前言" class="toc-sidebar-link">前言</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/mflyyou/java/base/java-messy-code.html#java-中字符串" class="toc-sidebar-link">Java 中字符串</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/mflyyou/java/base/java-messy-code.html#在-java-中定义字符串" class="toc-sidebar-link">在 java 中定义字符串</a></li><li class="toc-sidebar-sub-header"><a href="/mflyyou/java/base/java-messy-code.html#java-中字符串与-unicode-有什么关系呢" class="toc-sidebar-link">java 中字符串与 Unicode 有什么关系呢？</a></li><li class="toc-sidebar-sub-header"><a href="/mflyyou/java/base/java-messy-code.html#java-乱码思考题" class="toc-sidebar-link">java 乱码思考题</a></li></ul></li><li><a href="/mflyyou/java/base/java-messy-code.html#unicode-和-utf-8-的关系" class="toc-sidebar-link">Unicode 和 UTF-8 的关系</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/mflyyou/java/base/java-messy-code.html#代码验证猜想" class="toc-sidebar-link">代码验证猜想</a></li><li class="toc-sidebar-sub-header"><a href="/mflyyou/java/base/java-messy-code.html#uinocde-与-gbk-转码" class="toc-sidebar-link">Uinocde 与 GBK 转码</a></li></ul></li><li><a href="/mflyyou/java/base/java-messy-code.html#上述思考题见解" class="toc-sidebar-link">上述思考题见解</a><ul class="toc-sidebar-sub-headers"></ul></li></ul></div></div></div></div> <div class="right-sidebar-toolbar"><div class="option-box"><img src="/mflyyou/images/system/toc.png" class="nozoom"> <span class="show-txt">目录</span></div> <div class="option-box"><img src="/mflyyou/images/system/toggle.png" width="30px" class="nozoom"> <span class="show-txt">左栏</span></div> <!----> <div title="java command" class="option-box" style="padding-left:2px;text-align:center;"><a href="/mflyyou/java/base/java-run-command.html"><img src="/mflyyou/images/system/next2.png" width="30px" class="nozoom"> <span class="show-txt">下一篇</span></a></div></div> </aside></div><div class="global-ui"><!----><!----></div></div>
    <script src="/mflyyou/assets/js/app.e7c34c1e.js" defer></script><script src="/mflyyou/assets/js/4.527dd67c.js" defer></script><script src="/mflyyou/assets/js/2.40ff7517.js" defer></script><script src="/mflyyou/assets/js/72.2e14eb54.js" defer></script><script src="/mflyyou/assets/js/13.5f8596a1.js" defer></script>
  </body>
</html>
