<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nginx-包教包会-入门 | Mflyyou</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/mflyyou/favicon.ico">
    <meta name="description" content="张攀钦的笔记">
    <meta name="theme-color" content="#3eaf7c">
    
    <link rel="preload" href="/mflyyou/assets/css/0.styles.69128c36.css" as="style"><link rel="preload" href="/mflyyou/assets/js/app.0c7751fa.js" as="script"><link rel="preload" href="/mflyyou/assets/js/4.ec17e064.js" as="script"><link rel="preload" href="/mflyyou/assets/js/2.2ab84419.js" as="script"><link rel="preload" href="/mflyyou/assets/js/58.c2817095.js" as="script"><link rel="preload" href="/mflyyou/assets/js/12.60b8c9aa.js" as="script"><link rel="prefetch" href="/mflyyou/assets/js/10.71771dad.js"><link rel="prefetch" href="/mflyyou/assets/js/100.d4b7bfdd.js"><link rel="prefetch" href="/mflyyou/assets/js/101.01e93d9e.js"><link rel="prefetch" href="/mflyyou/assets/js/102.46613db8.js"><link rel="prefetch" href="/mflyyou/assets/js/103.2fcd8af3.js"><link rel="prefetch" href="/mflyyou/assets/js/104.bf311d2d.js"><link rel="prefetch" href="/mflyyou/assets/js/105.0b08c279.js"><link rel="prefetch" href="/mflyyou/assets/js/106.7d4e891c.js"><link rel="prefetch" href="/mflyyou/assets/js/107.fd860e32.js"><link rel="prefetch" href="/mflyyou/assets/js/108.eee8f360.js"><link rel="prefetch" href="/mflyyou/assets/js/109.3e863dae.js"><link rel="prefetch" href="/mflyyou/assets/js/11.09b8531d.js"><link rel="prefetch" href="/mflyyou/assets/js/110.fe54b70a.js"><link rel="prefetch" href="/mflyyou/assets/js/111.40d6949e.js"><link rel="prefetch" href="/mflyyou/assets/js/13.6a4881ad.js"><link rel="prefetch" href="/mflyyou/assets/js/14.63e74f99.js"><link rel="prefetch" href="/mflyyou/assets/js/15.ff0d92a8.js"><link rel="prefetch" href="/mflyyou/assets/js/16.588c1feb.js"><link rel="prefetch" href="/mflyyou/assets/js/17.d7b70f01.js"><link rel="prefetch" href="/mflyyou/assets/js/18.8238ccdb.js"><link rel="prefetch" href="/mflyyou/assets/js/19.4112adb5.js"><link rel="prefetch" href="/mflyyou/assets/js/20.72811bd0.js"><link rel="prefetch" href="/mflyyou/assets/js/21.31258db4.js"><link rel="prefetch" href="/mflyyou/assets/js/22.111044cd.js"><link rel="prefetch" href="/mflyyou/assets/js/23.9685277f.js"><link rel="prefetch" href="/mflyyou/assets/js/24.8b332282.js"><link rel="prefetch" href="/mflyyou/assets/js/25.2d72c5e4.js"><link rel="prefetch" href="/mflyyou/assets/js/26.acafd3ae.js"><link rel="prefetch" href="/mflyyou/assets/js/27.5c9391b9.js"><link rel="prefetch" href="/mflyyou/assets/js/28.a797684e.js"><link rel="prefetch" href="/mflyyou/assets/js/29.6120b352.js"><link rel="prefetch" href="/mflyyou/assets/js/3.a15d2cd4.js"><link rel="prefetch" href="/mflyyou/assets/js/30.72a75ae8.js"><link rel="prefetch" href="/mflyyou/assets/js/31.ea895aad.js"><link rel="prefetch" href="/mflyyou/assets/js/32.cabbf8f2.js"><link rel="prefetch" href="/mflyyou/assets/js/33.c22b6ef7.js"><link rel="prefetch" href="/mflyyou/assets/js/34.118a8f29.js"><link rel="prefetch" href="/mflyyou/assets/js/35.7dea91c9.js"><link rel="prefetch" href="/mflyyou/assets/js/36.2b1418da.js"><link rel="prefetch" href="/mflyyou/assets/js/37.5fea3731.js"><link rel="prefetch" href="/mflyyou/assets/js/38.ac4ccd84.js"><link rel="prefetch" href="/mflyyou/assets/js/39.71cba9ce.js"><link rel="prefetch" href="/mflyyou/assets/js/40.d11c705d.js"><link rel="prefetch" href="/mflyyou/assets/js/41.9cc92f08.js"><link rel="prefetch" href="/mflyyou/assets/js/42.b0378352.js"><link rel="prefetch" href="/mflyyou/assets/js/43.7cc4c727.js"><link rel="prefetch" href="/mflyyou/assets/js/44.607141d7.js"><link rel="prefetch" href="/mflyyou/assets/js/45.b6d64035.js"><link rel="prefetch" href="/mflyyou/assets/js/46.d8ea00dd.js"><link rel="prefetch" href="/mflyyou/assets/js/47.42893905.js"><link rel="prefetch" href="/mflyyou/assets/js/48.1636bffb.js"><link rel="prefetch" href="/mflyyou/assets/js/49.172a52c9.js"><link rel="prefetch" href="/mflyyou/assets/js/5.e9d85935.js"><link rel="prefetch" href="/mflyyou/assets/js/50.3634166d.js"><link rel="prefetch" href="/mflyyou/assets/js/51.4a68ee66.js"><link rel="prefetch" href="/mflyyou/assets/js/52.ecf03a3d.js"><link rel="prefetch" href="/mflyyou/assets/js/53.0bf43b16.js"><link rel="prefetch" href="/mflyyou/assets/js/54.61fe004b.js"><link rel="prefetch" href="/mflyyou/assets/js/55.042fc13c.js"><link rel="prefetch" href="/mflyyou/assets/js/56.a5ffdebe.js"><link rel="prefetch" href="/mflyyou/assets/js/57.23c8504d.js"><link rel="prefetch" href="/mflyyou/assets/js/59.c661ea23.js"><link rel="prefetch" href="/mflyyou/assets/js/6.49873bca.js"><link rel="prefetch" href="/mflyyou/assets/js/60.dae65c33.js"><link rel="prefetch" href="/mflyyou/assets/js/61.15af6a15.js"><link rel="prefetch" href="/mflyyou/assets/js/62.4a73cb4a.js"><link rel="prefetch" href="/mflyyou/assets/js/63.4ad72a00.js"><link rel="prefetch" href="/mflyyou/assets/js/64.cb057bdf.js"><link rel="prefetch" href="/mflyyou/assets/js/65.389d85fd.js"><link rel="prefetch" href="/mflyyou/assets/js/66.74c7a091.js"><link rel="prefetch" href="/mflyyou/assets/js/67.4ee35fdf.js"><link rel="prefetch" href="/mflyyou/assets/js/68.ab448e96.js"><link rel="prefetch" href="/mflyyou/assets/js/69.32f2c42c.js"><link rel="prefetch" href="/mflyyou/assets/js/7.b3070f80.js"><link rel="prefetch" href="/mflyyou/assets/js/70.7bc80c52.js"><link rel="prefetch" href="/mflyyou/assets/js/71.d666e2e3.js"><link rel="prefetch" href="/mflyyou/assets/js/72.48d54577.js"><link rel="prefetch" href="/mflyyou/assets/js/73.072fe402.js"><link rel="prefetch" href="/mflyyou/assets/js/74.b439919d.js"><link rel="prefetch" href="/mflyyou/assets/js/75.34ae4967.js"><link rel="prefetch" href="/mflyyou/assets/js/76.7b42229e.js"><link rel="prefetch" href="/mflyyou/assets/js/77.0ed63c57.js"><link rel="prefetch" href="/mflyyou/assets/js/78.16dee96f.js"><link rel="prefetch" href="/mflyyou/assets/js/79.6faa50b1.js"><link rel="prefetch" href="/mflyyou/assets/js/8.0476bdcb.js"><link rel="prefetch" href="/mflyyou/assets/js/80.a7e467ad.js"><link rel="prefetch" href="/mflyyou/assets/js/81.77689652.js"><link rel="prefetch" href="/mflyyou/assets/js/82.ac0c77ea.js"><link rel="prefetch" href="/mflyyou/assets/js/83.866c1af6.js"><link rel="prefetch" href="/mflyyou/assets/js/84.c40cb145.js"><link rel="prefetch" href="/mflyyou/assets/js/85.a2f77426.js"><link rel="prefetch" href="/mflyyou/assets/js/86.2a4320a1.js"><link rel="prefetch" href="/mflyyou/assets/js/87.fa3b9bc7.js"><link rel="prefetch" href="/mflyyou/assets/js/88.ca3a2353.js"><link rel="prefetch" href="/mflyyou/assets/js/89.599b9ed1.js"><link rel="prefetch" href="/mflyyou/assets/js/9.9ed1f826.js"><link rel="prefetch" href="/mflyyou/assets/js/90.d626a497.js"><link rel="prefetch" href="/mflyyou/assets/js/91.b546a07a.js"><link rel="prefetch" href="/mflyyou/assets/js/92.e369ff4e.js"><link rel="prefetch" href="/mflyyou/assets/js/93.cdffa607.js"><link rel="prefetch" href="/mflyyou/assets/js/94.4e7be313.js"><link rel="prefetch" href="/mflyyou/assets/js/95.2bb38e9a.js"><link rel="prefetch" href="/mflyyou/assets/js/96.77f15dfc.js"><link rel="prefetch" href="/mflyyou/assets/js/97.d33fcf38.js"><link rel="prefetch" href="/mflyyou/assets/js/98.5c38d6a2.js"><link rel="prefetch" href="/mflyyou/assets/js/99.463cd264.js">
    <link rel="stylesheet" href="/mflyyou/assets/css/0.styles.69128c36.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/mflyyou/" class="home-link router-link-active"><!----> <span class="site-name">Mflyyou</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/mflyyou/java/base/java-messy-code.html" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/mflyyou/go/base/go-command.html" class="nav-link">
  Go
</a></div><div class="nav-item"><a href="/mflyyou/springboot/" class="nav-link">
  SpringBoot
</a></div><div class="nav-item"><a href="/mflyyou/tcp-ip/http/http-cors-jsonp/" class="nav-link">
  TCP/IP
</a></div><div class="nav-item"><a href="/mflyyou/dev-tools/asdf/" class="nav-link">
  开发工具
</a></div><div class="nav-item"><a href="/mflyyou/devops/docker/" class="nav-link">
  DevOps
</a></div> <a href="https://github.com/zhangpanqin/mflyyou" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/mflyyou/java/base/java-messy-code.html" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/mflyyou/go/base/go-command.html" class="nav-link">
  Go
</a></div><div class="nav-item"><a href="/mflyyou/springboot/" class="nav-link">
  SpringBoot
</a></div><div class="nav-item"><a href="/mflyyou/tcp-ip/http/http-cors-jsonp/" class="nav-link">
  TCP/IP
</a></div><div class="nav-item"><a href="/mflyyou/dev-tools/asdf/" class="nav-link">
  开发工具
</a></div><div class="nav-item"><a href="/mflyyou/devops/docker/" class="nav-link">
  DevOps
</a></div> <a href="https://github.com/zhangpanqin/mflyyou" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Docker</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mflyyou/devops/docker/" class="sidebar-link">Docker</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Terraform</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mflyyou/devops/terraform/" class="sidebar-link">Terraform</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>AWS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mflyyou/devops/aws/" class="sidebar-link">Aws</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Linux</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mflyyou/devops/linux/linux-base.html" class="sidebar-link">Linux 基础</a></li><li><a href="/mflyyou/devops/linux/vim.html" class="sidebar-link">Vim</a></li><li><a href="/mflyyou/devops/linux/ssh.html" class="sidebar-link">SSH</a></li><li><a href="/mflyyou/devops/linux/redirect-pipeline.html" class="sidebar-link">重定向和管道流</a></li><li><a href="/mflyyou/devops/linux/debian.html" class="sidebar-link">Debian</a></li><li><a href="/mflyyou/devops/linux/shell-base.html" class="sidebar-link">shell 基础</a></li><li><a href="/mflyyou/devops/linux/shell-example.html" class="sidebar-link">实用的 shell 列子</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>auth0</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mflyyou/devops/auth0/auth0.html" class="sidebar-link">auth0</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Nginx</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mflyyou/devops/nginx/nginx-base.html" aria-current="page" class="active sidebar-link">Nginx-包教包会-入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#nginx-安装" class="sidebar-link">Nginx 安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#docker" class="sidebar-link">docker</a></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#nginx-安装步骤" class="sidebar-link">Nginx 安装步骤</a></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#nginx-命令" class="sidebar-link">Nginx 命令</a></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#系统开启、关闭、重启、查看-nginx-命令" class="sidebar-link">系统开启、关闭、重启、查看 nginx 命令</a></li></ul></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#nginx-简单配置" class="sidebar-link">Nginx 简单配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#nginx-介绍" class="sidebar-link">Nginx 介绍</a></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#server-配置" class="sidebar-link">Server 配置</a></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#listen-和-server-name-配置" class="sidebar-link">listen 和 server_name 配置</a></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#return-配置" class="sidebar-link">return 配置</a></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#location-配置" class="sidebar-link">location 配置</a></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#add-header-添加响应头" class="sidebar-link">add_header 添加响应头</a></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#error-page" class="sidebar-link">error_page</a></li></ul></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#root-和-alias-的区别" class="sidebar-link">root 和 alias 的区别</a></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#内置变量" class="sidebar-link">内置变量</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#arg-name-获取请求参数" class="sidebar-link">$arg_name 获取请求参数</a></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#args-获取请求-query-string-参数" class="sidebar-link">$args 获取请求 query_string 参数</a></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#cookie-name-获取-cookie-的值" class="sidebar-link">$cookie_name 获取 cookie 的值</a></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#http-name-获取请求头" class="sidebar-link">$http_name 获取请求头</a></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#uri-获取请求路径中的-path" class="sidebar-link">$uri 获取请求路径中的 path</a></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#host-获取请求的-ip" class="sidebar-link">$host 获取请求的 ip</a></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#request-uri-获取-path-和-query-string" class="sidebar-link">$request_uri 获取 path 和 query string</a></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#scheme-获取请求协议" class="sidebar-link">$scheme 获取请求协议</a></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#request-method-获取请求方法" class="sidebar-link">$request_method 获取请求方法</a></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#其他变量" class="sidebar-link">其他变量</a></li></ul></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#if" class="sidebar-link">if</a></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#rewrite" class="sidebar-link">rewrite</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#验证-break-和-last" class="sidebar-link">验证 break 和 last</a></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#验证-redirect-和-permanent" class="sidebar-link">验证 redirect 和 permanent</a></li></ul></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#try-files" class="sidebar-link">try_files</a></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#配置-gzip" class="sidebar-link">配置 gzip</a></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#配置缓存" class="sidebar-link">配置缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#协商缓存" class="sidebar-link">协商缓存</a></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#last-modified-if-modify-since" class="sidebar-link">Last-Modified/if-Modify-Since</a></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#强制缓存" class="sidebar-link">强制缓存</a></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#配置缓存-2" class="sidebar-link">配置缓存</a></li></ul></li><li class="sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#推荐资料" class="sidebar-link">推荐资料</a></li></ul></li><li><a href="/mflyyou/devops/nginx/nginx-config.html" class="sidebar-link">Nginx-性能优化</a></li><li><a href="/mflyyou/devops/nginx/nginx-performance.html" class="sidebar-link">Nginx-包教包会-进阶</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>数据库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>Mysql</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mflyyou/devops/database/mysql/" class="sidebar-link">Mysql 基础</a></li><li><a href="/mflyyou/devops/database/mysql/mysql-arch.html" class="sidebar-link">Mysql 架构</a></li><li><a href="/mflyyou/devops/database/mysql/mysql-index.html" class="sidebar-link">Mysql索引</a></li><li><a href="/mflyyou/devops/database/mysql/mysql-lock-and-transaction.html" class="sidebar-link">Mysql 事务和锁</a></li><li><a href="/mflyyou/devops/database/mysql/mysql-explain.html" class="sidebar-link">Explain 查看执行计划</a></li><li><a href="/mflyyou/devops/database/mysql/mysql-limit.html" class="sidebar-link">Mysql Limit 限制</a></li><li><a href="/mflyyou/devops/database/mysql/mysql-data-types.html" class="sidebar-link">Mysql 数据类型</a></li><li><a href="/mflyyou/devops/database/mysql/mysql-account-management.html" class="sidebar-link">Mysql 用户权限管理</a></li><li><a href="/mflyyou/devops/database/mysql/mysql-backup-recovery.html" class="sidebar-link">Mysql数据备份与恢复</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>PostgreSql</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mflyyou/devops/database/postgresql/postgresql.html" class="sidebar-link">PostgreSQL 基础</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Elasticsearch</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mflyyou/devops/elasticsearch/es.html" class="sidebar-link">Elasticsearch</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Redis</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mflyyou/devops/redis/redis.html" class="sidebar-link">Redis 基础</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/mflyyou/devops/vue/vue-depoly.html" class="sidebar-link">你不知道的 SpringBoot 与 Vue 部署解决方案</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p><code>Nginx</code> 作为 <code>web 服务器</code> 以低内存，高扩展，并且轻松单机支持 <code>1-3w</code> （据说可以单机 10w，但没有看到具体的机器配置）的并发链接的特性广受开发人员的青睐。</p> <p>推荐在 <code>linux</code> 系统上使用 <code>Nginx</code> ，这会充分利用 <code>linux</code> 的特性，性能比在 <code>windows</code> 上会更好。</p> <p>本文主要内容：</p> <ul><li>Nginx 简单配置</li> <li>root 和 alias 的区别</li> <li>location 的优先级及验证</li> <li>Nginx 内置变量介绍</li> <li>if</li> <li>rewrite 转发</li> <li>try_files</li> <li>配置 gzip</li> <li>协商缓存和强缓存的介绍和配置</li></ul> <p>后续章节，我会使用 <code>ab</code> 压测来一步一步优化 <code>Nginx</code> 的配置，Nginx 知道原理，懂得常用配置即可。有的性能优化需要了解 <code>linux 内核</code> 、<code>http</code>、<code>tcp</code> 相关的东西，如果你不想了解，可以记录一份自己的配置即可，不必纠结为什么。</p> <p>本文内容在 <code>nginx 1.16.1</code> 上测试，<code>Centos 7</code> 4 核 8g 内存的虚拟机。</p> <h2 id="nginx-安装"><a href="#nginx-安装" class="header-anchor">#</a> Nginx 安装</h2> <h3 id="docker"><a href="#docker" class="header-anchor">#</a> docker</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> pull nginx:1.25.0-alpine3.17-slim
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> ~/docker-nginx/html <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> ~/docker-nginx/nginx/conf.d


<span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">--name</span> mflyyou-nginx <span class="token punctuation">\</span>
nginx:1.25.0-alpine3.17-slim

<span class="token function">docker</span> <span class="token function">cp</span> mflyyou-nginx:/etc/nginx/conf.d/default.conf ~/docker-nginx/nginx/conf.d/default.conf
<span class="token function">docker</span> <span class="token function">cp</span> mflyyou-nginx:/etc/nginx/nginx.conf ~/docker-nginx/nginx/nginx.conf
<span class="token function">docker</span> <span class="token function">cp</span> mflyyou-nginx:/usr/share/nginx/html ~/docker-nginx/

<span class="token function">docker</span> container stop mflyyou-nginx
<span class="token function">docker</span> container <span class="token function">rm</span> mflyyou-nginx


<span class="token function">docker</span> run <span class="token parameter variable">-it</span> <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> mflyyou-nginx <span class="token parameter variable">-p</span> <span class="token number">80</span>:80 <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> ~/docker-nginx/nginx/conf.d/default.conf:/etc/nginx/conf.d/default.conf <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> ~/docker-nginx/nginx/nginx.conf:/etc/nginx/nginx.conf <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> ~/docker-nginx/html:/usr/share/nginx/html <span class="token punctuation">\</span>
nginx:1.25.0-alpine3.17-slim


<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> mflyyou-nginx <span class="token function">sh</span>
</code></pre></div><h3 id="nginx-安装步骤"><a href="#nginx-安装步骤" class="header-anchor">#</a> Nginx 安装步骤</h3> <p>根据 <a href="https://developer.aliyun.com/mirror/centos" target="_blank" rel="noopener noreferrer">阿里 CentOS 镜像<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 配置 <code>yum</code> 源，提高下载速度。</p> <p><a href="https://developer.aliyun.com/mirror/epel" target="_blank" rel="noopener noreferrer">阿里 epel 镜像<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 配置我们常用软件的包，<code>Nginx</code> 也在其中。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 运行一下命令，更新 yum 源</span>
yum clean all
yum makecache
</code></pre></div><p>刷新 <code>yum</code> 仓库信息之后，运行以下命令就可以找到 <code>nginx</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code>yum list <span class="token operator">|</span> <span class="token function">grep</span> nginx
</code></pre></div><p>安装 <code>nginx</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> yum <span class="token function">install</span> nginx
</code></pre></div><p>配置 <code>nginx</code> 开机启动</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> nginx
</code></pre></div><p>启动 <code>nginx</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl start nginx
</code></pre></div><p>检查 <code>nginx</code> 是否启动</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl status nginx
</code></pre></div><p><img src="/blog/20200327220547.png?author=zhangpanqin" alt="image-20200327220547818"></p> <p>如果想查看 <code>nginx</code>包都安装了哪些文件，可以使用</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">rpm</span> <span class="token parameter variable">-qvl</span> nginx
</code></pre></div><p><img src="/blog/20200327221058.png?author=zhangpanqin" alt="image-20200327221058643"></p> <h3 id="nginx-命令"><a href="#nginx-命令" class="header-anchor">#</a> Nginx 命令</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 强制立即关闭，不建议做</span>
nginx <span class="token parameter variable">-s</span> stop

<span class="token comment"># 正常关闭，会处理已经接到的请求，但不会接受新的请求</span>
nginx <span class="token parameter variable">-s</span> quit

<span class="token comment"># 重新加载配置文件</span>
nginx <span class="token parameter variable">-s</span> reload

<span class="token comment">#  重新打开日志文件</span>
nginx <span class="token parameter variable">-s</span> reopen

<span class="token comment"># 检查配置文件是否有误</span>
nginx <span class="token parameter variable">-t</span>

<span class="token comment"># 检查配置文件是否有误，会将配置文件内容打印</span>
nginx <span class="token parameter variable">-T</span>

<span class="token comment"># 查看 nginx 版本</span>
nginx <span class="token parameter variable">-v</span>

<span class="token comment"># 查看 nginx 版本和编译配置致残</span>
nginx <span class="token parameter variable">-V</span>
</code></pre></div><h3 id="系统开启、关闭、重启、查看-nginx-命令"><a href="#系统开启、关闭、重启、查看-nginx-命令" class="header-anchor">#</a> 系统开启、关闭、重启、查看 nginx 命令</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> nginx
<span class="token function">sudo</span> systemctl start nginx
<span class="token function">sudo</span> systemctl restart nginx
<span class="token function">sudo</span> systemctl stop nginx
<span class="token function">sudo</span> systemctl status nginx
</code></pre></div><h2 id="nginx-简单配置"><a href="#nginx-简单配置" class="header-anchor">#</a> Nginx 简单配置</h2> <h3 id="nginx-介绍"><a href="#nginx-介绍" class="header-anchor">#</a> Nginx 介绍</h3> <p>部署的 <code>Nginx</code> 使用一个 <code>master</code> 进程管理多个 <code>worker</code> 进程。<code>master</code> 进程不处理请求，提供管理服务，包括启动、停止、重载配置文件等服务，通常以 <code>root</code> 用户启动， <code>worker</code> 进程进行请求的处理，一般用非管理员账户启用，<code>worker</code> 进程数量和 cpu 核心设置一直，降低进程切换带来的 <code>cpu</code> 切换。</p> <p><img src="/blog/20200327222127.png?author=zhangpanqin" alt="image-20200327222127446"></p> <p><code>http</code> 上下文中的配置是我们重点需要知道的，其余的了解会配置即可。</p> <h3 id="server-配置"><a href="#server-配置" class="header-anchor">#</a> Server 配置</h3> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">include</span> /etc/nginx/mime.types</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">default_type</span> application/octet-stream</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span> <span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span> _</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">root</span> /usr/share/nginx/html</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>Server</code> 既配置一个服务。</p> <p><code>listen 80</code> 用于配置监听 <code>80</code> 端口的服务。</p> <p><code>root</code> 指定静态资源存放的位置。</p> <p>location 进行资源匹配。<code>location / {}</code> 匹配所有的资源。</p> <h3 id="listen-和-server-name-配置"><a href="#listen-和-server-name-配置" class="header-anchor">#</a> <code>listen</code> 和 <code>server_name</code> 配置</h3> <p>匹配规则：</p> <ul><li>先匹配 <code>listen</code> 再匹配 <code>server_name</code></li> <li><code>server_name</code> 匹配请求头中的 <code>Host</code></li> <li>当都没有匹配成功，由配置<code>default_server</code> 的处理</li> <li>以上都没有匹配成功，由第一个配置处理</li></ul> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">9099</span> default_server</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> <span class="token string">&quot;localhost&quot;</span></span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">&quot;server_name 为 localhost&quot;</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">9099</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> 127.0.0.1</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    	<span class="token directive"><span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">&quot;server_name 为 127.0.0.1&quot;</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">9099</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> <span class="token string">&quot;localhost77&quot;</span></span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    	<span class="token directive"><span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">&quot;server_name 为 localhost77&quot;</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在 <code>Postman</code>中设置请求头 <code>Host</code> 模拟访问。</p> <p><code>http://localhost:9099</code> Host:<code>127.0.0.1</code> 返回 <code>server_name 为 127.0.0.1</code></p> <p><code>http://localhost:9099</code> Host:<code>localhost</code> 返回 <code>server_name 为 localhost</code></p> <p><code>http://localhost:9099</code> Host:<code>localhost77</code> 返回 <code>server_name 为 localhost77</code></p> <p><code>http://localhost:9099</code> Host:<code>localhost779</code> 返回 <code>server_name 为 localhost</code></p> <p>再添加一个配置</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> localhost:9099 default_server</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> <span class="token string">&quot;localhost&quot;</span></span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">&quot;server_name 为 localhost:9099&quot;</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当 <code>listen</code> 访问 <code>localhost:9099</code> 的时候，返回 <code>server_name 为 localhost:9099</code> ，因为只有这一个匹配上了。</p> <p>如果想禁止没有 <code>Host</code> 请求头的访问。</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>      <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> <span class="token string">&quot;&quot;</span></span><span class="token punctuation">;</span>
    <span class="token comment"># 表示 nginx 会关闭连接</span>
    <span class="token directive"><span class="token keyword">return</span> <span class="token number">444</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="return-配置"><a href="#return-配置" class="header-anchor">#</a> <code>return</code> 配置</h3> <p><code>return</code> 用于定义返回的状态码，或者内容。</p> <p>介绍 <code>return</code> 主要是为了好描述 <code>location</code> 配置</p> <table><thead><tr><th>-</th> <th>说明</th></tr></thead> <tbody><tr><td>语法</td> <td>return code [text];<br>return code URL;<br>return URL ;</td></tr> <tr><td>默认</td> <td>-</td></tr> <tr><td>上下文</td> <td>server、location、if</td></tr></tbody></table> <p><code>code</code> 为状态码。<code>text</code> 为字符串。</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /a</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">default_type</span> application/json</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">&quot;访问 9088/a&quot;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token comment"># 重定向</span>
<span class="token directive"><span class="token keyword">location</span> = /b</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> http://www.baidu.com</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="location-配置"><a href="#location-配置" class="header-anchor">#</a> <code>location</code> 配置</h3> <p><code>location</code> 用于匹配资源。</p> <p><font color="red">数字越小，优先级越高。</font></p> <table><thead><tr><th>规则符号</th> <th>描述</th> <th>优先级</th></tr></thead> <tbody><tr><td>location <code>=</code> /a{}</td> <td>精准完全匹配，匹配到之后</td> <td>1</td></tr> <tr><td>location <code>^~</code> /a{}</td> <td>前缀匹配，匹配到之后</td> <td>2</td></tr> <tr><td>location ~ /a.*{}</td> <td>正则匹配，区分大小写，检查到之后，还会检查有没有优先级跟高的</td> <td>3</td></tr> <tr><td>location ~_ /a._</td> <td>正则匹配，不区分字母大小写，检查到之后，还会检查有没有优先级跟高的</td> <td>4</td></tr> <tr><td>location /a {}</td> <td>也表示前缀匹配，但是优先级低于 正则匹配。 <code>/a</code> 和 <code>^~/a</code> 会冲突，报错</td> <td>5</td></tr> <tr><td>location / {}</td> <td>任何没有匹配成功的，都会匹配这里处理</td> <td>6</td></tr></tbody></table> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">9088</span> default_server</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">server_name</span> _</span> <span class="token punctuation">;</span>

        <span class="token directive"><span class="token keyword">location</span> = /a</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">default_type</span> application/json</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">&quot;= /a,优先级第一&quot;</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token directive"><span class="token keyword">location</span> ^~ /a</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">default_type</span> application/json</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">&quot;^~ /a 匹配 /a 开头的路径,优先级第二&quot;</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token directive"><span class="token keyword">location</span> ~ /a\.*</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">default_type</span> application/json</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">&quot; /a\.* 匹配 /a...路径,优先级第三&quot;</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token directive"><span class="token keyword">location</span> ~* /a\.*</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">default_type</span> application/json</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">&quot;~* /a\.* 匹配 /a...路径,优先级第四&quot;</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    	<span class="token comment"># /a 会和 ^~ /a 冲突</span>
        <span class="token directive"><span class="token keyword">location</span> /a/</span> <span class="token punctuation">{</span>
            <span class="token directive"><span class="token keyword">default_type</span> application/json</span><span class="token punctuation">;</span>
            <span class="token directive"><span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">&quot;/a/ 匹配 /a/...路径,优先级第五&quot;</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>访问 <code>http://localhost:9088/a</code> ，依次注释优先级较高的，可以验证这个规律。</p> <p>还有一类特殊的 <code>location</code> 用于配置跳转的，以 <code>@</code> 开头</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> @pass</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="add-header-添加响应头"><a href="#add-header-添加响应头" class="header-anchor">#</a> add_header 添加响应头</h3> <table><thead><tr><th>-</th> <th>说明</th></tr></thead> <tbody><tr><td>语法</td> <td>add_header name value [always];</td></tr> <tr><td>默认</td> <td>-</td></tr> <tr><td>上下文</td> <td>http、server、location、location 中的 if</td></tr></tbody></table> <p>如果响应代码等于 200、201、204、206、301、302、303、304、307 或 308，则将指定的字段添加到响应报头中。</p> <p>加上 <code>always</code> 不管什么状态码都加上。</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> ~ /a\.*</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">default_type</span> application/json</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">add_header</span> test1 <span class="token string">&quot;asdfasdf&quot;</span> always</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">&quot; /a\.* 匹配 /a...路径,优先级第三&quot;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="error-page"><a href="#error-page" class="header-anchor">#</a> error_page</h3> <table><thead><tr><th>-</th> <th>说明</th></tr></thead> <tbody><tr><td>语法</td> <td><code>error_page code …[=[response code]] uri;</code></td></tr> <tr><td>默认</td> <td>-</td></tr> <tr><td>上下文</td> <td>http、server、location、location 中的 if</td></tr></tbody></table> <p>配置错误状态码跳转页面。</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">error_page</span> <span class="token number">404</span> /404.html</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">error_page</span> <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span> /50x.html</span><span class="token punctuation">;</span>
</code></pre></div><p>以上不会改变响应状态码。</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token comment"># 改变响应状态吗。</span>
<span class="token directive"><span class="token keyword">error_page</span> <span class="token number">404</span> =200 /404.html</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
       <span class="token directive"><span class="token keyword">error_page</span> <span class="token number">404</span> =  @ops-coffee</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">location</span> @ops-coffee</span> <span class="token punctuation">{</span>
       <span class="token directive"><span class="token keyword">rewrite</span>  .*  / permanent</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="root-和-alias-的区别"><a href="#root-和-alias-的区别" class="header-anchor">#</a> root 和 alias 的区别</h2> <p><code>alias</code> 理解为：路径替换，location 以 <code>/</code> 结尾，alias 必须以 <code>/</code> 结尾。严格匹配。<code>alias</code> 替换掉 <code>location</code> 路径。</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token comment"># /bieming/     替换  /usr/local/var/www/alias2/</span>
<span class="token comment"># 访问 /bieming/1.jpg 去寻找 /usr/local/var/www/alias2/1.jpg</span>
<span class="token directive"><span class="token keyword">location</span> /bieming/</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">alias</span> /usr/local/var/www/alias2/</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>root</code> 理解为：root 路径加上 + <code>location</code> 路径。会将两个或更多个 <code>/</code> 压缩成一个。</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token comment"># 当 location 和 root 路径的最后一部分匹配时，更好的方式是使用 root</span>
<span class="token comment">## 以下配置都可以。</span>
<span class="token comment"># 访问 /data2/1.jpg   去寻找  /usr/local/var/www/data2/1.jpg</span>
<span class="token directive"><span class="token keyword">location</span> /data2/</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">root</span> /usr/local/var/www</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">location</span> /data2/</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">root</span> /usr/local/var/www/</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">location</span> /data2</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">root</span> /usr/local/var/www</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">location</span> /data2</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">root</span> /usr/local/var/www/</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">location</span> /data2/</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">root</span> /usr/local/var/www////</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="内置变量"><a href="#内置变量" class="header-anchor">#</a> 内置变量</h2> <p>通过内置变量，我们可以通过判断请求头、<code>query string</code> 等值来转发或者拒绝访问。</p> <h3 id="arg-name-获取请求参数"><a href="#arg-name-获取请求参数" class="header-anchor">#</a> <code>$arg_name</code> 获取请求参数</h3> <p>获取请求<code>query string</code> 中的 <code>name</code> 参数。</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /arg/</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">default_type</span> application/json</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">&quot;<span class="token variable">$arg_q1</span>&quot;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>/arg/a?q1=334</code> 返回的内容为 <code>334</code>。</p> <h3 id="args-获取请求-query-string-参数"><a href="#args-获取请求-query-string-参数" class="header-anchor">#</a> <code>$args</code> 获取请求 <code>query_string</code> 参数</h3> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /arg/</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">default_type</span> application/json</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">&quot;<span class="token variable">$arg_q1</span> _ <span class="token variable">$args</span>&quot;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>浏览器访问 <code>/arg/a?q1=3334&amp;aa=2&amp;bb=33</code> 返回的内容为 <code>3334 _ q1=3334&amp;aa=2&amp;bb=33</code></p> <h3 id="cookie-name-获取-cookie-的值"><a href="#cookie-name-获取-cookie-的值" class="header-anchor">#</a> <code>$cookie_name</code> 获取 cookie 的值</h3> <p>获取请求中的名称为 <code>name</code> 的 cookie。</p> <h3 id="http-name-获取请求头"><a href="#http-name-获取请求头" class="header-anchor">#</a> <code>$http_name</code> 获取请求头</h3> <p><code>name</code> 为请求头中的字段名称，请求头名称全部小写，并将破折号<code>-</code> 替换为下划线 <code>_</code></p> <p><code>$http_user_agent</code> 获取请求头中的 <code>User-Agent</code> 字段。</p> <h3 id="uri-获取请求路径中的-path"><a href="#uri-获取请求路径中的-path" class="header-anchor">#</a> <code>$uri</code> 获取请求路径中的 <code>path</code></h3> <p><code>path</code> 为端口后面的路径，不包括 <code>query string</code>。优化之后的路径，特殊字符转译及 <code>/</code> 压缩。</p> <p><code>http://localhost:8888/arg/a?q1=q1canshu&amp;bb=2323</code> 中的 <code>path</code> 为 <code>/arg/a</code></p> <h3 id="host-获取请求的-ip"><a href="#host-获取请求的-ip" class="header-anchor">#</a> <code>$host</code> 获取请求的 <code>ip</code></h3> <p>首先会获取请求头 <code>Host</code> ，如果没有请求头中没有 <code>Host</code> 请求头，那么获取的是 <code>url</code> 中的 <code>ip</code>。</p> <h3 id="request-uri-获取-path-和-query-string"><a href="#request-uri-获取-path-和-query-string" class="header-anchor">#</a> <code>$request_uri</code> 获取 <code>path</code> 和 <code>query string</code></h3> <p>访问 <code>http://localhost:8888/arg/a/?q1=q1canshu&amp;bb=2323</code></p> <p><code>$request_uri</code> 为<code>/arg/a/?q1=q1canshu&amp;bb=2323</code></p> <h3 id="scheme-获取请求协议"><a href="#scheme-获取请求协议" class="header-anchor">#</a> <code>$scheme</code> 获取请求协议</h3> <p>值为 <code>http</code> 或 <code>https</code></p> <h3 id="request-method-获取请求方法"><a href="#request-method-获取请求方法" class="header-anchor">#</a> <code>$request_method</code> 获取请求方法</h3> <p>获得的值字母全大写。GET,POST,DELETE,PUT 等</p> <h3 id="其他变量"><a href="#其他变量" class="header-anchor">#</a> 其他变量</h3> <table><thead><tr><th>-</th> <th>描述</th></tr></thead> <tbody><tr><td><code>$content_length</code></td> <td>获取 <code>Content-Length</code> 请求头字段。</td></tr> <tr><td><code>$content_type</code></td> <td>获取 <code>Content-Type</code> 请求头字段</td></tr> <tr><td><code>$https</code></td> <td>如果连接以 SSL 模式运行，则为 on ，否则为空字符串</td></tr> <tr><td><code>$is_args</code></td> <td>如果请求行有参数则为 ? ，否则为空字符串</td></tr> <tr><td><code>$pid</code></td> <td>获取处理当前请求的 <code>worker</code> pid</td></tr> <tr><td><code>$nginx_version</code></td> <td>获取 nginx 的版本</td></tr> <tr><td></td> <td></td></tr></tbody></table> <h2 id="if"><a href="#if" class="header-anchor">#</a> if</h2> <table><thead><tr><th>-</th> <th>说明</th></tr></thead> <tbody><tr><td>语法</td> <td>if (<code>condition</code>){}</td></tr> <tr><td>默认</td> <td>-</td></tr> <tr><td>上下文</td> <td>server、location</td></tr></tbody></table> <p>指定的 condition 求值之后，如果为 true ，则执行在大括号内指定的该模块的指令，并在 if 指令内为该请求分配配置。 if 指令内的配置继承自上一层的配置级别。</p> <p>condition 可以是以下任何一种:</p> <ul><li><p>变量名，如果变量的值为空字符串或 0 ，则为 false</p></li> <li><p>使用 = 和 != 运算符比较变量和字符串</p></li> <li><p>使用 ~ (区分大小写的匹配)和 ~* (不区分大小写的匹配)运算符，变量将与正则表达式进行匹配。正则表达式可以包含可供以后在 <code>$1</code>..<code>$9</code> 变量中重用的捕获。</p></li> <li><p>反操作符 !~ 和 !~* 也可用。如果正则表达式包含 } 或 ; 字符，则整个表达式应使用单引号 或双引号包围起来。</p></li> <li><p>使用 -f 和 !-f 运算符检查文件是否存在</p></li> <li><p>使用 -d 和 !-d 运算符检查目录是否存在</p></li> <li><p>使用 -e 和 !-e 运算符检查文件、目录或符号链接是否存在</p></li> <li><p>使用 -x 和 !-x 运算符检查是否为可执行文件</p></li></ul> <p><font color="red"><code>if</code> 与小括号之间需要有空格</font></p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> = /a</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">default_type</span> application/json</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$request_uri</span> ~* <span class="token string">&quot;/(a).*&quot;</span>)</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">&quot;正则表达式捕获的值:<span class="token variable">$1</span>&quot;</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token directive"><span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">&quot;= /a,优先级第一&quot;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="rewrite"><a href="#rewrite" class="header-anchor">#</a> rewrite</h2> <table><thead><tr><th>-</th> <th>说明</th></tr></thead> <tbody><tr><td>语法</td> <td>rewrite regex replacement [flag];</td></tr> <tr><td>默认</td> <td>-</td></tr> <tr><td>上下文</td> <td>server、location、if</td></tr></tbody></table> <p><code>flag</code> 可选参数：</p> <ul><li>last</li></ul> <p>停止匹配，发送一个新的请求去匹配 <code>location</code>。</p> <ul><li>break</li></ul> <p>停止匹配，在当前 <code>location</code> 去搜索资源。</p> <ul><li>redirect</li></ul> <p>临时重定向。返回状态码 <code>302</code>。</p> <ul><li>permanent</li></ul> <p>永久重定向。返回状态码 <code>301</code> 。</p> <p>指定的 <code>regex</code> 能匹配，uri 将根据 <code>replacement</code> 来处理。</p> <h3 id="验证-break-和-last"><a href="#验证-break-和-last" class="header-anchor">#</a> 验证 break 和 last</h3> <p>以下三张图片都存在，但是内容不一样。</p> <p>/Users/zhangpanqin/stduy_app/break2/test/1.jpg</p> <p>/Users/zhangpanqin/stduy_app/last2/test/1.jpg</p> <p>/Users/zhangpanqin/stduy_app/test/1.jpg</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /break2</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">root</span> /Users/zhangpanqin/stduy_app/break2</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">rewrite</span> /break2/(.*) /test/<span class="token variable">$1</span> break</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">location</span> /last2</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">root</span> /Users/zhangpanqin/stduy_app/last2</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">rewrite</span> /last2/(.*) /test/<span class="token variable">$1</span> last</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">location</span> /test/</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">root</span> /Users/zhangpanqin/stduy_app</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当访问 <code>/break2/1.jpg</code> 实际匹配第一个 <code>location</code>，然后在当前上下文处理 。</p> <p><code>/break2/1.jpg</code> 被替换为 <code>/test/1.jpg</code> 来处理了，然后和 <code>root</code> 指定的路径相结合，返回 <code>/Users/zhangpanqin/stduy_app/break2/test/1.jpg</code> 数据。</p> <p>当访问 <code>/last2/1.jpg</code> ,uri 被替换为 <code>/test/1.jpg</code> 去匹配新的 location 进行处理。</p> <p>返回 <code>/Users/zhangpanqin/stduy_app/test/1.jpg</code> 的内容。</p> <h3 id="验证-redirect-和-permanent"><a href="#验证-redirect-和-permanent" class="header-anchor">#</a> 验证 <code>redirect</code> 和 <code>permanent</code></h3> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /redirect2</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">rewrite</span> ^/redirect2 http://www.baidu.com redirect</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">location</span> /permanent2</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">rewrite</span> ^/permanent2 http://www.baidu.com permanent</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>二者匹配成功之后，都会改变浏览器地址栏地址。浏览器根据响应头 <code>Location</code> 跳转对应地址。</p> <p>二者的区别在于，永久重定向 （<code>permanent</code>），浏览器会保存记录，当再访问 <code>http://localhost:9088/permanent2</code> 而不会询问 <code>nginx</code> 直接跳转。</p> <p>临时重定向，浏览器每次都要询问 <code>nginx</code> 需要跳转到哪里。可以关闭 <code>nginx</code> 就知道验证结果了。</p> <p><img src="/blog/20200328181255.png?author=zhangpanqin" alt="image-20200328181255172"></p> <h2 id="try-files"><a href="#try-files" class="header-anchor">#</a> try_files</h2> <table><thead><tr><th>-</th> <th>说明</th></tr></thead> <tbody><tr><td>语法</td> <td>try_files <code>file … uri;</code><br>try_files <code>file … =code</code>;</td></tr> <tr><td>默认</td> <td>-</td></tr> <tr><td>上下文</td> <td>server、location</td></tr></tbody></table> <p>以指定顺序检查文件是否存在，并使用第一个找到的文件进行请求处理。如果找不到内容内部转发到最后一个参数 <code>uri</code> 。文件位置为 <code>root</code> + <code>file</code>。</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /try/</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">root</span> /usr/local/var/www/data2/data2/</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ @pass2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">location</span> @pass2</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">default_type</span> application/json</span> <span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">&quot;没到到页面代理的数据&quot;</span></span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>访问 <code>/try/1.jpg</code> 时，<code>$uri</code> 为 <code>/try/1.jpg</code> 。</p> <p><code>root</code> + <code>$uri</code> 为 <code>/usr/local/var/www/data2/data2/try/1.jpg</code> 找到返回，没有找到继续匹配返回。都没有匹配内部转发至 <code>@pass2</code>。</p> <p>如想验证跳转使用 <code>/try/test</code> 之类的，不要使用后缀名，因为使用后缀名的话，浏览器会返回<code>content-type</code>，导致内容与解析不一致，图片出不来。</p> <h2 id="配置-gzip"><a href="#配置-gzip" class="header-anchor">#</a> 配置 gzip</h2> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token comment"># 开启 gzip</span>
<span class="token directive"><span class="token keyword">gzip</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>

<span class="token comment"># 在响应头中增加，Vary: Accept-Encoding</span>
<span class="token directive"><span class="token keyword">gzip_vary</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>

<span class="token comment"># gzip压缩级别1-9，数字越大压缩效果越好，压缩所用时间也就越长，占用CPU越高</span>
<span class="token directive"><span class="token keyword">gzip_comp_level</span> <span class="token number">6</span></span><span class="token punctuation">;</span>

<span class="token comment"># 申请内存时大小，如果源文件 9k，超过了 8K，那会申请 16*8K。</span>
<span class="token directive"><span class="token keyword">gzip_buffers</span> <span class="token number">16</span> <span class="token number">8k</span></span><span class="token punctuation">;</span>

<span class="token directive"><span class="token keyword">gzip_min_length</span> <span class="token number">2K</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_proxied</span> any</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_disable</span> <span class="token string">&quot;msie6&quot;</span></span><span class="token punctuation">;</span>

<span class="token directive"><span class="token keyword">gzip_http_version</span> 1.1</span><span class="token punctuation">;</span>

<span class="token comment"># 文本（js、text、css、xml、json）压缩比较好，图片已经进行过压缩，在压缩，效果不是很明显，还浪费 cpu</span>
<span class="token directive"><span class="token keyword">gzip_types</span> text/plain text/css text/xml text/javascript application/javascript application/json application/xml+rss application/rss+xml application/atom+xml image/svg+xml</span><span class="token punctuation">;</span>

</code></pre></div><p>gzip 压缩对文本效果比较好，推荐只对文本之类的压缩。</p> <h2 id="配置缓存"><a href="#配置缓存" class="header-anchor">#</a> 配置缓存</h2> <p>为了减轻服务器压力，节省带宽，可以配置缓存。</p> <p><img src="/blog/20200328185716.png?author=zhangpanqin" alt="image-20200328185715962"></p> <p><code>memory cache</code>:它是将资源文件缓存到内存中，缓存有效直接从内存加载。</p> <p><code>disk cache</code>: 它是将资源文件缓存到硬盘中，缓存有效直接从硬盘中加载。</p> <p>先从 <code>memory cache</code> 找，找不到从 <code>disk cache</code> 找，再找不到，请求网络资源。</p> <p>缓存分为 <code>协商缓存</code> 和 <code>强缓存</code>。</p> <p><code>协商缓存</code> 每次都要去服务器询问缓存是否过期，没有过期使用本地的缓存。</p> <p><code>强缓存</code> 会有缓存过期时间，在有效期内不会去服务端校验缓存，直接使用本地缓存。</p> <p>现在的 <code>webpack</code> 可以根据文件内容的 <code>hash</code> 生产类似 <code>app.asdfa21342.js</code> 这样的文件。其实就是想使用强缓存，当网站更新，新的页面会解析加载不一样的资源，从而降低缓存校验对服务器性能的损耗。</p> <h3 id="协商缓存"><a href="#协商缓存" class="header-anchor">#</a> 协商缓存</h3> <p>协商缓存有：<code>ETag/if-None-Match</code> 和 <code>Last-Modified/if-Modify-Since</code> 两种。</p> <p>http 协议规定，当这两种响应头都存在的时候，必须都要满足，才能使用缓存。</p> <h4 id="etag-if-none-match"><a href="#etag-if-none-match" class="header-anchor">#</a> <code>ETag/if-None-Match</code></h4> <table><thead><tr><th>-</th> <th>说明</th></tr></thead> <tbody><tr><td>语法</td> <td>etag on|off;</td></tr> <tr><td>默认</td> <td>etag on;</td></tr> <tr><td>上下文</td> <td>http、server、location</td></tr></tbody></table> <p><code>nginx</code> 有个 etag 配置属性，会给每个静态资源生成 <code>Etag</code> 响应头，值为文件内容 <code>hash</code>。</p> <p>当浏览器第一次访问资源的时候，返回的响应头中携带 <code>Etag</code> 。</p> <p>后续的正常访问（不强制刷新缓存）相同的资源，都会带上请求头 <code>if-None-Match</code> ,值为 <code>Etag</code> 去 <code>nginx</code> 校验是否一样，一样说明缓存没有过期，返回状态码 <code>304</code>，直接访问浏览器中的缓存，否则从浏览器返回资源，返回状态码 200。</p> <h3 id="last-modified-if-modify-since"><a href="#last-modified-if-modify-since" class="header-anchor">#</a> <code>Last-Modified/if-Modify-Since</code></h3> <table><thead><tr><th>-</th> <th>说明</th></tr></thead> <tbody><tr><td>语法</td> <td>if_modified_since off|exact|before;</td></tr> <tr><td>默认</td> <td>if_modified_since exact；</td></tr> <tr><td>上下文</td> <td>http、server、location</td></tr></tbody></table> <p>指定如何比较文件的修改时间与请求头 <strong>If-Modified-Since</strong> 进行比较:</p> <ul><li>off</li></ul> <p>忽略 <strong>If-Modified-Since</strong> 请求头字段(0.7.34)</p> <ul><li>exact</li></ul> <p>完全匹配</p> <ul><li>before</li></ul> <p>资源的修改时间小于或等于 <strong>If-Modified-Since</strong> 请求头字段中的时间</p> <p>浏览器第一次访问一个资源的时候，响应头 <code>Last-Modified</code> 返回，标识文件的最后修改时间。</p> <p>当浏览器再次正常访问（不强制刷新资源）相同资源，请求头会加上 <code>If-Modified-Since</code>，该值为之前返回的 <code>Last-Modified</code> 。<code>nginx</code> 收到 <code>If-Modified-Since</code> 后，根据配置 <code>if_modified_since</code> 属性比较资源的最后修改时间(<code>Last-Modified</code>)和该值<code>If-Modified-Since</code>进行比较，匹配成功，则命中缓存，返回 304，否则返回 资源，状态码为 200，并更新缓存时间。</p> <h3 id="强制缓存"><a href="#强制缓存" class="header-anchor">#</a> 强制缓存</h3> <h4 id="expires"><a href="#expires" class="header-anchor">#</a> Expires</h4> <p><code>Expires</code> 是 <code>http1.0</code> 的规范，它的值是一个绝对时间的 GMT 格式的时间字符串。这个时间代表的该资源的失效时间，如果在该时间之前请求的话，则都是从缓存里面读取的。如果服务端和客户端时区不一致会导致判断不准确。</p> <h4 id="cache-control"><a href="#cache-control" class="header-anchor">#</a> Cache-Control</h4> <p><code>Cache-Control</code> 是 <code>http1.1</code> 的规范，它是利用该字段 <code>max-age</code> 值进行判断的。该值是一个相对时间，比如 <code>Cache-Control: max-age=3600</code> 代表该资源的有效期是 3600 秒。除了该字段外，我们还有如下字段可以设置：</p> <p><strong>no-cache:</strong> 需要进行协商缓存，发送请求到服务器确认是否使用缓存。</p> <p>**no-store：**禁止使用缓存，每一次都要重新请求数据。</p> <p>**public：**可以被所有的用户缓存，包括终端用户和 CDN 等中间代理服务器。</p> <p>**private：**只能被终端用户的浏览器缓存，不允许 CDN 等中继缓存服务器对其缓存。</p> <h3 id="配置缓存-2"><a href="#配置缓存-2" class="header-anchor">#</a> 配置缓存</h3> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> ~* \.(css|js|png|jpg|jpeg|gif|gz|svg|mp4|mp3|ogg|ogv|webm|htc|xml|woff)$</span> <span class="token punctuation">{</span>
    <span class="token comment"># 关闭访问日志记录</span>
    <span class="token directive"><span class="token keyword">access_log</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
    <span class="token comment"># 强缓存，时间为一年，浏览器和 cdn 中间件可以缓存</span>
    <span class="token directive"><span class="token keyword">add_header</span> Cache-Control <span class="token string">&quot;max-age=31536000&quot;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="推荐资料"><a href="#推荐资料" class="header-anchor">#</a> 推荐资料</h2> <p><a href="https://github.com/DocsHome/nginx-docs" target="_blank" rel="noopener noreferrer">nginx 中文翻译<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/zhangpanqin/mflyyou/edit/main/docs/devops/nginx/nginx-base.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/10/29 上午7:32:10</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
            ←
            <a href="/mflyyou/devops/auth0/auth0.html" class="prev">
                auth0
            </a></span> <span class="next"><a href="/mflyyou/devops/nginx/nginx-config.html">
                Nginx-性能优化
            </a>
            →
        </span></p></div> </main> <aside class="right-sidebar"> <div class="right-sidebar-toc-container" style="display:;"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="max-height:650px"><div style="font-weight:bold;text-align:center;">Nginx-包教包会-入门</div> <hr> <div class="toc-box"><ul><li><a href="/mflyyou/devops/nginx/nginx-base.html#前言" class="toc-sidebar-link">前言</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/mflyyou/devops/nginx/nginx-base.html#nginx-安装" class="toc-sidebar-link">Nginx 安装</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#docker" class="toc-sidebar-link">docker</a></li><li class="toc-sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#nginx-安装步骤" class="toc-sidebar-link">Nginx 安装步骤</a></li><li class="toc-sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#nginx-命令" class="toc-sidebar-link">Nginx 命令</a></li><li class="toc-sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#系统开启、关闭、重启、查看-nginx-命令" class="toc-sidebar-link">系统开启、关闭、重启、查看 nginx 命令</a></li></ul></li><li><a href="/mflyyou/devops/nginx/nginx-base.html#nginx-简单配置" class="toc-sidebar-link">Nginx 简单配置</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#nginx-介绍" class="toc-sidebar-link">Nginx 介绍</a></li><li class="toc-sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#server-配置" class="toc-sidebar-link">Server 配置</a></li><li class="toc-sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#listen-和-server-name-配置" class="toc-sidebar-link">listen 和 server_name 配置</a></li><li class="toc-sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#return-配置" class="toc-sidebar-link">return 配置</a></li><li class="toc-sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#location-配置" class="toc-sidebar-link">location 配置</a></li><li class="toc-sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#add-header-添加响应头" class="toc-sidebar-link">add_header 添加响应头</a></li><li class="toc-sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#error-page" class="toc-sidebar-link">error_page</a></li></ul></li><li><a href="/mflyyou/devops/nginx/nginx-base.html#root-和-alias-的区别" class="toc-sidebar-link">root 和 alias 的区别</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/mflyyou/devops/nginx/nginx-base.html#内置变量" class="toc-sidebar-link">内置变量</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#arg-name-获取请求参数" class="toc-sidebar-link">$arg_name 获取请求参数</a></li><li class="toc-sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#args-获取请求-query-string-参数" class="toc-sidebar-link">$args 获取请求 query_string 参数</a></li><li class="toc-sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#cookie-name-获取-cookie-的值" class="toc-sidebar-link">$cookie_name 获取 cookie 的值</a></li><li class="toc-sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#http-name-获取请求头" class="toc-sidebar-link">$http_name 获取请求头</a></li><li class="toc-sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#uri-获取请求路径中的-path" class="toc-sidebar-link">$uri 获取请求路径中的 path</a></li><li class="toc-sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#host-获取请求的-ip" class="toc-sidebar-link">$host 获取请求的 ip</a></li><li class="toc-sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#request-uri-获取-path-和-query-string" class="toc-sidebar-link">$request_uri 获取 path 和 query string</a></li><li class="toc-sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#scheme-获取请求协议" class="toc-sidebar-link">$scheme 获取请求协议</a></li><li class="toc-sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#request-method-获取请求方法" class="toc-sidebar-link">$request_method 获取请求方法</a></li><li class="toc-sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#其他变量" class="toc-sidebar-link">其他变量</a></li></ul></li><li><a href="/mflyyou/devops/nginx/nginx-base.html#if" class="toc-sidebar-link">if</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/mflyyou/devops/nginx/nginx-base.html#rewrite" class="toc-sidebar-link">rewrite</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#验证-break-和-last" class="toc-sidebar-link">验证 break 和 last</a></li><li class="toc-sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#验证-redirect-和-permanent" class="toc-sidebar-link">验证 redirect 和 permanent</a></li></ul></li><li><a href="/mflyyou/devops/nginx/nginx-base.html#try-files" class="toc-sidebar-link">try_files</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/mflyyou/devops/nginx/nginx-base.html#配置-gzip" class="toc-sidebar-link">配置 gzip</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/mflyyou/devops/nginx/nginx-base.html#配置缓存" class="toc-sidebar-link">配置缓存</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#协商缓存" class="toc-sidebar-link">协商缓存</a></li><li class="toc-sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#last-modified-if-modify-since" class="toc-sidebar-link">Last-Modified/if-Modify-Since</a></li><li class="toc-sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#强制缓存" class="toc-sidebar-link">强制缓存</a></li><li class="toc-sidebar-sub-header"><a href="/mflyyou/devops/nginx/nginx-base.html#配置缓存-2" class="toc-sidebar-link">配置缓存</a></li></ul></li><li><a href="/mflyyou/devops/nginx/nginx-base.html#推荐资料" class="toc-sidebar-link">推荐资料</a><ul class="toc-sidebar-sub-headers"></ul></li></ul></div></div></div></div> <div class="right-sidebar-toolbar"><div class="option-box"><img src="/mflyyou/images/system/toc.png" class="nozoom"> <span class="show-txt">目录</span></div> <div class="option-box"><img src="/mflyyou/images/system/toggle.png" width="30px" class="nozoom"> <span class="show-txt">左栏</span></div> <div title="auth0" class="option-box" style="padding-left:2px;text-align:center;"><a href="/mflyyou/devops/auth0/auth0.html"><img src="/mflyyou/images/system/pre2.png" width="30px" class="nozoom"> <span class="show-txt">上一篇</span></a></div> <div title="Nginx-性能优化" class="option-box" style="padding-left:2px;text-align:center;"><a href="/mflyyou/devops/nginx/nginx-config.html"><img src="/mflyyou/images/system/next2.png" width="30px" class="nozoom"> <span class="show-txt">下一篇</span></a></div></div> </aside></div><div class="global-ui"><!----><!----></div></div>
    <script src="/mflyyou/assets/js/app.0c7751fa.js" defer></script><script src="/mflyyou/assets/js/4.ec17e064.js" defer></script><script src="/mflyyou/assets/js/2.2ab84419.js" defer></script><script src="/mflyyou/assets/js/58.c2817095.js" defer></script><script src="/mflyyou/assets/js/12.60b8c9aa.js" defer></script>
  </body>
</html>
