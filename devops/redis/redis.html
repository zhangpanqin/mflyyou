<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis 基础 | Mflyyou</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="张攀钦的笔记">
    <meta name="theme-color" content="#3eaf7c">
    
    <link rel="preload" href="/assets/css/0.styles.0ce27dc8.css" as="style"><link rel="preload" href="/assets/js/app.9c738e22.js" as="script"><link rel="preload" href="/assets/js/5.d7d91d51.js" as="script"><link rel="preload" href="/assets/js/2.b39c8659.js" as="script"><link rel="preload" href="/assets/js/58.226ffcf8.js" as="script"><link rel="preload" href="/assets/js/12.f541f4fc.js" as="script"><link rel="prefetch" href="/assets/js/10.e5461b55.js"><link rel="prefetch" href="/assets/js/100.3490c361.js"><link rel="prefetch" href="/assets/js/101.90897d79.js"><link rel="prefetch" href="/assets/js/102.7e15a7fc.js"><link rel="prefetch" href="/assets/js/103.b6c665a9.js"><link rel="prefetch" href="/assets/js/104.0e16d364.js"><link rel="prefetch" href="/assets/js/105.89f12048.js"><link rel="prefetch" href="/assets/js/106.ed42c248.js"><link rel="prefetch" href="/assets/js/107.90a1e141.js"><link rel="prefetch" href="/assets/js/11.c24f71e1.js"><link rel="prefetch" href="/assets/js/13.292b3dc0.js"><link rel="prefetch" href="/assets/js/14.328aef54.js"><link rel="prefetch" href="/assets/js/15.20a5d623.js"><link rel="prefetch" href="/assets/js/16.9a1b1d52.js"><link rel="prefetch" href="/assets/js/17.bbbd60af.js"><link rel="prefetch" href="/assets/js/18.cf53d413.js"><link rel="prefetch" href="/assets/js/19.7791a9d1.js"><link rel="prefetch" href="/assets/js/20.b43eb0fe.js"><link rel="prefetch" href="/assets/js/21.822a150c.js"><link rel="prefetch" href="/assets/js/22.87af96d4.js"><link rel="prefetch" href="/assets/js/23.d8429f7e.js"><link rel="prefetch" href="/assets/js/24.c149f3bf.js"><link rel="prefetch" href="/assets/js/25.5076bc49.js"><link rel="prefetch" href="/assets/js/26.d4f4d788.js"><link rel="prefetch" href="/assets/js/27.661abd00.js"><link rel="prefetch" href="/assets/js/28.4ae2ddf6.js"><link rel="prefetch" href="/assets/js/29.4f596617.js"><link rel="prefetch" href="/assets/js/3.8ea3c871.js"><link rel="prefetch" href="/assets/js/30.6f817645.js"><link rel="prefetch" href="/assets/js/31.55c0b5e7.js"><link rel="prefetch" href="/assets/js/32.2e1e1c83.js"><link rel="prefetch" href="/assets/js/33.81fb6b8c.js"><link rel="prefetch" href="/assets/js/34.56e28f54.js"><link rel="prefetch" href="/assets/js/35.58ac1652.js"><link rel="prefetch" href="/assets/js/36.28f9e13b.js"><link rel="prefetch" href="/assets/js/37.7e8787f0.js"><link rel="prefetch" href="/assets/js/38.1c6604cf.js"><link rel="prefetch" href="/assets/js/39.c592b5d6.js"><link rel="prefetch" href="/assets/js/4.b62e87ad.js"><link rel="prefetch" href="/assets/js/40.599627fa.js"><link rel="prefetch" href="/assets/js/41.327046cb.js"><link rel="prefetch" href="/assets/js/42.125084ca.js"><link rel="prefetch" href="/assets/js/43.88f678cd.js"><link rel="prefetch" href="/assets/js/44.591acf3e.js"><link rel="prefetch" href="/assets/js/45.b37ea644.js"><link rel="prefetch" href="/assets/js/46.f2914a2c.js"><link rel="prefetch" href="/assets/js/47.e546f1fe.js"><link rel="prefetch" href="/assets/js/48.d63a45e9.js"><link rel="prefetch" href="/assets/js/49.6c7410e0.js"><link rel="prefetch" href="/assets/js/50.7a601422.js"><link rel="prefetch" href="/assets/js/51.5da575af.js"><link rel="prefetch" href="/assets/js/52.f23e290f.js"><link rel="prefetch" href="/assets/js/53.29ddc121.js"><link rel="prefetch" href="/assets/js/54.6ea6b517.js"><link rel="prefetch" href="/assets/js/55.7fcc929f.js"><link rel="prefetch" href="/assets/js/56.acd67e84.js"><link rel="prefetch" href="/assets/js/57.2b21a6dc.js"><link rel="prefetch" href="/assets/js/59.8206dd59.js"><link rel="prefetch" href="/assets/js/6.84fce9e4.js"><link rel="prefetch" href="/assets/js/60.26885fe4.js"><link rel="prefetch" href="/assets/js/61.8ba2c72b.js"><link rel="prefetch" href="/assets/js/62.6b7d3854.js"><link rel="prefetch" href="/assets/js/63.9fe5988b.js"><link rel="prefetch" href="/assets/js/64.dabd8eb8.js"><link rel="prefetch" href="/assets/js/65.44942790.js"><link rel="prefetch" href="/assets/js/66.7dc8841f.js"><link rel="prefetch" href="/assets/js/67.fc608ac2.js"><link rel="prefetch" href="/assets/js/68.e32a29b9.js"><link rel="prefetch" href="/assets/js/69.42e57921.js"><link rel="prefetch" href="/assets/js/7.61e728e7.js"><link rel="prefetch" href="/assets/js/70.3a1a3cc4.js"><link rel="prefetch" href="/assets/js/71.9580df82.js"><link rel="prefetch" href="/assets/js/72.1fac3cfa.js"><link rel="prefetch" href="/assets/js/73.82306fb5.js"><link rel="prefetch" href="/assets/js/74.4d712aa5.js"><link rel="prefetch" href="/assets/js/75.7723ec29.js"><link rel="prefetch" href="/assets/js/76.7cb20053.js"><link rel="prefetch" href="/assets/js/77.de06768e.js"><link rel="prefetch" href="/assets/js/78.181605c1.js"><link rel="prefetch" href="/assets/js/79.45fc3e67.js"><link rel="prefetch" href="/assets/js/8.73fb4fdb.js"><link rel="prefetch" href="/assets/js/80.41f225d9.js"><link rel="prefetch" href="/assets/js/81.42b90d35.js"><link rel="prefetch" href="/assets/js/82.5f3f1ae0.js"><link rel="prefetch" href="/assets/js/83.f11de907.js"><link rel="prefetch" href="/assets/js/84.171117c9.js"><link rel="prefetch" href="/assets/js/85.45679a8c.js"><link rel="prefetch" href="/assets/js/86.0b2c0892.js"><link rel="prefetch" href="/assets/js/87.1dfea553.js"><link rel="prefetch" href="/assets/js/88.d5315b5e.js"><link rel="prefetch" href="/assets/js/89.9fedf186.js"><link rel="prefetch" href="/assets/js/9.c10ddd06.js"><link rel="prefetch" href="/assets/js/90.1127319d.js"><link rel="prefetch" href="/assets/js/91.6cd1dd96.js"><link rel="prefetch" href="/assets/js/92.a91caf05.js"><link rel="prefetch" href="/assets/js/93.1f7509ae.js"><link rel="prefetch" href="/assets/js/94.379c339c.js"><link rel="prefetch" href="/assets/js/95.f95521d3.js"><link rel="prefetch" href="/assets/js/96.1fb9b247.js"><link rel="prefetch" href="/assets/js/97.a59710ef.js"><link rel="prefetch" href="/assets/js/98.04c44729.js"><link rel="prefetch" href="/assets/js/99.12276902.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0ce27dc8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Mflyyou</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/java/base/java-messy-code.html" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/go/base/go-command.html" class="nav-link">
  Go
</a></div><div class="nav-item"><a href="/springboot/project-sumary/" class="nav-link">
  SpringBoot
</a></div><div class="nav-item"><a href="/tcp-ip/http/http-cors-jsonp/" class="nav-link">
  TCP/IP
</a></div><div class="nav-item"><a href="/dev-tools/asdf/" class="nav-link">
  开发工具
</a></div><div class="nav-item"><a href="/devops/docker/" class="nav-link">
  DevOps
</a></div> <a href="https://github.com/zhangpanqin/mflyyou" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/java/base/java-messy-code.html" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/go/base/go-command.html" class="nav-link">
  Go
</a></div><div class="nav-item"><a href="/springboot/project-sumary/" class="nav-link">
  SpringBoot
</a></div><div class="nav-item"><a href="/tcp-ip/http/http-cors-jsonp/" class="nav-link">
  TCP/IP
</a></div><div class="nav-item"><a href="/dev-tools/asdf/" class="nav-link">
  开发工具
</a></div><div class="nav-item"><a href="/devops/docker/" class="nav-link">
  DevOps
</a></div> <a href="https://github.com/zhangpanqin/mflyyou" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Docker</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/devops/docker/" class="sidebar-link">Docker</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Terraform</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/devops/terraform/" class="sidebar-link">Terraform</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>AWS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/devops/aws/" class="sidebar-link">Aws</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Linux</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/devops/linux/linux-base.html" class="sidebar-link">Linux 基础</a></li><li><a href="/devops/linux/vim.html" class="sidebar-link">Vim</a></li><li><a href="/devops/linux/ssh.html" class="sidebar-link">SSH</a></li><li><a href="/devops/linux/redirect-pipeline.html" class="sidebar-link">重定向和管道流</a></li><li><a href="/devops/linux/debian.html" class="sidebar-link">Debian</a></li><li><a href="/devops/linux/shell-base.html" class="sidebar-link">shell 基础</a></li><li><a href="/devops/linux/shell-example.html" class="sidebar-link">实用的 shell 列子</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>auth0</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/devops/auth0/auth0.html" class="sidebar-link">auth0</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Nginx</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/devops/nginx/nginx-base.html" class="sidebar-link">Nginx-包教包会-入门</a></li><li><a href="/devops/nginx/nginx-config.html" class="sidebar-link">Nginx-性能优化</a></li><li><a href="/devops/nginx/nginx-performance.html" class="sidebar-link">Nginx-包教包会-进阶</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>数据库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>Mysql</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/devops/database/mysql/" class="sidebar-link">Mysql 基础</a></li><li><a href="/devops/database/mysql/mysql-arch.html" class="sidebar-link">Mysql 架构</a></li><li><a href="/devops/database/mysql/mysql-index.html" class="sidebar-link">Mysql索引</a></li><li><a href="/devops/database/mysql/mysql-lock-and-transaction.html" class="sidebar-link">Mysql 事务和锁</a></li><li><a href="/devops/database/mysql/mysql-explain.html" class="sidebar-link">Explain 查看执行计划</a></li><li><a href="/devops/database/mysql/mysql-limit.html" class="sidebar-link">Mysql Limit 限制</a></li><li><a href="/devops/database/mysql/mysql-data-types.html" class="sidebar-link">Mysql 数据类型</a></li><li><a href="/devops/database/mysql/mysql-account-management.html" class="sidebar-link">Mysql 用户权限管理</a></li><li><a href="/devops/database/mysql/mysql-backup-recovery.html" class="sidebar-link">Mysql数据备份与恢复</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>PostgreSql</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/devops/database/postgresql/postgresql.html" class="sidebar-link">PostgreSQL 基础</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Elasticsearch</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/devops/elasticsearch/es.html" class="sidebar-link">Elasticsearch</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Redis</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/devops/redis/redis.html" aria-current="page" class="active sidebar-link">Redis 基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/devops/redis/redis.html#高级数据类型" class="sidebar-link">高级数据类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/devops/redis/redis.html#位图-bitmap" class="sidebar-link">位图 Bitmap</a></li><li class="sidebar-sub-header"><a href="/devops/redis/redis.html#hyperloglog" class="sidebar-link">HyperLogLog</a></li><li class="sidebar-sub-header"><a href="/devops/redis/redis.html#布隆过滤器" class="sidebar-link">布隆过滤器</a></li><li class="sidebar-sub-header"><a href="/devops/redis/redis.html#geohash" class="sidebar-link">GeoHash</a></li></ul></li><li class="sidebar-sub-header"><a href="/devops/redis/redis.html#功能" class="sidebar-link">功能</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/devops/redis/redis.html#pipeline" class="sidebar-link">pipeline</a></li><li class="sidebar-sub-header"><a href="/devops/redis/redis.html#发布订阅" class="sidebar-link">发布订阅</a></li></ul></li><li class="sidebar-sub-header"><a href="/devops/redis/redis.html#redis-持久化" class="sidebar-link">Redis 持久化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/devops/redis/redis.html#rdb" class="sidebar-link">RDB</a></li><li class="sidebar-sub-header"><a href="/devops/redis/redis.html#aof" class="sidebar-link">AOF</a></li><li class="sidebar-sub-header"><a href="/devops/redis/redis.html#rdb-和-aof-配置" class="sidebar-link">RDB 和 AOF 配置</a></li><li class="sidebar-sub-header"><a href="/devops/redis/redis.html#docker" class="sidebar-link">Docker</a></li></ul></li><li class="sidebar-sub-header"><a href="/devops/redis/redis.html#运维优化" class="sidebar-link">运维优化</a></li><li class="sidebar-sub-header"><a href="/devops/redis/redis.html#哨兵模式" class="sidebar-link">哨兵模式</a></li><li class="sidebar-sub-header"><a href="/devops/redis/redis.html#redis-cluster-集群模式" class="sidebar-link">redis cluster 集群模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/devops/redis/redis.html#集群步骤" class="sidebar-link">集群步骤</a></li><li class="sidebar-sub-header"><a href="/devops/redis/redis.html#配置文件" class="sidebar-link">配置文件</a></li><li class="sidebar-sub-header"><a href="/devops/redis/redis.html#命令创建集群关系" class="sidebar-link">命令创建集群关系</a></li><li class="sidebar-sub-header"><a href="/devops/redis/redis.html#数据迁移" class="sidebar-link">数据迁移</a></li><li class="sidebar-sub-header"><a href="/devops/redis/redis.html#集群模式使用" class="sidebar-link">集群模式使用</a></li><li class="sidebar-sub-header"><a href="/devops/redis/redis.html#重定向" class="sidebar-link">重定向</a></li><li class="sidebar-sub-header"><a href="/devops/redis/redis.html#故障转移" class="sidebar-link">故障转移</a></li></ul></li><li class="sidebar-sub-header"><a href="/devops/redis/redis.html#redis-慢查询" class="sidebar-link">Redis 慢查询</a></li><li class="sidebar-sub-header"><a href="/devops/redis/redis.html#redisson" class="sidebar-link">Redisson</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/devops/vue/vue-depoly.html" class="sidebar-link">你不知道的 SpringBoot 与 Vue 部署解决方案</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="基础数据类型"><a href="#基础数据类型" class="header-anchor">#</a> 基础数据类型</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 查看 key 属于那种数据类型</span>
<span class="token builtin class-name">type</span> key
<span class="token comment"># 设置 key 多少秒过期，过期的 key 会被 rendis 自动删除</span>
expire key seconds

<span class="token comment"># 设置 name1 5 秒后过期</span>
expire name1 <span class="token number">5</span>

<span class="token comment">#</span>
del

<span class="token comment"># 查看 key 还有多长时间过期</span>
tll key
</code></pre></div><h4 id="string"><a href="#string" class="header-anchor">#</a> string</h4> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 设置某个 key 的值是 value</span>
<span class="token builtin class-name">set</span> key value
<span class="token builtin class-name">set</span> name1 zhangsan

<span class="token comment"># 获取某个 key 的值</span>
get key
get name1

<span class="token comment"># 批量设置值</span>
mset key1 value1 key2 value2
mset name1 zhangsan name2 lisi

<span class="token comment"># 批量获取某些 key 的值</span>
mget key1 key2
mget key1 key2

<span class="token comment"># 设置 key 多少秒后过期，等价于 set+expire</span>
setex key seconds value
setex name1 <span class="token number">5</span> zhangsan

<span class="token comment"># 当 key 不存在的时候创建</span>
setnx key value

<span class="token comment"># 对值是数字的 key 进行计数操作</span>
<span class="token builtin class-name">set</span> age <span class="token number">30</span>

<span class="token comment"># age +1</span>
incr age

<span class="token comment"># 对 age 加 5</span>
incriby age <span class="token number">5</span>
</code></pre></div><h4 id="hash"><a href="#hash" class="header-anchor">#</a> hash</h4> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 类似 Map</span>
hset key field value
hset person name1 zhangsan

<span class="token comment"># 获取值</span>
hget key field
hget person name1

<span class="token comment"># 获取 key 的所有 field value</span>
hgetall person

<span class="token comment"># 获取 key 的 field 个数</span>
hlen person

<span class="token comment"># 批量设置 key 的 field value</span>
hmset key field1 value1 field2 value2
hmset person name1 zhangsan name2 lisi

<span class="token comment"># 对 field 的 value 进行加 1 操作</span>
hincrby key field increment
hset book3 age <span class="token number">3</span>
<span class="token comment"># 对 age 的值加5</span>
hincrby book3 age <span class="token number">5</span>
<span class="token comment"># 得到 8</span>
hget book3 age
</code></pre></div><h4 id="list"><a href="#list" class="header-anchor">#</a> list</h4> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 列表</span>

<span class="token comment"># 从列表的右边依次推进 值</span>
rpush key value1 value2 value3

<span class="token comment"># 返回列表长度</span>
llen key

<span class="token comment"># 左边弹出一个元素</span>
lpop key

<span class="token comment"># 右边弹出一个元素</span>
rpop key

<span class="token comment"># 获取索引位置的value o(n) 级别</span>
lindex key index

<span class="token comment"># 将范围内的元素保留下来，其余删除 o(n)</span>
ltrim key start end

<span class="token comment"># 获取范围的 value,index 为 -1 时标记获取最后一个元素位置  o(n)</span>
lrange key start end
</code></pre></div><h4 id="set"><a href="#set" class="header-anchor">#</a> set</h4> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 往 set 中添加成员</span>
sadd key member
<span class="token comment"># 返回添加成功的个数，返回 3</span>
sadd test2 <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span>
<span class="token comment"># 返回 0</span>
sadd test2 <span class="token number">3</span>

<span class="token comment"># 获取 key 所有的成员</span>
smembers key

<span class="token comment"># 判断某个 value 是否存在</span>
sismember key value

<span class="token comment"># 获取有多少个 member</span>
scard key
scard test2

<span class="token comment"># 弹出一个 member</span>
spop key count
<span class="token comment"># 将 test2 中弹出两个 member</span>
spop test2 <span class="token number">2</span>
</code></pre></div><h4 id="zset"><a href="#zset" class="header-anchor">#</a> zset</h4> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 设置成员的分数</span>
zadd key score member

<span class="token comment"># 获取指定索引范围的数据</span>
zrange key start end

<span class="token comment"># 逆序获取指定索引的数据</span>
zrevrange key start end

<span class="token comment"># 获取 key 中 member 的数量</span>
zcard key

<span class="token comment"># 获取排名，排名从 0 开始</span>
zrank key member

<span class="token comment"># 根据分值获取 member</span>
zrangebyscore book5 <span class="token number">8</span> <span class="token number">10</span>

<span class="token comment"># 删除 member</span>
zrem key member
</code></pre></div><h2 id="高级数据类型"><a href="#高级数据类型" class="header-anchor">#</a> 高级数据类型</h2> <h3 id="位图-bitmap"><a href="#位图-bitmap" class="header-anchor">#</a> 位图 Bitmap</h3> <p>可以用于统计数据</p> <p>比如说签到，一年 365 天，365 bit 就可以记录一个人的签到</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 注意偏移量太大，可能会耗内存</span>
setbit key offset value
getbit key offset
bitcount key <span class="token punctuation">[</span>start end<span class="token punctuation">]</span>

<span class="token comment"># 对多个 Bitmap 的 and(交集)/or（并集）/not（非）/xor（异或） 操作病将结果保存在 destkey</span>
bitop <span class="token function">op</span> destkey key <span class="token punctuation">[</span>key<span class="token punctuation">..</span>.<span class="token punctuation">]</span>
</code></pre></div><h3 id="hyperloglog"><a href="#hyperloglog" class="header-anchor">#</a> HyperLogLog</h3> <p>实质是字符串，利用算法。常用统计，统计误差 0.81%，占用 12KB</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 添加元素</span>
pfadd key element

<span class="token comment"># 统计 key 数量</span>
pfcount key

<span class="token comment"># 将多个 sourcekey 合并到目标 key</span>
pfmerge destkey sourcekey
</code></pre></div><h3 id="布隆过滤器"><a href="#布隆过滤器" class="header-anchor">#</a> 布隆过滤器</h3> <h3 id="geohash"><a href="#geohash" class="header-anchor">#</a> GeoHash</h3> <p>存储经纬度。底层 zset</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 添加多个经纬度</span>
geoadd key longitude latitude member <span class="token punctuation">[</span>longitude latitude member<span class="token punctuation">]</span>

<span class="token comment"># 获取 member 的经纬度</span>
geopos key member <span class="token punctuation">[</span>member <span class="token punctuation">..</span>.<span class="token punctuation">]</span>

<span class="token comment"># 获取两个经纬度之间的距离，可以指定单位 unit:m(米)，km(千米)，mi(英里)，ft(尺)</span>
geodist key member1 member2 <span class="token punctuation">[</span>unit<span class="token punctuation">]</span>

</code></pre></div><h2 id="功能"><a href="#功能" class="header-anchor">#</a> 功能</h2> <h3 id="pipeline"><a href="#pipeline" class="header-anchor">#</a> pipeline</h3> <p>n 次时间 =n 次网络时间+n 次命令时间</p> <p>pipeline 可以将一批命令，发送 redis，返回对应命令结果</p> <p>1 次 pipeline 时间=1 次网络时间+n 次命令时间</p> <p>注意 pipeline 携带的数据量</p> <h3 id="发布订阅"><a href="#发布订阅" class="header-anchor">#</a> 发布订阅</h3> <p>发布者，订阅者，频道</p> <p>没有消息堆积的能力。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 发布消息</span>
publish
publish sohu:tv <span class="token string">&quot;hello world&quot;</span>

<span class="token comment"># 订阅消息</span>
subscribe
subcribe sohu:tv

<span class="token comment"># 取消订阅</span>
unsubscribe
unsubcribe sohu:tv

<span class="token comment"># 根据正则订阅频道</span>
psubscribe

<span class="token comment"># 根据正则取消订阅</span>
punsubcribe
</code></pre></div><h2 id="redis-持久化"><a href="#redis-持久化" class="header-anchor">#</a> Redis 持久化</h2> <h3 id="rdb"><a href="#rdb" class="header-anchor">#</a> RDB</h3> <p>通过命令此时 Redis 快照保存 RDB 文件中。</p> <p>save 命令同步保存快照数据，生成 RDB 文件，其余命令要排队等待 save 执行成功。考虑阻塞问题。新数据文件替换旧的数据。</p> <p>bgsave 命令异步保存数据。使用 fork 生成一个子进程，用于生成 RDB 文件，不会阻塞客户端命令。新文件替换旧文件。</p> <p>也支持自动配置条件触发。多少秒触发数据改变会触发 bgsave。</p> <p>rdb 文件命名 dump-${port}.rdb</p> <p>dir 指定文件储存位置。</p> <p>RDB 缺点：耗时，会丢失数据。fork() 产生子进程，会占用内存。</p> <h3 id="aof"><a href="#aof" class="header-anchor">#</a> AOF</h3> <p>将执行命令写入到 aof 命令。</p> <p>将命令根据写入策略写入（fsync）到缓存区中。</p> <ul><li>always 每条命令都会写入到 aof 文件中。不丢失数据。</li> <li>everysec 每秒把缓冲区 中的记录命令写入到 aof 文件。主进程会阻塞命令执行，将需要写入的命令刷盘。</li> <li>no 由系统调用。不使用这个。</li></ul> <p><img src="/blog/20201005231659.png?author=zhangpanqin" alt="image-20200215035830345"></p> <ul><li><p>bgrewriteaof fork 子进程对当前内存数据进行分析然后重写 aof 文件，而不是整理 aof 文件。</p> <p><img src="/blog/20201005231706.png?author=zhangpanqin" alt="image-20200215040332598"></p></li></ul> <div class="language-txt extra-class"><pre class="language-txt"><code>appendonly yes
appendfilename appendonly-${port}.aof
appendfsync everysec
</code></pre></div><p><img src="/blog/20201005231712.png?author=zhangpanqin" alt="image-20200215041246924"></p> <h3 id="rdb-和-aof-配置"><a href="#rdb-和-aof-配置" class="header-anchor">#</a> RDB 和 AOF 配置</h3> <p>RDB 和 AOF 属于 CPU 密集型。不做 CPU 绑定。</p> <h3 id="docker"><a href="#docker" class="header-anchor">#</a> Docker</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">--name</span> slave-redis-6380 <span class="token parameter variable">-h</span> <span class="token number">0.0</span>.0.0 <span class="token parameter variable">-p</span> <span class="token number">6380</span>:6380 <span class="token parameter variable">-d</span> <span class="token parameter variable">--restart</span><span class="token operator">=</span>always redis redis-server
</code></pre></div><h2 id="运维优化"><a href="#运维优化" class="header-anchor">#</a> 运维优化</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 查看内存信息</span>
info memory
info:latest_fork_usec
</code></pre></div><h2 id="哨兵模式"><a href="#哨兵模式" class="header-anchor">#</a> 哨兵模式</h2> <p>sentinel 是特殊的 redis .redis-sentinel 启动 sentinel 节点。</p> <p>sentinel 通过定时 info replication 获取 master 节点信息，通过解析知道 slave 节点信息，再去 info slave。</p> <p>sentinel 通过发布订阅一个 chanel 进行通信，交换选举信息，判定 master 是否不可用。</p> <p>sentinel 通过 1 秒 ping 每个 redis 确定 redis 是否健康。</p> <p><img src="/blog/20201005231719.png?author=zhangpanqin" alt="image-20200216022528544"></p> <p><img src="/blog/20201005231724.png?author=zhangpanqin" alt="image-20200216023522450"></p> <p><img src="/blog/20201005231730.png?author=zhangpanqin" alt="image-20200216023825223"></p> <div class="language-txt extra-class"><pre class="language-txt"><code>port 26379

daemonize yes

pidfile &quot;/var/run/redis-sentinel-26379.pid&quot;

logfile &quot;redis-sentinel-26379.log&quot;

dir &quot;/private/tmp/26379&quot;

sentinel myid 03934003fa9be3c2dfd7bd954685873a9ce0dfad
# 30秒
sentinel deny-scripts-reconfig yes

# 从节点链接新的主节点的并发数
sentinel monitor mymaster 127.0.0.1 6379 2
</code></pre></div><h2 id="redis-cluster-集群模式"><a href="#redis-cluster-集群模式" class="header-anchor">#</a> redis cluster 集群模式</h2> <p>集群模式下，每个主节点是可以读写的，从节点不会参与读写，访问从节点读时，会跳转到其主节点。可以在来接从节点的时候，执行 readonly 可以在从节点进行读写。但是断开连接之后，在连接还需要执行 readonly 命令。</p> <h3 id="集群步骤"><a href="#集群步骤" class="header-anchor">#</a> 集群步骤</h3> <ul><li>开启节点模式（cluster-enabled yes）</li> <li>redis-server 启动所有几点</li> <li>节点之间相互 meet 握手</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 几点之间相互通信</span>
cluster meet <span class="token function">ip</span> port
</code></pre></div><ul><li>分配槽（共 16383 个）</li></ul> <div class="language-txt extra-class"><pre class="language-txt"><code>cluster addslots start end
</code></pre></div><ul><li>主从复制</li></ul> <div class="language-txt extra-class"><pre class="language-txt"><code>cluster replicate ${node-id}
</code></pre></div><h3 id="配置文件"><a href="#配置文件" class="header-anchor">#</a> 配置文件</h3> <div class="language-txt extra-class"><pre class="language-txt"><code>port 6379
daemonize yes
pidfile /var/run/redis_6379.pid
dbfilename dump-6379.rdb
dir /usr/local/var/db/redis/
# 开启集群模式
cluster-enabled yes
# 节点信息持久化文件
cluster-config-file nodes-6379.conf
cluster-require-full-coverage no
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 查看当前节点信息</span>
cluster info
<span class="token comment"># 查看所有节点</span>
cluster nodes
</code></pre></div><h3 id="命令创建集群关系"><a href="#命令创建集群关系" class="header-anchor">#</a> 命令创建集群关系</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>redis-cli <span class="token parameter variable">--cluster</span> create <span class="token number">127.0</span>.0.1:6382 <span class="token number">127.0</span>.0.1:6380 <span class="token number">127.0</span>.0.1:6381 <span class="token number">127.0</span>.0.1:26379 <span class="token number">127.0</span>.0.1:26380 <span class="token number">127.0</span>.0.1:26381 --cluster-replicas <span class="token number">1</span>
</code></pre></div><h3 id="数据迁移"><a href="#数据迁移" class="header-anchor">#</a> 数据迁移</h3> <p><img src="/blog/20201005231736.png?author=zhangpanqin" alt="image-20200216074100621"></p> <h3 id="集群模式使用"><a href="#集群模式使用" class="header-anchor">#</a> 集群模式使用</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># redis-cli -c -p ${port} -c 指定集群模式，客户端会计算 key 的槽位置，跳转到对应节点上操作</span>
redis-cli <span class="token parameter variable">-c</span> <span class="token parameter variable">-p</span> <span class="token number">4380</span>

<span class="token comment">#  查看节点信息</span>
cluster nodes

<span class="token comment"># 计算 key 的槽位置</span>
cluster keyslot key

<span class="token comment"># 查看槽的信息</span>
cluster slots
</code></pre></div><h3 id="重定向"><a href="#重定向" class="header-anchor">#</a> 重定向</h3> <ul><li>moved 重定向，槽已经迁移。</li> <li>ask 重定向，槽可能迁移，可能没有迁移</li></ul> <h3 id="故障转移"><a href="#故障转移" class="header-anchor">#</a> 故障转移</h3> <ul><li><p>节点之间 ping/pong 消息通信</p></li> <li><p>主观下线</p> <p><img src="/blog/20201005231740.png?author=zhangpanqin" alt="image-20200216190723545"></p></li> <li><p>客观下线</p></li></ul> <p><img src="/blog/20201005231745.png?author=zhangpanqin" alt="image-20200216190839732"></p> <h2 id="redis-慢查询"><a href="#redis-慢查询" class="header-anchor">#</a> Redis 慢查询</h2> <div class="language-conf extra-class"><pre class="language-text"><code># 配置小于多少微妙的时候，判定为慢查询，默认 10000微妙，10毫秒
slowlog-log-slower-than
# 慢查询列表长度，默认128
slowlog-max-len
# 当需要重启 redis 的时候，我们可以在配置文件配置
# 推荐设置，队列长度
config set slowlog-max-len 1000
# 推荐设置， 1ms
config set slowlog-log-slower-than 1000
</code></pre></div><h2 id="redisson"><a href="#redisson" class="header-anchor">#</a> Redisson</h2> <p>###锁</p> <p><a href="%5Bhttps://github.com/redisson/redisson/wiki/8.-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%92%8C%E5%90%8C%E6%AD%A5%E5%99%A8%5D(https://github.com/redisson/redisson/wiki/8.-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%92%8C%E5%90%8C%E6%AD%A5%E5%99%A8)">Redisson 锁</a></p> <ul><li>可重入锁</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">RLock</span> lock <span class="token operator">=</span> redisson<span class="token punctuation">.</span><span class="token function">getLock</span><span class="token punctuation">(</span><span class="token string">&quot;anyLock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 最常见的使用方法</span>
lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 加锁以后10秒钟自动解锁</span>
<span class="token comment">// 无需调用unlock方法手动解锁</span>
lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 尝试加锁，最多等待100秒，上锁以后10秒自动解锁</span>
<span class="token keyword">boolean</span> res <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">try</span> <span class="token punctuation">{</span>
     <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
   <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
       lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>公平锁</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">RLock</span> fairLock <span class="token operator">=</span> redisson<span class="token punctuation">.</span><span class="token function">getFairLock</span><span class="token punctuation">(</span><span class="token string">&quot;anyLock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 最常见的使用方法</span>
fairLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>联锁（获取多个锁才能执行）</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">RLock</span> lock1 <span class="token operator">=</span> redissonInstance1<span class="token punctuation">.</span><span class="token function">getLock</span><span class="token punctuation">(</span><span class="token string">&quot;lock1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">RLock</span> lock2 <span class="token operator">=</span> redissonInstance2<span class="token punctuation">.</span><span class="token function">getLock</span><span class="token punctuation">(</span><span class="token string">&quot;lock2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">RLock</span> lock3 <span class="token operator">=</span> redissonInstance3<span class="token punctuation">.</span><span class="token function">getLock</span><span class="token punctuation">(</span><span class="token string">&quot;lock3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">RedissonMultiLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedissonMultiLock</span><span class="token punctuation">(</span>lock1<span class="token punctuation">,</span> lock2<span class="token punctuation">,</span> lock3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 同时加锁：lock1 lock2 lock3</span>
<span class="token comment">// 所有的锁都上锁成功才算成功。</span>
lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">RedissonMultiLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedissonMultiLock</span><span class="token punctuation">(</span>lock1<span class="token punctuation">,</span> lock2<span class="token punctuation">,</span> lock3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 给lock1，lock2，lock3加锁，如果没有手动解开的话，10秒钟后将会自动解开</span>
lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 为加锁等待100秒时间，并在加锁成功10秒钟后自动解开</span>
<span class="token keyword">boolean</span> res <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>红锁</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">RLock</span> lock1 <span class="token operator">=</span> redissonInstance1<span class="token punctuation">.</span><span class="token function">getLock</span><span class="token punctuation">(</span><span class="token string">&quot;lock1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">RLock</span> lock2 <span class="token operator">=</span> redissonInstance2<span class="token punctuation">.</span><span class="token function">getLock</span><span class="token punctuation">(</span><span class="token string">&quot;lock2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">RLock</span> lock3 <span class="token operator">=</span> redissonInstance3<span class="token punctuation">.</span><span class="token function">getLock</span><span class="token punctuation">(</span><span class="token string">&quot;lock3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">RedissonRedLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedissonRedLock</span><span class="token punctuation">(</span>lock1<span class="token punctuation">,</span> lock2<span class="token punctuation">,</span> lock3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 同时加锁：lock1 lock2 lock3</span>
<span class="token comment">// 红锁在大部分节点上加锁成功就算成功。</span>
lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>读写锁（ReadWriteLock）</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">RReadWriteLock</span> rwlock <span class="token operator">=</span> redisson<span class="token punctuation">.</span><span class="token function">getReadWriteLock</span><span class="token punctuation">(</span><span class="token string">&quot;anyRWLock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 最常见的使用方法</span>
rwlock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 或</span>
rwlock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 10秒钟以后自动解锁</span>
<span class="token comment">// 无需调用unlock方法手动解锁</span>
rwlock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 或</span>
rwlock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 尝试加锁，最多等待100秒，上锁以后10秒自动解锁</span>
<span class="token keyword">boolean</span> res <span class="token operator">=</span> rwlock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 或</span>
<span class="token keyword">boolean</span> res <span class="token operator">=</span> rwlock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><h6 id="semaphore"><a href="#semaphore" class="header-anchor">#</a> Semaphore</h6></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">RSemaphore</span> semaphore <span class="token operator">=</span> redisson<span class="token punctuation">.</span><span class="token function">getSemaphore</span><span class="token punctuation">(</span><span class="token string">&quot;semaphore&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
semaphore<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//或</span>
semaphore<span class="token punctuation">.</span><span class="token function">acquireAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
semaphore<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
semaphore<span class="token punctuation">.</span><span class="token function">tryAcquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//或</span>
semaphore<span class="token punctuation">.</span><span class="token function">tryAcquireAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
semaphore<span class="token punctuation">.</span><span class="token function">tryAcquire</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//或</span>
semaphore<span class="token punctuation">.</span><span class="token function">tryAcquireAsync</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
semaphore<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
semaphore<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//或</span>
semaphore<span class="token punctuation">.</span><span class="token function">releaseAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>CountDownLatch</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">RCountDownLatch</span> latch <span class="token operator">=</span> redisson<span class="token punctuation">.</span><span class="token function">getCountDownLatch</span><span class="token punctuation">(</span><span class="token string">&quot;anyCountDownLatch&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
latch<span class="token punctuation">.</span><span class="token function">trySetCount</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
latch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 在其他线程或其他JVM里</span>
<span class="token class-name">RCountDownLatch</span> latch <span class="token operator">=</span> redisson<span class="token punctuation">.</span><span class="token function">getCountDownLatch</span><span class="token punctuation">(</span><span class="token string">&quot;anyCountDownLatch&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
latch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/zhangpanqin/mflyyou/edit/main/docs/devops/redis/redis.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/3/26 下午12:54:34</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
            ←
            <a href="/devops/elasticsearch/es.html" class="prev">
                Elasticsearch
            </a></span> <span class="next"><a href="/devops/vue/vue-depoly.html">
                你不知道的 SpringBoot 与 Vue 部署解决方案
            </a>
            →
        </span></p></div> </main> <aside class="right-sidebar"> <div class="right-sidebar-toc-container" style="display:;"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="max-height:650px"><div style="font-weight:bold;text-align:center;">Redis 基础</div> <hr> <div class="toc-box"><ul><li><a href="/devops/redis/redis.html#高级数据类型" class="toc-sidebar-link">高级数据类型</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/devops/redis/redis.html#位图-bitmap" class="toc-sidebar-link">位图 Bitmap</a></li><li class="toc-sidebar-sub-header"><a href="/devops/redis/redis.html#hyperloglog" class="toc-sidebar-link">HyperLogLog</a></li><li class="toc-sidebar-sub-header"><a href="/devops/redis/redis.html#布隆过滤器" class="toc-sidebar-link">布隆过滤器</a></li><li class="toc-sidebar-sub-header"><a href="/devops/redis/redis.html#geohash" class="toc-sidebar-link">GeoHash</a></li></ul></li><li><a href="/devops/redis/redis.html#功能" class="toc-sidebar-link">功能</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/devops/redis/redis.html#pipeline" class="toc-sidebar-link">pipeline</a></li><li class="toc-sidebar-sub-header"><a href="/devops/redis/redis.html#发布订阅" class="toc-sidebar-link">发布订阅</a></li></ul></li><li><a href="/devops/redis/redis.html#redis-持久化" class="toc-sidebar-link">Redis 持久化</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/devops/redis/redis.html#rdb" class="toc-sidebar-link">RDB</a></li><li class="toc-sidebar-sub-header"><a href="/devops/redis/redis.html#aof" class="toc-sidebar-link">AOF</a></li><li class="toc-sidebar-sub-header"><a href="/devops/redis/redis.html#rdb-和-aof-配置" class="toc-sidebar-link">RDB 和 AOF 配置</a></li><li class="toc-sidebar-sub-header"><a href="/devops/redis/redis.html#docker" class="toc-sidebar-link">Docker</a></li></ul></li><li><a href="/devops/redis/redis.html#运维优化" class="toc-sidebar-link">运维优化</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/devops/redis/redis.html#哨兵模式" class="toc-sidebar-link">哨兵模式</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/devops/redis/redis.html#redis-cluster-集群模式" class="toc-sidebar-link">redis cluster 集群模式</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/devops/redis/redis.html#集群步骤" class="toc-sidebar-link">集群步骤</a></li><li class="toc-sidebar-sub-header"><a href="/devops/redis/redis.html#配置文件" class="toc-sidebar-link">配置文件</a></li><li class="toc-sidebar-sub-header"><a href="/devops/redis/redis.html#命令创建集群关系" class="toc-sidebar-link">命令创建集群关系</a></li><li class="toc-sidebar-sub-header"><a href="/devops/redis/redis.html#数据迁移" class="toc-sidebar-link">数据迁移</a></li><li class="toc-sidebar-sub-header"><a href="/devops/redis/redis.html#集群模式使用" class="toc-sidebar-link">集群模式使用</a></li><li class="toc-sidebar-sub-header"><a href="/devops/redis/redis.html#重定向" class="toc-sidebar-link">重定向</a></li><li class="toc-sidebar-sub-header"><a href="/devops/redis/redis.html#故障转移" class="toc-sidebar-link">故障转移</a></li></ul></li><li><a href="/devops/redis/redis.html#redis-慢查询" class="toc-sidebar-link">Redis 慢查询</a><ul class="toc-sidebar-sub-headers"></ul></li><li><a href="/devops/redis/redis.html#redisson" class="toc-sidebar-link">Redisson</a><ul class="toc-sidebar-sub-headers"></ul></li></ul></div></div></div></div> <div class="right-sidebar-toolbar"><div class="option-box"><img src="/images/system/toc.png" class="nozoom"> <span class="show-txt">目录</span></div> <div class="option-box"><img src="/images/system/toggle.png" width="30px" class="nozoom"> <span class="show-txt">左栏</span></div> <div title="Elasticsearch" class="option-box" style="padding-left:2px;text-align:center;"><a href="/devops/elasticsearch/es.html"><img src="/images/system/pre2.png" width="30px" class="nozoom"> <span class="show-txt">上一篇</span></a></div> <div title="你不知道的 SpringBoot 与 Vue 部署解决方案" class="option-box" style="padding-left:2px;text-align:center;"><a href="/devops/vue/vue-depoly.html"><img src="/images/system/next2.png" width="30px" class="nozoom"> <span class="show-txt">下一篇</span></a></div></div> </aside></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.9c738e22.js" defer></script><script src="/assets/js/5.d7d91d51.js" defer></script><script src="/assets/js/2.b39c8659.js" defer></script><script src="/assets/js/58.226ffcf8.js" defer></script><script src="/assets/js/12.f541f4fc.js" defer></script>
  </body>
</html>
