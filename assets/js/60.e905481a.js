(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{415:function(t,s,a){"use strict";a.r(s);var n=a(9),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h3",{attrs:{id:"基础数据类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基础数据类型"}},[t._v("#")]),t._v(" 基础数据类型")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看 key 属于那种数据类型")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("type")]),t._v(" key\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置 key 多少秒过期，过期的 key 会被 rendis 自动删除")]),t._v("\nexpire key seconds\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置 name1 5 秒后过期")]),t._v("\nexpire name1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\ndel\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看 key 还有多长时间过期")]),t._v("\ntll key\n")])])]),s("h4",{attrs:{id:"string"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#string"}},[t._v("#")]),t._v(" string")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置某个 key 的值是 value")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" key value\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" name1 zhangsan\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取某个 key 的值")]),t._v("\nget key\nget name1\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 批量设置值")]),t._v("\nmset key1 value1 key2 value2\nmset name1 zhangsan name2 lisi\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 批量获取某些 key 的值")]),t._v("\nmget key1 key2\nmget key1 key2\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置 key 多少秒后过期，等价于 set+expire")]),t._v("\nsetex key seconds value\nsetex name1 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" zhangsan\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 当 key 不存在的时候创建")]),t._v("\nsetnx key value\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 对值是数字的 key 进行计数操作")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" age "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# age +1")]),t._v("\nincr age\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 对 age 加 5")]),t._v("\nincriby age "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n")])])]),s("h4",{attrs:{id:"hash"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hash"}},[t._v("#")]),t._v(" hash")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 类似 Map")]),t._v("\nhset key field value\nhset person name1 zhangsan\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取值")]),t._v("\nhget key field\nhget person name1\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取 key 的所有 field value")]),t._v("\nhgetall person\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取 key 的 field 个数")]),t._v("\nhlen person\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 批量设置 key 的 field value")]),t._v("\nhmset key field1 value1 field2 value2\nhmset person name1 zhangsan name2 lisi\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 对 field 的 value 进行加 1 操作")]),t._v("\nhincrby key field increment\nhset book3 age "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 对 age 的值加5")]),t._v("\nhincrby book3 age "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 得到 8")]),t._v("\nhget book3 age\n")])])]),s("h4",{attrs:{id:"list"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#list"}},[t._v("#")]),t._v(" list")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 列表")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 从列表的右边依次推进 值")]),t._v("\nrpush key value1 value2 value3\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 返回列表长度")]),t._v("\nllen key\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 左边弹出一个元素")]),t._v("\nlpop key\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 右边弹出一个元素")]),t._v("\nrpop key\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取索引位置的value o(n) 级别")]),t._v("\nlindex key index\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 将范围内的元素保留下来，其余删除 o(n)")]),t._v("\nltrim key start end\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取范围的 value,index 为 -1 时标记获取最后一个元素位置  o(n)")]),t._v("\nlrange key start end\n")])])]),s("h4",{attrs:{id:"set"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#set"}},[t._v("#")]),t._v(" set")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 往 set 中添加成员")]),t._v("\nsadd key member\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 返回添加成功的个数，返回 3")]),t._v("\nsadd test2 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 返回 0")]),t._v("\nsadd test2 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取 key 所有的成员")]),t._v("\nsmembers key\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 判断某个 value 是否存在")]),t._v("\nsismember key value\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取有多少个 member")]),t._v("\nscard key\nscard test2\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 弹出一个 member")]),t._v("\nspop key count\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 将 test2 中弹出两个 member")]),t._v("\nspop test2 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n")])])]),s("h4",{attrs:{id:"zset"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#zset"}},[t._v("#")]),t._v(" zset")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置成员的分数")]),t._v("\nzadd key score member\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取指定索引范围的数据")]),t._v("\nzrange key start end\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 逆序获取指定索引的数据")]),t._v("\nzrevrange key start end\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取 key 中 member 的数量")]),t._v("\nzcard key\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取排名，排名从 0 开始")]),t._v("\nzrank key member\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 根据分值获取 member")]),t._v("\nzrangebyscore book5 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 删除 member")]),t._v("\nzrem key member\n")])])]),s("h2",{attrs:{id:"高级数据类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#高级数据类型"}},[t._v("#")]),t._v(" 高级数据类型")]),t._v(" "),s("h3",{attrs:{id:"位图-bitmap"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#位图-bitmap"}},[t._v("#")]),t._v(" 位图 Bitmap")]),t._v(" "),s("p",[t._v("可以用于统计数据")]),t._v(" "),s("p",[t._v("比如说签到，一年 365 天，365 bit 就可以记录一个人的签到")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 注意偏移量太大，可能会耗内存")]),t._v("\nsetbit key offset value\ngetbit key offset\nbitcount key "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("start end"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 对多个 Bitmap 的 and(交集)/or（并集）/not（非）/xor（异或） 操作病将结果保存在 destkey")]),t._v("\nbitop "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("op")]),t._v(" destkey key "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("h3",{attrs:{id:"hyperloglog"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hyperloglog"}},[t._v("#")]),t._v(" HyperLogLog")]),t._v(" "),s("p",[t._v("实质是字符串，利用算法。常用统计，统计误差 0.81%，占用 12KB")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加元素")]),t._v("\npfadd key element\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 统计 key 数量")]),t._v("\npfcount key\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 将多个 sourcekey 合并到目标 key")]),t._v("\npfmerge destkey sourcekey\n")])])]),s("h3",{attrs:{id:"布隆过滤器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#布隆过滤器"}},[t._v("#")]),t._v(" 布隆过滤器")]),t._v(" "),s("h3",{attrs:{id:"geohash"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#geohash"}},[t._v("#")]),t._v(" GeoHash")]),t._v(" "),s("p",[t._v("存储经纬度。底层 zset")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加多个经纬度")]),t._v("\ngeoadd key longitude latitude member "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("longitude latitude member"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取 member 的经纬度")]),t._v("\ngeopos key member "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("member "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 获取两个经纬度之间的距离，可以指定单位 unit:m(米)，km(千米)，mi(英里)，ft(尺)")]),t._v("\ngeodist key member1 member2 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("unit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n")])])]),s("h2",{attrs:{id:"功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#功能"}},[t._v("#")]),t._v(" 功能")]),t._v(" "),s("h3",{attrs:{id:"pipeline"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pipeline"}},[t._v("#")]),t._v(" pipeline")]),t._v(" "),s("p",[t._v("n 次时间 =n 次网络时间+n 次命令时间")]),t._v(" "),s("p",[t._v("pipeline 可以将一批命令，发送 redis，返回对应命令结果")]),t._v(" "),s("p",[t._v("1 次 pipeline 时间=1 次网络时间+n 次命令时间")]),t._v(" "),s("p",[t._v("注意 pipeline 携带的数据量")]),t._v(" "),s("h3",{attrs:{id:"发布订阅"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发布订阅"}},[t._v("#")]),t._v(" 发布订阅")]),t._v(" "),s("p",[t._v("发布者，订阅者，频道")]),t._v(" "),s("p",[t._v("没有消息堆积的能力。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 发布消息")]),t._v("\npublish\npublish sohu:tv "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello world"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 订阅消息")]),t._v("\nsubscribe\nsubcribe sohu:tv\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 取消订阅")]),t._v("\nunsubscribe\nunsubcribe sohu:tv\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 根据正则订阅频道")]),t._v("\npsubscribe\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 根据正则取消订阅")]),t._v("\npunsubcribe\n")])])]),s("h2",{attrs:{id:"redis-持久化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#redis-持久化"}},[t._v("#")]),t._v(" Redis 持久化")]),t._v(" "),s("h3",{attrs:{id:"rdb"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rdb"}},[t._v("#")]),t._v(" RDB")]),t._v(" "),s("p",[t._v("通过命令此时 Redis 快照保存 RDB 文件中。")]),t._v(" "),s("p",[t._v("save 命令同步保存快照数据，生成 RDB 文件，其余命令要排队等待 save 执行成功。考虑阻塞问题。新数据文件替换旧的数据。")]),t._v(" "),s("p",[t._v("bgsave 命令异步保存数据。使用 fork 生成一个子进程，用于生成 RDB 文件，不会阻塞客户端命令。新文件替换旧文件。")]),t._v(" "),s("p",[t._v("也支持自动配置条件触发。多少秒触发数据改变会触发 bgsave。")]),t._v(" "),s("p",[t._v("rdb 文件命名 dump-${port}.rdb")]),t._v(" "),s("p",[t._v("dir 指定文件储存位置。")]),t._v(" "),s("p",[t._v("RDB 缺点：耗时，会丢失数据。fork() 产生子进程，会占用内存。")]),t._v(" "),s("h3",{attrs:{id:"aof"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#aof"}},[t._v("#")]),t._v(" AOF")]),t._v(" "),s("p",[t._v("将执行命令写入到 aof 命令。")]),t._v(" "),s("p",[t._v("将命令根据写入策略写入（fsync）到缓存区中。")]),t._v(" "),s("ul",[s("li",[t._v("always 每条命令都会写入到 aof 文件中。不丢失数据。")]),t._v(" "),s("li",[t._v("everysec 每秒把缓冲区 中的记录命令写入到 aof 文件。主进程会阻塞命令执行，将需要写入的命令刷盘。")]),t._v(" "),s("li",[t._v("no 由系统调用。不使用这个。")])]),t._v(" "),s("p",[s("img",{attrs:{src:"/blog/20201005231659.png?author=zhangpanqin",alt:"image-20200215035830345"}})]),t._v(" "),s("ul",[s("li",[s("p",[t._v("bgrewriteaof fork 子进程对当前内存数据进行分析然后重写 aof 文件，而不是整理 aof 文件。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/blog/20201005231706.png?author=zhangpanqin",alt:"image-20200215040332598"}})])])]),t._v(" "),s("div",{staticClass:"language-txt extra-class"},[s("pre",{pre:!0,attrs:{class:"language-txt"}},[s("code",[t._v("appendonly yes\nappendfilename appendonly-${port}.aof\nappendfsync everysec\n")])])]),s("p",[s("img",{attrs:{src:"/blog/20201005231712.png?author=zhangpanqin",alt:"image-20200215041246924"}})]),t._v(" "),s("h3",{attrs:{id:"rdb-和-aof-配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rdb-和-aof-配置"}},[t._v("#")]),t._v(" RDB 和 AOF 配置")]),t._v(" "),s("p",[t._v("RDB 和 AOF 属于 CPU 密集型。不做 CPU 绑定。")]),t._v(" "),s("h3",{attrs:{id:"docker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker"}},[t._v("#")]),t._v(" Docker")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" slave-redis-6380 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-h")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6380")]),t._v(":6380 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--restart")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("always redis redis-server\n")])])]),s("h2",{attrs:{id:"运维优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#运维优化"}},[t._v("#")]),t._v(" 运维优化")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看内存信息")]),t._v("\ninfo memory\ninfo:latest_fork_usec\n")])])]),s("h2",{attrs:{id:"哨兵模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#哨兵模式"}},[t._v("#")]),t._v(" 哨兵模式")]),t._v(" "),s("p",[t._v("sentinel 是特殊的 redis .redis-sentinel 启动 sentinel 节点。")]),t._v(" "),s("p",[t._v("sentinel 通过定时 info replication 获取 master 节点信息，通过解析知道 slave 节点信息，再去 info slave。")]),t._v(" "),s("p",[t._v("sentinel 通过发布订阅一个 chanel 进行通信，交换选举信息，判定 master 是否不可用。")]),t._v(" "),s("p",[t._v("sentinel 通过 1 秒 ping 每个 redis 确定 redis 是否健康。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/blog/20201005231719.png?author=zhangpanqin",alt:"image-20200216022528544"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"/blog/20201005231724.png?author=zhangpanqin",alt:"image-20200216023522450"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"/blog/20201005231730.png?author=zhangpanqin",alt:"image-20200216023825223"}})]),t._v(" "),s("div",{staticClass:"language-txt extra-class"},[s("pre",{pre:!0,attrs:{class:"language-txt"}},[s("code",[t._v('port 26379\n\ndaemonize yes\n\npidfile "/var/run/redis-sentinel-26379.pid"\n\nlogfile "redis-sentinel-26379.log"\n\ndir "/private/tmp/26379"\n\nsentinel myid 03934003fa9be3c2dfd7bd954685873a9ce0dfad\n# 30秒\nsentinel deny-scripts-reconfig yes\n\n# 从节点链接新的主节点的并发数\nsentinel monitor mymaster 127.0.0.1 6379 2\n')])])]),s("h2",{attrs:{id:"redis-cluster-集群模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#redis-cluster-集群模式"}},[t._v("#")]),t._v(" redis cluster 集群模式")]),t._v(" "),s("p",[t._v("集群模式下，每个主节点是可以读写的，从节点不会参与读写，访问从节点读时，会跳转到其主节点。可以在来接从节点的时候，执行 readonly 可以在从节点进行读写。但是断开连接之后，在连接还需要执行 readonly 命令。")]),t._v(" "),s("h3",{attrs:{id:"集群步骤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#集群步骤"}},[t._v("#")]),t._v(" 集群步骤")]),t._v(" "),s("ul",[s("li",[t._v("开启节点模式（cluster-enabled yes）")]),t._v(" "),s("li",[t._v("redis-server 启动所有几点")]),t._v(" "),s("li",[t._v("节点之间相互 meet 握手")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 几点之间相互通信")]),t._v("\ncluster meet "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ip")]),t._v(" port\n")])])]),s("ul",[s("li",[t._v("分配槽（共 16383 个）")])]),t._v(" "),s("div",{staticClass:"language-txt extra-class"},[s("pre",{pre:!0,attrs:{class:"language-txt"}},[s("code",[t._v("cluster addslots start end\n")])])]),s("ul",[s("li",[t._v("主从复制")])]),t._v(" "),s("div",{staticClass:"language-txt extra-class"},[s("pre",{pre:!0,attrs:{class:"language-txt"}},[s("code",[t._v("cluster replicate ${node-id}\n")])])]),s("h3",{attrs:{id:"配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[t._v("#")]),t._v(" 配置文件")]),t._v(" "),s("div",{staticClass:"language-txt extra-class"},[s("pre",{pre:!0,attrs:{class:"language-txt"}},[s("code",[t._v("port 6379\ndaemonize yes\npidfile /var/run/redis_6379.pid\ndbfilename dump-6379.rdb\ndir /usr/local/var/db/redis/\n# 开启集群模式\ncluster-enabled yes\n# 节点信息持久化文件\ncluster-config-file nodes-6379.conf\ncluster-require-full-coverage no\n")])])]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看当前节点信息")]),t._v("\ncluster info\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看所有节点")]),t._v("\ncluster nodes\n")])])]),s("h3",{attrs:{id:"命令创建集群关系"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#命令创建集群关系"}},[t._v("#")]),t._v(" 命令创建集群关系")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("redis-cli "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--cluster")]),t._v(" create "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:6382 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:6380 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:6381 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:26379 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:26380 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:26381 --cluster-replicas "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n")])])]),s("h3",{attrs:{id:"数据迁移"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据迁移"}},[t._v("#")]),t._v(" 数据迁移")]),t._v(" "),s("p",[s("img",{attrs:{src:"/blog/20201005231736.png?author=zhangpanqin",alt:"image-20200216074100621"}})]),t._v(" "),s("h3",{attrs:{id:"集群模式使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#集群模式使用"}},[t._v("#")]),t._v(" 集群模式使用")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# redis-cli -c -p ${port} -c 指定集群模式，客户端会计算 key 的槽位置，跳转到对应节点上操作")]),t._v("\nredis-cli "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4380")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  查看节点信息")]),t._v("\ncluster nodes\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 计算 key 的槽位置")]),t._v("\ncluster keyslot key\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看槽的信息")]),t._v("\ncluster slots\n")])])]),s("h3",{attrs:{id:"重定向"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重定向"}},[t._v("#")]),t._v(" 重定向")]),t._v(" "),s("ul",[s("li",[t._v("moved 重定向，槽已经迁移。")]),t._v(" "),s("li",[t._v("ask 重定向，槽可能迁移，可能没有迁移")])]),t._v(" "),s("h3",{attrs:{id:"故障转移"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#故障转移"}},[t._v("#")]),t._v(" 故障转移")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("节点之间 ping/pong 消息通信")])]),t._v(" "),s("li",[s("p",[t._v("主观下线")]),t._v(" "),s("p",[s("img",{attrs:{src:"/blog/20201005231740.png?author=zhangpanqin",alt:"image-20200216190723545"}})])]),t._v(" "),s("li",[s("p",[t._v("客观下线")])])]),t._v(" "),s("p",[s("img",{attrs:{src:"/blog/20201005231745.png?author=zhangpanqin",alt:"image-20200216190839732"}})]),t._v(" "),s("h2",{attrs:{id:"redis-慢查询"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#redis-慢查询"}},[t._v("#")]),t._v(" Redis 慢查询")]),t._v(" "),s("div",{staticClass:"language-conf extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# 配置小于多少微妙的时候，判定为慢查询，默认 10000微妙，10毫秒\nslowlog-log-slower-than\n# 慢查询列表长度，默认128\nslowlog-max-len\n# 当需要重启 redis 的时候，我们可以在配置文件配置\n# 推荐设置，队列长度\nconfig set slowlog-max-len 1000\n# 推荐设置， 1ms\nconfig set slowlog-log-slower-than 1000\n")])])]),s("h2",{attrs:{id:"redisson"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#redisson"}},[t._v("#")]),t._v(" Redisson")]),t._v(" "),s("p",[t._v("###锁")]),t._v(" "),s("p",[s("a",{attrs:{href:"%5Bhttps://github.com/redisson/redisson/wiki/8.-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%92%8C%E5%90%8C%E6%AD%A5%E5%99%A8%5D(https://github.com/redisson/redisson/wiki/8.-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%92%8C%E5%90%8C%E6%AD%A5%E5%99%A8)"}},[t._v("Redisson 锁")])]),t._v(" "),s("ul",[s("li",[t._v("可重入锁")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RLock")]),t._v(" lock "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" redisson"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"anyLock"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 最常见的使用方法")]),t._v("\nlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 加锁以后10秒钟自动解锁")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 无需调用unlock方法手动解锁")]),t._v("\nlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimeUnit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SECONDS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 尝试加锁，最多等待100秒，上锁以后10秒自动解锁")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" res "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimeUnit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SECONDS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[t._v("公平锁")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RLock")]),t._v(" fairLock "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" redisson"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getFairLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"anyLock"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 最常见的使用方法")]),t._v("\nfairLock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ul",[s("li",[t._v("联锁（获取多个锁才能执行）")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RLock")]),t._v(" lock1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" redissonInstance1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lock1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RLock")]),t._v(" lock2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" redissonInstance2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lock2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RLock")]),t._v(" lock3 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" redissonInstance3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lock3"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RedissonMultiLock")]),t._v(" lock "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RedissonMultiLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lock1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lock2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lock3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 同时加锁：lock1 lock2 lock3")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 所有的锁都上锁成功才算成功。")]),t._v("\nlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\nlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RedissonMultiLock")]),t._v(" lock "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RedissonMultiLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lock1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lock2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lock3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 给lock1，lock2，lock3加锁，如果没有手动解开的话，10秒钟后将会自动解开")]),t._v("\nlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimeUnit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SECONDS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 为加锁等待100秒时间，并在加锁成功10秒钟后自动解开")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" res "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimeUnit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SECONDS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\nlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ul",[s("li",[t._v("红锁")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RLock")]),t._v(" lock1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" redissonInstance1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lock1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RLock")]),t._v(" lock2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" redissonInstance2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lock2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RLock")]),t._v(" lock3 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" redissonInstance3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lock3"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RedissonRedLock")]),t._v(" lock "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RedissonRedLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lock1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lock2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lock3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 同时加锁：lock1 lock2 lock3")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 红锁在大部分节点上加锁成功就算成功。")]),t._v("\nlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\nlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ul",[s("li",[t._v("读写锁（ReadWriteLock）")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RReadWriteLock")]),t._v(" rwlock "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" redisson"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getReadWriteLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"anyRWLock"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 最常见的使用方法")]),t._v("\nrwlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("readLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 或")]),t._v("\nrwlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 10秒钟以后自动解锁")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 无需调用unlock方法手动解锁")]),t._v("\nrwlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("readLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimeUnit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SECONDS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 或")]),t._v("\nrwlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("lock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimeUnit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SECONDS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 尝试加锁，最多等待100秒，上锁以后10秒自动解锁")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" res "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rwlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("readLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimeUnit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SECONDS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 或")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" res "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" rwlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryLock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimeUnit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SECONDS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\nlock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("unlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ul",[s("li",[s("h6",{attrs:{id:"semaphore"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#semaphore"}},[t._v("#")]),t._v(" Semaphore")])])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RSemaphore")]),t._v(" semaphore "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" redisson"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getSemaphore")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"semaphore"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nsemaphore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("acquire")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//或")]),t._v("\nsemaphore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("acquireAsync")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nsemaphore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("acquire")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nsemaphore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryAcquire")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//或")]),t._v("\nsemaphore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryAcquireAsync")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nsemaphore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryAcquire")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimeUnit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SECONDS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//或")]),t._v("\nsemaphore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tryAcquireAsync")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TimeUnit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SECONDS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nsemaphore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("release")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nsemaphore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("release")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//或")]),t._v("\nsemaphore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("releaseAsync")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ul",[s("li",[t._v("CountDownLatch")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RCountDownLatch")]),t._v(" latch "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" redisson"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCountDownLatch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"anyCountDownLatch"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nlatch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("trySetCount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nlatch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("await")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在其他线程或其他JVM里")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RCountDownLatch")]),t._v(" latch "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" redisson"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCountDownLatch")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"anyCountDownLatch"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nlatch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("countDown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);