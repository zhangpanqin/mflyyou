(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{394:function(t,a,s){"use strict";s.r(a);var n=s(9),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"分词"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分词"}},[t._v("#")]),t._v(" 分词")]),t._v(" "),a("p",[t._v("分词由分词器（Analyzer）完成。")]),t._v(" "),a("h3",{attrs:{id:"分词器-analyzer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分词器-analyzer"}},[t._v("#")]),t._v(" 分词器（Analyzer）")]),t._v(" "),a("p",[t._v("分词器由 "),a("code",[t._v("Character Filters")]),t._v(" 、"),a("code",[t._v("Tokenizer")]),t._v(" 和 "),a("code",[t._v("Token Filter")]),t._v(" 组成。"),a("code",[t._v("Tokenizer")]),t._v(" 是必须的。")]),t._v(" "),a("p",[a("img",{attrs:{src:"/blog/20200314174642.png?author=zhangpanqin",alt:"image-20200314174642330"}})]),t._v(" "),a("p",[t._v("Tokenizer 是将 "),a("code",[t._v("Character Filters")]),t._v(" 处理之后的文本再处理。调用顺序如上所述。")]),t._v(" "),a("h3",{attrs:{id:"查看分词结果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看分词结果"}},[t._v("#")]),t._v(" 查看分词结果")]),t._v(" "),a("ul",[a("li",[t._v("直接查看分词")])]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v('GET /_analyze\n{\n  "text": "张攀钦",\n  "analyzer": "ik_max_word"\n}\n')])])]),a("ul",[a("li",[t._v("查看索引下的某个字段分词")])]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v('GET /case_info/_analyze\n{\n  "field": "detailInfo",\n  "text": [\n    "好好学习"\n  ],\n  "analyzer": "ik_max_word",\n  "explain": true\n}\n')])])]),a("ul",[a("li",[t._v("自定义分词器测试")])]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v('POST /_analyze\n{\n  "tokenizer": "ik_max_word",\n  "filter": ["lowercase"],\n  "char_filter": ["html_strip"],\n  "text": ["<p>I&apos;m so <b>HAPPY 上山打老虎</b>!</p>"]\n}\n')])])]),a("blockquote",[a("p",[t._v("定义 mapping 的时候定义分词器")])]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v('GET /test_custom_analyze/_analyze\n{\n  "field": "my_text",\n  "text": ["<p>I&apos;m so <b>HAPPY 上山打老虎</b>!</p>"],\n  "analyzer": "my_std_folded"\n}\nPUT /test_custom_analyze\n{\n  "settings": {\n    "analysis": {\n      "analyzer": {\n        "my_std_folded": {\n          "tokenizer": "ik_max_word",\n          "filter": [\n            "lowercase"\n          ],\n          "char_filter": [\n            "html_strip"\n          ]\n        }\n      }\n    }\n  },\n  "mappings": {\n    "properties": {\n      "my_text": {\n        "type": "text",\n        "analyzer": "my_std_folded"\n      }\n    }\n  }\n}\n')])])]),a("h2",{attrs:{id:"索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#索引"}},[t._v("#")]),t._v(" 索引")]),t._v(" "),a("h3",{attrs:{id:"分词-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分词-2"}},[t._v("#")]),t._v(" 分词")]),t._v(" "),a("h4",{attrs:{id:"查看字段分词"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看字段分词"}},[t._v("#")]),t._v(" 查看字段分词")]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v('# /{index}/_analyze\nGET /case_info/_analyze\n{\n  "field": "detailInfo",\n  "text": [\n    "上山打老虎"\n  ],\n  "analyzer": "ik_max_word",\n  "explain": true\n}\n')])])]),a("h2",{attrs:{id:"mapping"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mapping"}},[t._v("#")]),t._v(" Mapping")]),t._v(" "),a("h3",{attrs:{id:"定义-mapping-的参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定义-mapping-的参数"}},[t._v("#")]),t._v(" 定义 Mapping 的参数")]),t._v(" "),a("h3",{attrs:{id:"创建索引-mapping"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建索引-mapping"}},[t._v("#")]),t._v(" 创建索引 mapping")]),t._v(" "),a("h4",{attrs:{id:"创建一个不存在的-mapping"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建一个不存在的-mapping"}},[t._v("#")]),t._v(" 创建一个不存在的 mapping")]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v('PUT /study_es_1\n{\n  "mappings": {\n    "properties": {\n      "my_field_content": {\n        "type": "text",\n        "analyzer": "ik_max_word",\n        "fields": {\n          "term_my_field_content": {\n            "type": "keyword"\n          }\n        }\n      }\n    }\n  }\n}\n\n')])])]),a("h4",{attrs:{id:"在存在-mapping-中添加新的字段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在存在-mapping-中添加新的字段"}},[t._v("#")]),t._v(" 在存在 mapping 中添加新的字段")]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v('PUT /study_es_1/_mapping\n{\n  "properties": {\n    "my_field2": {\n      "type": "text",\n      "analyzer": "ik_max_word"\n    }\n  }\n}\n')])])]),a("h3",{attrs:{id:"mapping-中参数设置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mapping-中参数设置"}},[t._v("#")]),t._v(" mapping 中参数设置")]),t._v(" "),a("ul",[a("li",[t._v("analyzer")])]),t._v(" "),a("p",[t._v("指定分词器。比如 ik 分词器中的 "),a("code",[t._v("ik_max_word")]),t._v(" 。如果对同一个字段需要不同的分词器，可以这样做。在 "),a("code",[t._v("fields")]),t._v(" 中添加字段。")]),t._v(" "),a("ul",[a("li",[t._v("index")])]),t._v(" "),a("p",[t._v("设置字段是否用于索引。默认为 "),a("code",[t._v("true")]),t._v(" 当设置为 false 时，不会进行索引，不可查询。")]),t._v(" "),a("ul",[a("li",[t._v("fields")])]),t._v(" "),a("p",[t._v("设置字段用于不同的索引方式。")]),t._v(" "),a("p",[a("code",[t._v("my_field_content")]),t._v(" 用于全文索引，"),a("code",[t._v("my_field_content.term_my_field_content")]),t._v(" 可以用于关键字搜索。")]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v('PUT /study_es_1\n{\n  "mappings": {\n    "properties": {\n      "my_field_content": {\n        "type": "text",\n        "analyzer": "ik_max_word",\n        "fields": {\n          "term_my_field_content": {\n            "type": "keyword"\n          }\n        }\n      }\n    }\n  }\n}\n')])])]),a("ul",[a("li",[t._v("store--"),a("font",{attrs:{color:"red"}},[t._v("不是很理解")])],1)]),t._v(" "),a("p",[t._v("默认字段用于索引，但是不保存。"),a("code",[t._v("_source")]),t._v(" 为原始字段值。")]),t._v(" "),a("ul",[a("li",[t._v("properties")])]),t._v(" "),a("p",[t._v("设置 "),a("code",[t._v("object")]),t._v(" 和 "),a("code",[t._v("nested")]),t._v(" 中字段。")]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v('PUT my_index\n{\n  "mappings": {\n    "properties": {\n      "manager": {\n        "properties": {\n          "age":  { "type": "integer" },\n          "name": { "type": "text"  }\n        }\n      },\n      "employees": {\n        "type": "nested",\n        "properties": {\n          "age":  { "type": "integer" },\n          "name": { "type": "text"  }\n        }\n      }\n    }\n  }\n}\n\nPUT my_index/_doc/1\n{\n  "region": "US",\n  "manager": {\n    "name": "Alice White",\n    "age": 30\n  },\n  "employees": [\n    {\n      "name": "John Smith",\n      "age": 34\n    },\n    {\n      "name": "Peter Brown",\n      "age": 26\n    }\n  ]\n}\n')])])]),a("ul",[a("li",[t._v("coerce")])]),t._v(" "),a("p",[t._v("强制字段的值为定义的类型,不然保存报错。")]),t._v(" "),a("ul",[a("li",[t._v("copy_to")])]),t._v(" "),a("p",[t._v("将别的值复制到一个字段中用于查询。"),a("code",[t._v("full name")]),t._v(" 可以用于查询 "),a("code",[t._v("first_name")]),t._v(" 和 "),a("code",[t._v("last_name")])]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v('PUT my_index\n{\n  "mappings": {\n    "properties": {\n      "first_name": {\n        "type": "text",\n        "copy_to": "full_name"\n      },\n      "last_name": {\n        "type": "text",\n        "copy_to": "full_name"\n      },\n      "full_name": {\n        "type": "text"\n      }\n    }\n  }\n}\n')])])]),a("ul",[a("li",[t._v("dynamic")])]),t._v(" "),a("p",[t._v("允许动态添加字段和 "),a("code",[t._v("mapping")]),t._v(" 的策略。默认 "),a("code",[t._v("true")]),t._v(" 可以动态加入。"),a("code",[t._v("false")]),t._v(" 可以保存数据，但是不会索引和添加到 "),a("code",[t._v("mapping")]),t._v(" 。"),a("code",[t._v("strict")]),t._v(" 添加 "),a("code",[t._v("mapping")]),t._v(" 中不存在的字段直接报错。")]),t._v(" "),a("ul",[a("li",[t._v("enabled")])]),t._v(" "),a("p",[t._v("用于设置对象只能保存，不被索引和查询。"),a("code",[t._v("_source")]),t._v("中会包含这个数据。")]),t._v(" "),a("ul",[a("li",[t._v("format")])]),t._v(" "),a("p",[t._v("将符合格式的日期保存为日期。")]),t._v(" "),a("div",{staticClass:"language-htpp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('PUT my_index\n{\n  "mappings": {\n    "properties": {\n      "date": {\n        "type":   "date",\n        "format": "yyyy-MM-dd"\n      }\n    }\n  }\n}\nPUT /my_index77/_doc/1\n{\n  "date":"2019-12-10"\n}\n')])])]),a("ul",[a("li",[t._v("ignore_above")])]),t._v(" "),a("p",[t._v("长于 "),a("code",[t._v("ignore_above")]),t._v(" 设置的字符数字段不会用于索引。数组中的字符串用于各个匹配。")]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v('PUT my_index\n{\n  "mappings": {\n    "properties": {\n      "message": {\n        "type": "keyword",\n        "ignore_above": 12\n      }\n    }\n  }\n}\nPUT my_index/_doc/1\n{\n  "message": "张攀钦1234567890"\n}\nPUT my_index/_doc/2\n{\n  "message": "张攀钦123456789"\n}\n\n# 搜索不到数据\nPOST my_index/_search\n{\n  "query": {\n    "term": {\n      "message": {\n        "value": "张攀钦1234567890"\n      }\n    }\n  }\n}\n\n# 可以搜索到数据\nPOST my_index/_search\n{\n  "query": {\n    "term": {\n      "message": {\n        "value": "张攀钦123456789"\n      }\n    }\n  }\n}\n')])])]),a("ul",[a("li",[t._v("ignore_malformed")])]),t._v(" "),a("p",[t._v("设置为 "),a("code",[t._v("true")]),t._v(" 忽略传入值与设置类型不一致的错误。错误的不会进行索引，但是其余字段正常索引处理。可以类型转换的没有问题。"),a("code",[t._v('"11"')]),t._v(" 可以转换为 11。")]),t._v(" "),a("p",[a("code",[t._v("number_two")]),t._v(" 只能传数值，"),a("code",[t._v("number_one")]),t._v(" 可以 传非数值字段。")]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v('PUT my_index\n{\n  "mappings": {\n    "properties": {\n      "number_one": {\n        "type": "integer",\n        "ignore_malformed": true\n      },\n      "number_two": {\n        "type": "integer"\n      }\n    }\n  }\n}\n\nPUT my_index/_doc/1\n{\n  "text":       "Some text value",\n  "number_one": "foo"\n}\n\nPUT my_index/_doc/2\n{\n  "text":       "Some text value",\n  "number_two": "foo"\n}\n')])])]),a("h3",{attrs:{id:"查看-mapping"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看-mapping"}},[t._v("#")]),t._v(" 查看 mapping")]),t._v(" "),a("h4",{attrs:{id:"查看索引的-mapping"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看索引的-mapping"}},[t._v("#")]),t._v(" 查看索引的 mapping")]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v("# /索引/_mapping\nGET /case_info/_mapping\n")])])]),a("h4",{attrs:{id:"查看某个字段-mapping"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看某个字段-mapping"}},[t._v("#")]),t._v(" 查看某个字段 mapping")]),t._v(" "),a("p",[t._v("/"),a("code",[t._v("index")]),t._v("/_mapping/field/"),a("code",[t._v("字段")])]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v("# 查看索引 my-index 中 age 的 mapping\nGET /my-index/_mapping/field/age\n")])])]),a("h3",{attrs:{id:"更改字段索引类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更改字段索引类型"}},[t._v("#")]),t._v(" 更改字段索引类型")]),t._v(" "),a("p",[t._v("创建一个新的索引，和别名，然后从新索引你的数据到新的索引")]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v('POST _reindex\n{\n  "source": {\n    "index": "twitter",\n    "type": "user"\n  },\n  "dest": {\n    "index": "users",\n    "type": "_doc"\n  }\n}\n')])])]),a("h2",{attrs:{id:"数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据"}},[t._v("#")]),t._v(" 数据")]),t._v(" "),a("h3",{attrs:{id:"保存数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#保存数据"}},[t._v("#")]),t._v(" 保存数据")]),t._v(" "),a("blockquote",[a("p",[t._v("/"),a("code",[t._v("index")]),t._v("/_doc")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("POST")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("test_index"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("_doc\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"caseId"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"案例主键 id"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"caseName"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"案例名称"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"casePictureUrl"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/asd"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"detailInfo"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"案例详情"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"caseLevel"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"caseYear"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2019"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"baseArea"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"所属区域"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"provinceName"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"省名称"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"cityName"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"城市名称"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"saleName"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"陈平安"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"阿良"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 索引")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"_index"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test_index"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// type,未来会弃用，目前一个索引存储一种类型的数据")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"_type"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_doc"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 主键 id")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"_id"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cCYa1HABWJRN301QEXbs"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 数据版本号")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"_version"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 操作说明，create,updated,deleted")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"result"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"created"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 分片")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"_shards"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"total"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"successful"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"failed"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"_seq_no"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"_primary_term"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"更新数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更新数据"}},[t._v("#")]),t._v(" 更新数据")]),t._v(" "),a("blockquote",[a("p",[t._v("/"),a("code",[t._v("index")]),t._v("/_doc_/"),a("code",[t._v("id")])])]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v('PUT /test_index/_doc/1\n{\n    "caseId": "案例主键 id",\n    "caseName": "案例名称",\n    "casePictureUrl": "/asd",\n    "detailInfo": "案例详情",\n    "caseLevel":1,\n    "caseYear": "2019",\n    "baseArea":"所属区域",\n    "provinceName":"省名称",\n    "cityName": "城市名称",\n    "saleName":["陈平安","阿良"]\n}\n# 返回值\n{\n  "_index" : "test_index",\n  "_type" : "_doc",\n  "_id" : "cCYa1HABWJRN301QEXbs",\n  "_version" : 2,\n  "result" : "updated",\n  "_shards" : {\n    "total" : 2,\n    "successful" : 1,\n    "failed" : 0\n  },\n  "_seq_no" : 3,\n  "_primary_term" : 1\n}\n')])])]),a("h3",{attrs:{id:"删除数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除数据"}},[t._v("#")]),t._v(" 删除数据")]),t._v(" "),a("blockquote",[a("p",[t._v("/"),a("code",[t._v("index")]),t._v("/_doc/"),a("code",[t._v("id")])])]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v('DELETE /test_index/_doc/cCYa1HABWJRN301QEXbs\n{\n  "_index" : "test_index",\n  "_type" : "_doc",\n  "_id" : "cCYa1HABWJRN301QEXbs",\n  "_version" : 3,\n  "result" : "deleted",\n  "_shards" : {\n    "total" : 2,\n    "successful" : 1,\n    "failed" : 0\n  },\n  "_seq_no" : 7,\n  "_primary_term" : 1\n}\n')])])]),a("h2",{attrs:{id:"查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询"}},[t._v("#")]),t._v(" 查询")]),t._v(" "),a("h3",{attrs:{id:"简单查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简单查询"}},[t._v("#")]),t._v(" 简单查询")]),t._v(" "),a("ul",[a("li",[t._v("根据 id 查询，返回数据，不包含元数据")])]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v("GET /test_index/_source/cCYa1HABWJRN301QEXbs\n")])])]),a("ul",[a("li",[t._v("根据 id 查询，返回数据包含元数据")])]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v("\n")])])]),a("h3",{attrs:{id:"布尔查询-bool-query"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#布尔查询-bool-query"}},[t._v("#")]),t._v(" 布尔查询-Bool Query")]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v('POST _search\n{\n  "query": {\n    "bool" : {\n      "must" : {\n        "term" : { "user" : "kimchy" }\n      },\n      "filter": {\n        "term" : { "tag" : "tech" }\n      },\n      "must_not" : {\n        "range" : {\n          "age" : { "gte" : 10, "lte" : 20 }\n        }\n      },\n      "should" : [\n        { "term" : { "tag" : "wow" } },\n        { "term" : { "tag" : "elasticsearch" } }\n      ]\n    }\n  }\n}\n')])])]),a("h3",{attrs:{id:"关键字查询-term-query"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关键字查询-term-query"}},[t._v("#")]),t._v(" 关键字查询-Term Query")]),t._v(" "),a("h3",{attrs:{id:"match-query"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#match-query"}},[t._v("#")]),t._v(" Match Query")]),t._v(" "),a("ul",[a("li",[t._v("模拟数据")])]),t._v(" "),a("p",[t._v("创建字段 my_field_content，和用于关键字查询的 term_my_field_content（查询结果中不会显示这个字段）")]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v('PUT /study_es_1/\n{\n  "mappings": {\n    "properties": {\n      "my_field_content": {\n        "type": "text",\n        "analyzer": "ik_max_word",\n        "fields": {\n          "term_my_field_content": {\n            "type": "keyword"\n          }\n        }\n      }\n    }\n  }\n}\nPUT /study_es_1/_mapping\n{\n  "properties": {\n    "my_field2": {\n      "type": "text",\n      "analyzer": "ik_max_word"\n    }\n  }\n}\nPOST /study_es_1/_doc\n{\n  "my_field_content":"上山打老虎"\n}\nPOST /study_es_1/_doc\n{\n  "my_field_content":"和尚上山打老虎"\n}\nPOST /study_es_1/_doc\n{\n  "my_field_content":"白也战六妖",\n  "my_field2":"老虎吃人"\n}\n')])])]),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v('# my_text 为字段。简单写法。\nGET /test-mapping2/_search\n{\n "query": {\n   "match": {\n     "my_field_content": "打"\n   }\n }\n}\n')])])]),a("blockquote",[a("p",[t._v("匹配有 "),a("code",[t._v("老虎")]),t._v(" 或 "),a("code",[t._v("和尚")]),t._v(" 的文档。显示两条数据。")])]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v('GET /study_es_1/_search\n{\n  "query": {\n    "match": {\n      "my_field_content": {\n        "query": "和尚 老虎",\n        "operator": "or"\n      }\n    }\n  }\n}\n')])])]),a("blockquote",[a("p",[t._v("匹配同时有 "),a("code",[t._v("老虎")]),t._v(" 和 "),a("code",[t._v("和尚")]),t._v(" 的文档。显示一条数据。"),a("code",[t._v("query")]),t._v(" 用于匹配词条。")])]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v('GET /study_es_1/_search\n{\n  "query": {\n    "match": {\n      "my_field_content": {\n        "query": "和尚 老虎",\n        "operator": "and"\n      }\n    }\n  }\n}\n')])])]),a("blockquote",[a("p",[t._v("上述 mapping 对 "),a("code",[t._v("my_field_content")]),t._v(" 下定义了一个字段用于关键字 term 查询。准备匹配，不进行分词。")])]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v('GET /study_es_1/_search\n{\n  "query": {\n    "term": {\n      "my_field_content.term_my_field_content": {\n        "value": "和尚上山打老虎"\n      }\n    }\n  }\n}\n')])])]),a("h3",{attrs:{id:"所有字段模糊查询-query-string"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#所有字段模糊查询-query-string"}},[t._v("#")]),t._v(" 所有字段模糊查询-Query String")]),t._v(" "),a("blockquote",[a("p",[t._v("三条数据全部查出来")])]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v('GET /study_es_1/_search\n{\n  "query": {\n    "query_string": {\n      "query": "老虎"\n    }\n  }\n}\n')])])]),a("h2",{attrs:{id:"部署运维"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署运维"}},[t._v("#")]),t._v(" 部署运维")]),t._v(" "),a("h3",{attrs:{id:"设置文件描述符"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置文件描述符"}},[t._v("#")]),t._v(" 设置文件描述符")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("ulimit")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" 可以查看设置信息\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 调大打开的文件描述符，设置太大，可能不成功")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("su")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("ulimit")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("65535")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("su")]),t._v(" elasticsearch\n\n此操作没有持久化\n")])])]),a("ul",[a("li",[t._v("持久化更改文件操作符")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# /etc/security/limits.conf")]),t._v("\nelasticsearch  -  nofile  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("65535")]),t._v("\n")])])]),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# rpm 包设置")]),t._v("\n/etc/sysconfig/elasticsearch\n")])])]),a("p",[a("img",{attrs:{src:"/blog/20200313220432.png?author=zhangpanqin",alt:"image-20200313220432178"}})]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v("# 查看文件描述符\nGET _nodes/stats/process?filter_path=**.max_file_descriptors\n")])])]),a("h3",{attrs:{id:"ik-词库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ik-词库"}},[t._v("#")]),t._v(" Ik 词库")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/studyzy/imewlconverter",target:"_blank",rel:"noopener noreferrer"}},[t._v("深蓝词库转换"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("将搜狗词库转换为 txt")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("dotnet ImeWlConverterCmd.dll "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-i:scel")]),t._v(" ./a.scel "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o:word")]),t._v(" ./word.txt\n")])])]),a("h3",{attrs:{id:"热更新词库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#热更新词库"}},[t._v("#")]),t._v(" 热更新词库")]),t._v(" "),a("p",[t._v("ik 分词器配置文件："),a("code",[t._v("{esroot}/config/analysis-ik/IKAnalyzer.cfg.xml")])]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token prolog"}},[t._v('<?xml version="1.0" encoding="UTF-8"?>')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token doctype"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),a("span",{pre:!0,attrs:{class:"token doctype-tag"}},[t._v("DOCTYPE")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token name"}},[t._v("properties")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token name"}},[t._v("SYSTEM")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://java.sun.com/dtd/properties.dtd"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("comment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("IK Analyzer 扩展配置"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("comment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--用户可以在这里配置自己的扩展字典 --\x3e")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("entry")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("ext_dict"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("my_main.dic"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("entry")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\t "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--用户可以在这里配置自己的扩展停止词字典--\x3e")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("entry")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("ext_stopwords"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("entry")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--用户可以在这里配置远程扩展字典 --\x3e")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("entry")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("remote_ext_dict"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("http://localhost:8888/ik/a.txt"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("entry")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!--用户可以在这里配置远程扩展停止词字典--\x3e")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('\x3c!-- <entry key="remote_ext_stopwords">words_location</entry> --\x3e')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("nginx 配置词库文件位置")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /ik/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("alias")]),t._v(" /Users/zhangpanqin/stduy_app/ik/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("autoindex")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("off")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("expires")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7h")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);