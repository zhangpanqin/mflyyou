(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{294:function(a,t,s){a.exports=s.p+"assets/img/wrapper-workflow.17f02560.png"},295:function(a,t,s){a.exports=s.p+"assets/img/task-dag-examples.097414aa.png"},296:function(a,t,s){a.exports=s.p+"assets/img/remote-debug-gradle.09ab64f0.gif"},381:function(a,t,s){"use strict";s.r(t);var n=s(9),e=Object(n.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"gradle"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gradle"}},[a._v("#")]),a._v(" Gradle")]),a._v(" "),t("h3",{attrs:{id:"环境介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境介绍"}},[a._v("#")]),a._v(" 环境介绍")]),a._v(" "),t("ul",[t("li",[a._v("OpenJDK 17.0.5")]),a._v(" "),t("li",[a._v("Gradle 7.6")]),a._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/zhangpanqin/fly-gradle",target:"_blank",rel:"noopener noreferrer"}},[a._v("示例代码 fly-gradle"),t("OutboundLink")],1)])]),a._v(" "),t("h2",{attrs:{id:"gradle-项目下文件介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gradle-项目下文件介绍"}},[a._v("#")]),a._v(" Gradle 项目下文件介绍")]),a._v(" "),t("p",[a._v("如果你的电脑安装了 gradle，可以使用 gradle init 去初始化一个新的 gradle 工程，然后使用电脑安装的 gradle 去执行构建命令。")]),a._v(" "),t("p",[a._v("但是每个开发电脑上的 gradle 版本不一样，为了统一构建环境，我们可以使用 gradle wrapper 限定项目依赖 gradle 的版本。")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 会生成 gradle/wrapper/* gradlew gradlew.bat")]),a._v("\ngradle wrapper --gradle-version "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("7.5")]),a._v(".1 --distribution-type bin\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v(".\n├── build.gradle\n├── gradle\n│   └── wrapper\n│       ├── gradle-wrapper.jar\n│       └── gradle-wrapper.properties\n├── gradle.properties\n├── gradlew\n├── gradlew.bat\n├── settings.gradle\n")])])]),t("h3",{attrs:{id:"gradlew-和-gradlew-bat"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gradlew-和-gradlew-bat"}},[a._v("#")]),a._v(" gradlew 和 gradlew.bat")]),a._v(" "),t("p",[a._v("运行项目 "),t("code",[a._v("wrapper")]),a._v(" 下定义的 gradle 去构建项目。")]),a._v(" "),t("p",[t("code",[a._v("gradlew")]),a._v(" 是 macos 和 linux 系统下。")]),a._v(" "),t("p",[t("code",[a._v("gradlew.bat")]),a._v(" 是 windows 系统下使用的。")]),a._v(" "),t("h3",{attrs:{id:"wrapper"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#wrapper"}},[a._v("#")]),a._v(" wrapper")]),a._v(" "),t("p",[t("img",{attrs:{src:s(294),alt:"wrapper workflow"}})]),a._v(" "),t("p",[a._v("wrapper 定义项目依赖那个版本的 gradle，如果本地 distributionPath 没有对应版本的 gradle，会自动下载对应版本的 gradle。")]),a._v(" "),t("div",{staticClass:"language-properties extra-class"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# gradle-wrapper.properties")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("distributionBase")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("GRADLE_USER_HOME")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("distributionPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("wrapper/dists")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 如果是国内项目，只需要修改这个url 就可以提高下载速度")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("distributionUrl")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("https\\://services.gradle.org/distributions/gradle-6.7-bin.zip")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("zipStoreBase")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("GRADLE_USER_HOME")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("zipStorePath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("wrapper/dists")]),a._v("\n")])])]),t("p",[t("code",[a._v("GRADLE_USER_HOME")]),a._v(" 没有配置的话，默认是 "),t("code",[a._v("~/.gradle")])]),a._v(" "),t("p",[t("code",[a._v("zipStoreBase")]),a._v(" 和 "),t("code",[a._v("zipStorePath")]),a._v(" 定义了下载的 gradle (gradle-7.6-bin.zip) 存储的本地路径。")]),a._v(" "),t("p",[t("code",[a._v("distributionBase")]),a._v(" 和 "),t("code",[a._v("distributionPath")]),a._v(" 定义下载的 gradle 解压的本地目录。")]),a._v(" "),t("p",[t("code",[a._v("gradlew")]),a._v(" 实际是运行 gradle-wrapper.jar 中的 "),t("a",{attrs:{href:"https://github.com/gradle/gradle/blob/v7.6.1/subprojects/wrapper/src/main/java/org/gradle/wrapper/GradleWrapperMain.java#L38",target:"_blank",rel:"noopener noreferrer"}},[a._v("main 方法"),t("OutboundLink")],1),a._v("，传递给 gradlew 的参数实际上也会传递给这个 main 方法。")]),a._v(" "),t("p",[a._v("gradle-wrapper.jar 会判断是否下载 wrapper 配置的 gradle，并且将传递参数给下载的 gradle，并运行下载的 gralde 进行构建项目。")]),a._v(" "),t("p",[a._v("配置 gradle wrapper 下载需要的密码 和 mtls 证书")]),a._v(" "),t("div",{staticClass:"language-properties extra-class"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("systemProp.gradle.wrapperUser")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("xx")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("systemProp.gradle.wrapperPassword")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("xx")]),a._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# mtls")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("systemProp.javax.net.ssl.keyStore")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("/Users/panqinzhang/xx.pfx")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("systemProp.javax.net.ssl.keyStoreType")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("pkcs12")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("systemProp.javax.net.ssl.keyStorePassword")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("xx")]),a._v("\n")])])]),t("p",[a._v("升级 wrapper 定义的 gradle 版本")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("./gradlew wrapper --gradle-version "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("7.6")]),a._v("\n")])])]),t("h3",{attrs:{id:"settings-gradle"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#settings-gradle"}},[a._v("#")]),a._v(" settings.gradle")]),a._v(" "),t("div",{staticClass:"language-groovy extra-class"},[t("pre",{pre:!0,attrs:{class:"language-groovy"}},[t("code",[a._v("pluginManagement "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    repositories "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        maven "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            url"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token interpolation-string"}},[t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"file://')]),t("span",{pre:!0,attrs:{class:"token interpolation"}},[t("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[a._v("${")]),t("span",{pre:!0,attrs:{class:"token expression"}},[a._v("rootDir")]),t("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[a._v("}")])]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('/maven/plugin"')])]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("gradlePluginPortal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    plugins "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n      \t"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// spring_boot_version 可以在 gradle.properties 配置")]),a._v("\n        id "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'org.springframework.boot'")]),a._v(" version "),t("span",{pre:!0,attrs:{class:"token interpolation-string"}},[t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"')]),t("span",{pre:!0,attrs:{class:"token interpolation"}},[t("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[a._v("${")]),t("span",{pre:!0,attrs:{class:"token expression"}},[a._v("spring_boot_version")]),t("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[a._v("}")])]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"')])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\nrootProject"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("name "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'fly-gradle'")]),a._v("\ninclude "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'user-manage-service'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'user-manage-sdk'")]),a._v("\ninclude "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'lib-a'")]),a._v("\ninclude "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'lib-b'")]),a._v("\n")])])]),t("p",[a._v("settings.gradle 主要用于配置项目名称，和包含哪些子项目。")]),a._v(" "),t("p",[a._v("也可以用于配置插件的依赖版本（不会应用到项目中去，除非项目应用这个插件）和插件下载的仓库")]),a._v(" "),t("h3",{attrs:{id:"build-gradle"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#build-gradle"}},[a._v("#")]),a._v(" build.gradle")]),a._v(" "),t("p",[a._v("build.gradle 是对某个项目的配置。配置 jar 依赖关系，定义或者引入 task 去完成项目构建。")]),a._v(" "),t("h3",{attrs:{id:"gradle-properties"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gradle-properties"}},[a._v("#")]),a._v(" gradle.properties")]),a._v(" "),t("p",[a._v("主要用于配置构建过程中用到的变量值。也可以配置一些 gradle 内置变量的值，用于修改默认构建行为。")]),a._v(" "),t("div",{staticClass:"language-properties extra-class"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("org.gradle.logging.level")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("quiet")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("org.gradle.caching")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("true")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("org.gradle.parallel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("true")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("org.gradle.jvmargs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("-Xms512m -Xmx2g -XX:MaxMetaspaceSize=512m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8")]),a._v("\n")])])]),t("p",[t("code",[a._v("org.gradle.jvmargs")]),a._v(" 用来配置 Daemon 的 JVM 参数，默认值是 "),t("code",[a._v('-Xmx512m "-XX:MaxMetaspaceSize=384m"')]),a._v("。")]),a._v(" "),t("p",[a._v("当我们的项目比较大的时候，可能会由于 JVM 堆内存不足导致构建失败，就需要修改此配置。")]),a._v(" "),t("p",[t("code",[a._v("org.gradle.logging.level")]),a._v(" 调整 gradle 的日志级别。参考 "),t("a",{attrs:{href:"https://docs.gradle.org/current/userguide/logging.html#sec:choosing_a_log_level",target:"_blank",rel:"noopener noreferrer"}},[a._v("gradle logging"),t("OutboundLink")],1),a._v(" 选择想要的日志级别。")]),a._v(" "),t("h2",{attrs:{id:"gradle-daemon"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gradle-daemon"}},[a._v("#")]),a._v(" Gradle Daemon")]),a._v(" "),t("p",[a._v("为加快项目构建，gralde 会启动一个常驻 JVM 后台进程去处理构建，Daemon 进程默认三小时过期且当内存压力大的时候也会关闭。")]),a._v(" "),t("p",[a._v("Gradle 默认会启用 Daemon 进程去构建项目。")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看 daemon 运行状态")]),a._v("\n./gradlew "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--status")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# stop daemon 进程")]),a._v("\n./gradlew "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--stop")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 重启 daemon 进程")]),a._v("\n./gradlew "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--daemon")]),a._v("\n")])])]),t("h2",{attrs:{id:"构建生命周期"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#构建生命周期"}},[a._v("#")]),a._v(" 构建生命周期")]),a._v(" "),t("p",[a._v("Gradle 是基于 task 依赖关系来构建项目的，我们只需要定义 task 和 task 之间的依赖关系，Gradle 会保证 task 的执行顺序。")]),a._v(" "),t("p",[a._v("Gradle 在执行 task 之前会建立 "),t("code",[a._v("Task Graphs")]),a._v("，我们引入的插件和自己的构建脚本会往这个 task graph 中添加 task。")]),a._v(" "),t("p",[t("img",{attrs:{src:s(295),alt:"Example task graphs"}})]),a._v(" "),t("p",[a._v("Gradle 的构建过程分为三部分：初始化阶段、配置阶段和执行阶段。")]),a._v(" "),t("h3",{attrs:{id:"初始化阶段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#初始化阶段"}},[a._v("#")]),a._v(" 初始化阶段")]),a._v(" "),t("ul",[t("li",[a._v("找到 settings.gradle，执行其中代码")]),a._v(" "),t("li",[a._v("确定有哪些项目需要构建，然后对每个项目创建 Project 对象，build.gradle 主要就是配置这个 Project 对象")])]),a._v(" "),t("div",{staticClass:"language-groovy extra-class"},[t("pre",{pre:!0,attrs:{class:"language-groovy"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// settings.gradle")]),a._v("\nrootProject"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("name "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'basic'")]),a._v("\nprintln "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'在初始化阶段执行'")]),a._v("\n")])])]),t("h3",{attrs:{id:"配置阶段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置阶段"}},[a._v("#")]),a._v(" 配置阶段")]),a._v(" "),t("ul",[t("li",[a._v("执行 build.gradle 中的配置代码，对 Project 进行配置")]),a._v(" "),t("li",[a._v("执行 Task 中的配置段语句")]),a._v(" "),t("li",[a._v("根据请求执行的 task，建立 task graph")])]),a._v(" "),t("div",{staticClass:"language-groovy extra-class"},[t("pre",{pre:!0,attrs:{class:"language-groovy"}},[t("code",[a._v("println "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'在配置阶段执行 Task 中的配置段语句'")]),a._v("\n\ntasks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("register")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'configured'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  println "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'在配置阶段执行 Task 中的配置段语句'")]),a._v("\n  doFirst "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    println "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'在执行阶段执行'")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n  doLast "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    println "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'在执行阶段执行'")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("h3",{attrs:{id:"执行阶段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#执行阶段"}},[a._v("#")]),a._v(" 执行阶段")]),a._v(" "),t("p",[a._v("根据 task graph 执行 task 代码。")]),a._v(" "),t("h2",{attrs:{id:"依赖管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#依赖管理"}},[a._v("#")]),a._v(" 依赖管理")]),a._v(" "),t("h3",{attrs:{id:"maven-私服配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#maven-私服配置"}},[a._v("#")]),a._v(" Maven 私服配置")]),a._v(" "),t("p",[a._v("我们一般都是多项目构建，因此只需要在父项目 build.gradle 配置 repositories。")]),a._v(" "),t("div",{staticClass:"language-groovy extra-class"},[t("pre",{pre:!0,attrs:{class:"language-groovy"}},[t("code",[a._v("allprojects "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  repositories "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    maven "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n      url "),t("span",{pre:!0,attrs:{class:"token interpolation-string"}},[t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"')]),t("span",{pre:!0,attrs:{class:"token interpolation"}},[t("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[a._v("${")]),t("span",{pre:!0,attrs:{class:"token expression"}},[a._v("mavenPublicUrl")]),t("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[a._v("}")])]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"')])]),a._v("\n      credentials "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        username "),t("span",{pre:!0,attrs:{class:"token interpolation-string"}},[t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"')]),t("span",{pre:!0,attrs:{class:"token interpolation"}},[t("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[a._v("${")]),t("span",{pre:!0,attrs:{class:"token expression"}},[a._v("mavenUsername")]),t("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[a._v("}")])]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"')])]),a._v("\n        password "),t("span",{pre:!0,attrs:{class:"token interpolation-string"}},[t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"')]),t("span",{pre:!0,attrs:{class:"token interpolation"}},[t("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[a._v("${")]),t("span",{pre:!0,attrs:{class:"token expression"}},[a._v("mavenPassword")]),t("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[a._v("}")])]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"')])]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("mavenLocal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("mavenCentral")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[a._v("credentials 配置账号密码，当私服不需要权限下载的时候可以不配置。")]),a._v(" "),t("p",[a._v("Gradle 会按照配置的仓库顺序查询依赖下载。")]),a._v(" "),t("h3",{attrs:{id:"gradle-configuration"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gradle-configuration"}},[a._v("#")]),a._v(" Gradle Configuration")]),a._v(" "),t("p",[t("code",[a._v("Configuration")]),a._v(" 用于声明一组 jar 依赖，它可以让 plugin 在构建的时候知道使用哪些依赖。")]),a._v(" "),t("p",[a._v("compileOnly 就是一种类型 "),t("code",[a._v("Configuration")]),a._v("，它是由 java plugin 这个插件引入进来的。我们可以 compileOnly 去定义那些依赖是在  application code 编译的时候使用，这个功能也是 java plugin 定义好的。")]),a._v(" "),t("div",{staticClass:"language-groovy extra-class"},[t("pre",{pre:!0,attrs:{class:"language-groovy"}},[t("code",[a._v("dependencies "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\tcompileOnly "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'org.projectlombok:lombok:1.18.26'")]),a._v("\n\tannotationProcessor "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'org.projectlombok:lombok:1.18.26'")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[a._v("我们也可以自定义 Configuration，比如 mavenBom")]),a._v(" "),t("p",[a._v("比如我们在多项目构建中，父工程的 build.gradle 定义 configuration，然后就可以使用 maven bom 中定义好的 jar")]),a._v(" "),t("div",{staticClass:"language-groovy extra-class"},[t("pre",{pre:!0,attrs:{class:"language-groovy"}},[t("code",[a._v("configurations "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  parentBom\n  runtimeOnly"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("extendsFrom")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("parentBom"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n  compileOnly"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("extendsFrom")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("parentBom"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n  annotationProcessor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("extendsFrom")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("parentBom"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\ndependencies "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  parentBom "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("platform")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token interpolation-string"}},[t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"org.springframework.boot:spring-boot-dependencies:3.0.4"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[a._v("子工程就可以直接引入依赖，不需要引入 org.springframework.boot 和 io.spring.dependency-management 插件也可以。")]),a._v(" "),t("div",{staticClass:"language-groovy extra-class"},[t("pre",{pre:!0,attrs:{class:"language-groovy"}},[t("code",[a._v("dependencies "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  implementation "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'org.springframework.boot:spring-boot-starter-web'")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("h3",{attrs:{id:"配置依赖来自某个目录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置依赖来自某个目录"}},[a._v("#")]),a._v(" 配置依赖来自某个目录")]),a._v(" "),t("div",{staticClass:"language-groovy extra-class"},[t("pre",{pre:!0,attrs:{class:"language-groovy"}},[t("code",[a._v("dependencies "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\tcompile "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("files")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'lib/hacked-vendor-module.jar'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\ndependencies "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\tcompile "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("fileTree")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'lib'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[a._v("有的时候第三方库没有 maven 供我们使用，可以使用这个。")]),a._v(" "),t("h3",{attrs:{id:"依赖冲突"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#依赖冲突"}},[a._v("#")]),a._v(" 依赖冲突")]),a._v(" "),t("h4",{attrs:{id:"默认依赖冲突"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#默认依赖冲突"}},[a._v("#")]),a._v(" 默认依赖冲突")]),a._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),t("p",[a._v("当出现依赖冲突的时候，gradle 优先选择版本较高的，因为 Gradle 认为较高版本会兼容低版本。")])]),a._v(" "),t("div",{staticClass:"language-groovy extra-class"},[t("pre",{pre:!0,attrs:{class:"language-groovy"}},[t("code",[a._v("dependencies "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    implementation "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'com.google.guava:guava:31.1-jre'")]),a._v("\n    implementation "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'com.google.code.findbugs:jsr305:3.0.0'")]),a._v("\n\n    testImplementation "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'org.junit.jupiter:junit-jupiter-api:5.8.1'")]),a._v("\n    testRuntimeOnly "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'org.junit.jupiter:junit-jupiter-engine:5.8.1'")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[a._v("我们可以执行下面命令查看项目依赖的版本：")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[a._v("./gradlew dependency-management:dependencies "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--configuration")]),a._v(" compileClasspath\n\n------------------------------------------------------------\nProject "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("':dependency-management'")]),a._v("\n------------------------------------------------------------\n\ncompileClasspath - Compile classpath "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("source")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("set")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'main'")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v("\n+--- org.springframework.boot:spring-boot-dependencies:3.0.2\n+--- com.google.guava:guava:31.1-jre\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("    +--- com.google.guava:failureaccess:1.0.1\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("    +--- com.google.guava:listenablefuture:9999.0-empty-to-avoid-conflict-with-guava\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("    +--- com.google.code.findbugs:jsr305:3.0.2\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("    +--- org.checkerframework:checker-qual:3.12.0\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("    +--- com.google.errorprone:error_prone_annotations:2.11.0\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("--- com.google.j2objc:j2objc-annotations:1.3\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("--- com.google.code.findbugs:jsr305:3.0.0 -"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3.0")]),a._v(".2\n")])])]),t("p",[a._v("我们可以看到，gradle 选择了 com.google.code.findbugs:jsr305:3.0.2 这个版本。")]),a._v(" "),t("h4",{attrs:{id:"强制使用某个版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#强制使用某个版本"}},[a._v("#")]),a._v(" 强制使用某个版本")]),a._v(" "),t("p",[a._v("如果我们想使用 com.google.code.findbugs:jsr305:3.0.0 版本")]),a._v(" "),t("div",{staticClass:"language-groovy extra-class"},[t("pre",{pre:!0,attrs:{class:"language-groovy"}},[t("code",[a._v("dependencies "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    implementation "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'com.google.guava:guava:31.1-jre'")]),a._v("\n    implementation "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'com.google.code.findbugs:jsr305:3.0.0'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        force "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    testImplementation "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'org.junit.jupiter:junit-jupiter-api:5.8.1'")]),a._v("\n    testRuntimeOnly "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'org.junit.jupiter:junit-jupiter-engine:5.8.1'")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("./gradlew "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-q")]),a._v(" dependency-management:dependencyInsight "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dependency")]),a._v(" jsr305 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--configuration")]),a._v(" compileClasspath\n")])])]),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("com.google.code.findbugs:jsr305:3.0.0 (forced)\n  Variant compile:\n    | Attribute Name                 | Provided | Requested    |\n    |--------------------------------|----------|--------------|\n    | org.gradle.status              | release  |              |\n    | org.gradle.category            | library  | library      |\n    | org.gradle.libraryelements     | jar      | classes      |\n    | org.gradle.usage               | java-api | java-api     |\n    | org.gradle.dependency.bundling |          | external     |\n    | org.gradle.jvm.environment     |          | standard-jvm |\n    | org.gradle.jvm.version         |          | 17           |\n\ncom.google.code.findbugs:jsr305:3.0.0\n\\--- compileClasspath\n\ncom.google.code.findbugs:jsr305:3.0.2 -> 3.0.0\n\\--- com.google.guava:guava:31.1-jre\n     \\--- compileClasspath\n")])])]),t("h4",{attrs:{id:"禁用依赖传递"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#禁用依赖传递"}},[a._v("#")]),a._v(" 禁用依赖传递")]),a._v(" "),t("p",[a._v("guava 不会传递依赖它依赖的库到当前库，可以看到")]),a._v(" "),t("div",{staticClass:"language-groovy extra-class"},[t("pre",{pre:!0,attrs:{class:"language-groovy"}},[t("code",[a._v("dependencies "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" \n    implementation "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'com.google.guava:guava:31.1-jre'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        transitive "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    implementation "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'com.google.code.findbugs:jsr305:3.0.0'")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("./gradlew dependency-management:dependencies "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--configuration")]),a._v(" compileClasspath\n\n------------------------------------------------------------\nProject "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("':dependency-management'")]),a._v("\n------------------------------------------------------------\n\ncompileClasspath - Compile classpath "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("source")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("set")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'main'")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v("\n+--- org.springframework.boot:spring-boot-dependencies:3.0.2\n+--- com.google.guava:guava:31.1-jre\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("--- com.google.code.findbugs:jsr305:3.0.0\n")])])]),t("p",[a._v("可以看到 guava 依赖的 jar 没有传递到当前项目中来。")]),a._v(" "),t("h4",{attrs:{id:"排除某个依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#排除某个依赖"}},[a._v("#")]),a._v(" 排除某个依赖")]),a._v(" "),t("p",[a._v("Guava 依赖的别的 jar 可以传递进来，而且排除了 "),t("code",[a._v("findbugs")]),a._v(", 项目依赖的版本为 "),t("code",[a._v("3.0.0")]),a._v("。")]),a._v(" "),t("div",{staticClass:"language-groovy extra-class"},[t("pre",{pre:!0,attrs:{class:"language-groovy"}},[t("code",[a._v("dependencies "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" \n\t implementation "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'com.google.guava:guava:31.1-jre'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        exclude group"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'com.google.code.findbugs'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'jsr305'")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    implementation "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'com.google.code.findbugs:jsr305:3.0.0'")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("./gradlew dependency-management:dependencies "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--configuration")]),a._v(" compileClasspath\n\n------------------------------------------------------------\nProject "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("':dependency-management'")]),a._v("\n------------------------------------------------------------\n\ncompileClasspath - Compile classpath "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("source")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("set")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'main'")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v("\n+--- org.springframework.boot:spring-boot-dependencies:3.0.2\n+--- com.google.guava:guava:31.1-jre\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("    +--- com.google.guava:failureaccess:1.0.1\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("    +--- com.google.guava:listenablefuture:9999.0-empty-to-avoid-conflict-with-guava\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("    +--- org.checkerframework:checker-qual:3.12.0\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("    +--- com.google.errorprone:error_prone_annotations:2.11.0\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("--- com.google.j2objc:j2objc-annotations:1.3\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("--- com.google.code.findbugs:jsr305:3.0.0\n")])])]),t("p",[a._v("可以看到 guava 传递到当前项目的依赖少了 "),t("code",[a._v("findbugs")]),a._v(" 。")]),a._v(" "),t("h3",{attrs:{id:"配置依赖之间继承"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置依赖之间继承"}},[a._v("#")]),a._v(" 配置依赖之间继承")]),a._v(" "),t("div",{staticClass:"language-txt extra-class"},[t("pre",{pre:!0,attrs:{class:"language-txt"}},[t("code",[a._v("configurations {\n    integrationTestImplementation.extendsFrom testImplementation\n    integrationTestRuntimeOnly.extendsFrom testRuntimeOnly\n}\n\nconfigurations.all {\n    resolutionStrategy {\n        force 'org.apache.tomcat.embed:tomcat-embed-core:9.0.43'\n    }\n    exclude group: 'org.slf4j', module: 'slf4j-simple'\n}\n")])])]),t("h3",{attrs:{id:"api-和-implementation-区别"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#api-和-implementation-区别"}},[a._v("#")]),a._v(" api 和 implementation 区别")]),a._v(" "),t("p",[a._v("jar b 包含以下依赖")]),a._v(" "),t("div",{staticClass:"language-groovy extra-class"},[t("pre",{pre:!0,attrs:{class:"language-groovy"}},[t("code",[a._v("dependencies "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    api "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'org.apache.commons:commons-lang3:3.12.0'")]),a._v("\n    implementation "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'com.google.guava:guava:31.1-jre'")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[a._v("项目 a 引入 jar b ，commons-lang3 和 guava 都可以被工程 a 使用，只是二者 scope 不一样。")]),a._v(" "),t("p",[a._v("api 对应 compile，在 "),t("code",[a._v("工程 a")]),a._v(" 可以直接使用，编译可以通过。")]),a._v(" "),t("p",[a._v("implementation 对应 runtime，编译找不到 guava 中的类。")]),a._v(" "),t("h2",{attrs:{id:"task"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#task"}},[a._v("#")]),a._v(" Task")]),a._v(" "),t("p",[a._v("我们引用的插件实际是添加 task 到 task graph 中去。")]),a._v(" "),t("p",[a._v("我们知道 build.gradle 实际是用来配置对应项目的 org.gradle.api.Project。")]),a._v(" "),t("p",[a._v("因此我们可以在 build.gradle 中引用 org.gradle.api.Project 暴露的属性。")]),a._v(" "),t("p",[a._v("我们可以在 "),t("a",{attrs:{href:"https://docs.gradle.org/7.6/dsl/org.gradle.api.Project.html#N14F33",target:"_blank",rel:"noopener noreferrer"}},[a._v("gradle dsl"),t("OutboundLink")],1),a._v(" 和 Project 接口中可以知道可以访问哪些属性。")]),a._v(" "),t("p",[a._v("tasks 实际就是 Project 暴露的一个属性，因此我们可以使用 tasks 往当前项目中注册 task。")]),a._v(" "),t("div",{staticClass:"language-groovy extra-class"},[t("pre",{pre:!0,attrs:{class:"language-groovy"}},[t("code",[a._v("tasks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("register")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'hello'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    doLast "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        println "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'hello'")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[a._v("推荐使用 tasks.register 去注册 task，而不是 tasks.create 去直接创建。")]),a._v(" "),t("p",[a._v("tasks.register 注册的 task 只会在用到的时候才会初始化。")]),a._v(" "),t("h3",{attrs:{id:"groovy-闭包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#groovy-闭包"}},[a._v("#")]),a._v(" Groovy 闭包")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://groovy-lang.org/closures.html#_syntax",target:"_blank",rel:"noopener noreferrer"}},[a._v("Groovy Closures"),t("OutboundLink")],1)]),a._v(" "),t("div",{staticClass:"language-groovy extra-class"},[t("pre",{pre:!0,attrs:{class:"language-groovy"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("closureParameters "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("->")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" statements "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[a._v("闭包的示例")]),a._v(" "),t("div",{staticClass:"language-groovy extra-class"},[t("pre",{pre:!0,attrs:{class:"language-groovy"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" item"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("++")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("                                          \n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("->")]),a._v(" item"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("++")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("                                       \n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" println it "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("                                      \n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" it "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("->")]),a._v(" println it "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("                                \n")])])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),t("p",[a._v("当方法的最后一个参数是闭包时，可以将闭包放在方法调用之后。")])]),a._v(" "),t("p",[a._v("比如注册一个 task 的接口是")]),a._v(" "),t("div",{staticClass:"language-groovy extra-class"},[t("pre",{pre:!0,attrs:{class:"language-groovy"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("register")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("String var1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" Action"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("?")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("super")]),a._v(" Task"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" var2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\ntasks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("register")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token interpolation-string"}},[t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"task55"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    doFirst "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        println "),t("span",{pre:!0,attrs:{class:"token interpolation-string"}},[t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"task55"')])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\ntasks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("register")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token interpolation-string"}},[t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"task66"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    doFirst "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        println "),t("span",{pre:!0,attrs:{class:"token interpolation-string"}},[t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"task66"')])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),t("h4",{attrs:{id:"task-type"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#task-type"}},[a._v("#")]),a._v(" Task Type")]),a._v(" "),t("p",[a._v("gradle 已经定义好一些 task type，我们可以使用这些 task type 帮助我们完成特定的事情。比如我们想要执行某个 shell 命令。")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://docs.gradle.org/7.6/dsl/org.gradle.api.tasks.Exec.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("Exec - Gradle DSL Version 7.6"),t("OutboundLink")],1)]),a._v(" "),t("div",{staticClass:"language-groovy extra-class"},[t("pre",{pre:!0,attrs:{class:"language-groovy"}},[t("code",[a._v("tasks"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("register")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token interpolation-string"}},[t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"task3"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" Exec"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    workingDir "),t("span",{pre:!0,attrs:{class:"token interpolation-string"}},[t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"')]),t("span",{pre:!0,attrs:{class:"token interpolation"}},[t("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[a._v("$")]),t("span",{pre:!0,attrs:{class:"token expression"}},[a._v("rootDir")])]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"')])]),a._v("\n    commandLine "),t("span",{pre:!0,attrs:{class:"token interpolation-string"}},[t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"ls"')])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("h3",{attrs:{id:"task-outcomes"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#task-outcomes"}},[a._v("#")]),a._v(" Task outcomes")]),a._v(" "),t("p",[a._v("gralde 具有 build cache，意思就是有个 task 可能在构建的过程中不需要执行，应用以前的构建结果。比如我们的 java 代码没有变化，但是你还是去编译 class 文件，gralde 就会使用 build cache，从task 执行的输出可以看到，有很多的 task 都是没有执行的，应用以前的构建。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("> Task :application:compileJava UP-TO-DATE\n> Task :application:processResources UP-TO-DATE\n> Task :application:classes UP-TO-DATE\n")])])]),t("ul",[t("li",[a._v("EXECUTED，代表 task 执行它的构建逻辑。")]),a._v(" "),t("li",[a._v("UP-TO-DATE，代表 task 输入输出没有改变，构建逻辑没有执行，或者没有构建逻辑，或者走了build cache。")]),a._v(" "),t("li",[a._v("FROM-CACHE，task 的输出可以从 buildcache 找到，也代表不需要执行构建逻辑。")]),a._v(" "),t("li",[a._v("SKIPPED task 不会执行构建逻辑，可能执行 task 的时候被指定排除了，或者构建逻辑的 onlyIf 导致，task 没有被触发。")]),a._v(" "),t("li",[a._v("NO-SOURCE，代表 task 依赖的文件或者目录不存在，不需要执行 task。比如编译 java 文件，结果目录下没有 java 文件。")])]),a._v(" "),t("h3",{attrs:{id:"调试-task-的执行顺序"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#调试-task-的执行顺序"}},[a._v("#")]),a._v(" 调试 task 的执行顺序")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("./gradlew application:check --dry-run\n")])])]),t("h2",{attrs:{id:"plugin"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#plugin"}},[a._v("#")]),a._v(" Plugin")]),a._v(" "),t("h3",{attrs:{id:"插件分类"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#插件分类"}},[a._v("#")]),a._v(" 插件分类")]),a._v(" "),t("p",[a._v("Gradle 有两种类型的插件 "),t("code",[a._v("binary plugins")]),a._v(" and "),t("code",[a._v("script plugins")])]),a._v(" "),t("p",[a._v("二进制插件就是封装好的构建逻辑打成 jar 发布到线上，供别的项目使用。")]),a._v(" "),t("p",[a._v("脚本插件就是一个 "),t("code",[a._v("*.gradle")]),a._v(" 文件。")]),a._v(" "),t("h3",{attrs:{id:"buildsrc"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#buildsrc"}},[a._v("#")]),a._v(" buildSrc")]),a._v(" "),t("p",[a._v("一般我们的项目是多项目构建，各个子项目会共享一些配置，比如 java 版本，repository 还有 jar publish 到哪里等等。")]),a._v(" "),t("p",[a._v("我们可以将这些统一配置分组抽象为单独的插件，子项目引用这个插件即可。便于维护，不用在各个子项目都重复配置相同的东西。")]),a._v(" "),t("p",[a._v("buildSrc 这个目录必须在根目录下，它会被 gradle 自动识别为一个 "),t("a",{attrs:{href:"https://docs.gradle.org/current/userguide/composite_builds.html#defining_composite_builds",target:"_blank",rel:"noopener noreferrer"}},[a._v("composite build"),t("OutboundLink")],1),a._v("，并将其编译之后放到项目构建脚本的 classpath 下。")]),a._v(" "),t("p",[a._v("buildSrc 也可以写插件，我们可以直接在子项目中使用插件 id 引入。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("buildSrc/\n├── build.gradle\n├── settings.gradle\n└── src\n    ├── main\n    │   ├── groovy\n    │   │   └── mflyyou.hello2.gradle\n    │   ├── java\n    │   │   └── com\n    │   │       └── mflyyou\n    │   │           └── plugin\n    │   │               ├── BinaryRepositoryExtension.java\n    │   │               ├── BinaryRepositoryVersionPlugin.java\n    │   │               └── LatestArtifactVersion.java\n")])])]),t("p",[a._v("buildSrc/build.gradle")]),a._v(" "),t("p",[t("code",[a._v("groovy-gradle-plugin")]),a._v(" 对应的是使用 groovy 写插件。")]),a._v(" "),t("p",[t("code",[a._v("java-gradle-plugin")]),a._v(" 对应 java 写插件。")]),a._v(" "),t("div",{staticClass:"language-groovy extra-class"},[t("pre",{pre:!0,attrs:{class:"language-groovy"}},[t("code",[a._v("plugins "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    id "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'groovy-gradle-plugin'")]),a._v("\n    id "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'java-gradle-plugin'")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\ngradlePlugin "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    plugins "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        helloPlugin "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            id "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'com.mflyyou.hello'")]),a._v("\n            implementationClass "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'com.mflyyou.plugin.BinaryRepositoryVersionPlugin'")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[a._v("我们就可以在子项目使用插件")]),a._v(" "),t("div",{staticClass:"language-groovy extra-class"},[t("pre",{pre:!0,attrs:{class:"language-groovy"}},[t("code",[a._v("plugins "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    id "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'com.mflyyou.hello'")]),a._v("\n    id "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'mflyyou.hello2'")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("h3",{attrs:{id:"插件使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#插件使用"}},[a._v("#")]),a._v(" 插件使用")]),a._v(" "),t("ul",[t("li",[a._v("Applying plugins with the plugins DSL")])]),a._v(" "),t("div",{staticClass:"language-groovy extra-class"},[t("pre",{pre:!0,attrs:{class:"language-groovy"}},[t("code",[a._v("plugins "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    id "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'java'")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("ul",[t("li",[a._v("Applying a plugin with the buildscript block")])]),a._v(" "),t("div",{staticClass:"language-groovy extra-class"},[t("pre",{pre:!0,attrs:{class:"language-groovy"}},[t("code",[a._v("buildscript "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    repositories "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("gradlePluginPortal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    dependencies "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        classpath "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'com.jfrog.bintray.gradle:gradle-bintray-plugin:1.8.5'")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\napply plugin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'com.jfrog.bintray'")]),a._v("\n")])])]),t("ul",[t("li",[a._v("Applying a script plugin")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("apply from: "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'other.gradle'")]),a._v("\n")])])]),t("h3",{attrs:{id:"debugging-build-logic"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#debugging-build-logic"}},[a._v("#")]),a._v(" Debugging build logic")]),a._v(" "),t("p",[t("img",{attrs:{src:s(296),alt:"remote-debug-gradle"}})]),a._v(" "),t("ul",[t("li",[t("p",[a._v("在 idea 中配置 remote jvm debug")])]),a._v(" "),t("li",[t("p",[a._v("用 debug 模式，运行 gradle 命令。下面命令会等待 debug attach jvm，才会继续执行。")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("./gradlew "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("help")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Dorg.gradle.debug")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true --no-daemon\n")])])])]),a._v(" "),t("li",[t("p",[a._v("然后运行 idea remote debug")])])]),a._v(" "),t("h3",{attrs:{id:"build-script-classpath-和-application-source-code-classpath"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#build-script-classpath-和-application-source-code-classpath"}},[a._v("#")]),a._v(" Build script classpath 和 application source code classpath")]),a._v(" "),t("p",[a._v("我们的构建脚本也是代码，build.gradle 是 groovy 代码，他们也需要编译然后运行构建逻辑去帮助我们编译我们的业务代码和运行等等。")]),a._v(" "),t("p",[a._v("因此 build script 也是有他们自己的 classpath 并且他们和我们的 source code 的 classpath 是分开的。")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看我们构建脚本的 classpath 有哪些 jar")]),a._v("\n./gradlew buildEnvironment\n\n+--- org.apache.commons:commons-lang3:3.12.0\n+--- com.avast.gradle.docker-compose:com.avast.gradle.docker-compose.gradle.plugin:0.16.11\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("--- com.avast.gradle:gradle-docker-compose-plugin:0.16.11\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v("         "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("--- org.yaml:snakeyaml:1.33\n+--- org.springframework.boot:org.springframework.boot.gradle.plugin:3.0.2\n")])])]),t("p",[a._v("因此我们写 binary plugin 的时候尽量避免去要第三方的工具包，如果出现了依赖冲突，很不好解决。要不然你不用冲突的插件，要不然你重写代码。")]),a._v(" "),t("div",{staticClass:"language-groovy extra-class"},[t("pre",{pre:!0,attrs:{class:"language-groovy"}},[t("code",[a._v("buildscript "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    repositories "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("mavenCentral")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    dependencies "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        classpath group"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'commons-codec'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'commons-codec'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" version"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'1.2'")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[a._v("buildscript 代码块就是定义我们自己的构建脚本需要哪些依赖，他们只是被添加到 classpath，如果你应用某个插件，还需要 apply plugin。")]),a._v(" "),t("p",[a._v("plugins dsl ，也有个属性是 apply。当 apply 为 false 的时候，插件只是被引入到构建脚本的 classpath 下，但是插件中的 task 是不是应用当构建逻辑中去。")]),a._v(" "),t("div",{staticClass:"language-groovy extra-class"},[t("pre",{pre:!0,attrs:{class:"language-groovy"}},[t("code",[a._v("plugins "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    id «plugin id»                                            \n    id «plugin id» version «plugin version» "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("apply «"),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("»"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("   \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("h2",{attrs:{id:"gradle-cache"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#gradle-cache"}},[a._v("#")]),a._v(" Gradle Cache")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://docs.gradle.org/8.2/userguide/directory_layout.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("The Directories and Files Gradle Uses"),t("OutboundLink")],1)]),a._v(" "),t("p",[a._v("禁止 gradle 删除 cache "),t("code",[a._v("gradleUserHome/init.d/cache-settings.gradle")])]),a._v(" "),t("div",{staticClass:"language-groovy extra-class"},[t("pre",{pre:!0,attrs:{class:"language-groovy"}},[t("code",[a._v("beforeSettings "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" settings "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("->")]),a._v("\n    settings"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("caches "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        cleanup "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" Cleanup"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("DISABLED\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);