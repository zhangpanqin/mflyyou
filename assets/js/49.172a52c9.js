(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{400:function(s,t,a){"use strict";a.r(t);var e=a(9),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"mysql-limit-限制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql-limit-限制"}},[s._v("#")]),s._v(" Mysql Limit 限制")]),s._v(" "),t("p",[s._v("MySQL使用 limit 分页,  m是偏移量，n是要查询的数量。")]),s._v(" "),t("p",[s._v("当偏移量m过大的时候，查询效率会很低。因为MySQL是先查出m+n个数据，然后抛弃掉前m个数据。")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("limit")]),s._v(" m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("n\n")])])]),t("p",[s._v("m+n 次回表操作，优化成 n 次回表操作。")]),s._v(" "),t("h3",{attrs:{id:"优化示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优化示例"}},[s._v("#")]),s._v(" 优化示例")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("SELECT * FROM t ORDER BY key1 LIMIT "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nSELECT * FROM t ORDER BY key1 LIMIT "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[t("code",[s._v("key1")]),s._v(" 加了索引，在 "),t("code",[s._v("Limit 5000,1")]),s._v(" 的时候可能不会使用索引而全表扫描差。")]),s._v(" "),t("p",[s._v("MySQL内部其实是分为 server 层和存储引擎层的：")]),s._v(" "),t("p",[s._v("limit 的处理事放在了 server 层处理，当存储引擎把数据返回之后，server 层在判断这个数据是不是在 limit 中。")]),s._v(" "),t("p",[s._v("因此实际上是查询了 5001 条数据，然后只把 5001 这一条数据返回给客户端了。")]),s._v(" "),t("p",[s._v("但是这 5000 条数据，从普通索引到回表也发生了 5000 次。")]),s._v(" "),t("p",[s._v("为了减少回表次数，可以通过子查询获得 id，这个 id 只查询索引树就可以得到。这个语句就只发生了一次回表。")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" id "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" t "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" key1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LIMIT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" d\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);