(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{354:function(t,s,a){t.exports=a.p+"assets/img/20210329153821.5620761e.png"},355:function(t,s,a){t.exports=a.p+"assets/img/20210329154429-1196746.fd195ad6.png"},356:function(t,s,a){t.exports=a.p+"assets/img/20210329171328.822a366e.png"},445:function(t,s,a){"use strict";a.r(s);var n=a(9),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"了解垃圾回收和常用虚拟机参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#了解垃圾回收和常用虚拟机参数"}},[t._v("#")]),t._v(" 了解垃圾回收和常用虚拟机参数")]),t._v(" "),s("h2",{attrs:{id:"前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),s("h3",{attrs:{id:"本文内容"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#本文内容"}},[t._v("#")]),t._v(" 本文内容")]),t._v(" "),s("ul",[s("li",[t._v("垃圾回收和需要了解的垃圾回收算法")]),t._v(" "),s("li",[t._v("常用的 jvm 参数")])]),t._v(" "),s("h2",{attrs:{id:"垃圾回收"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#垃圾回收"}},[t._v("#")]),t._v(" 垃圾回收")]),t._v(" "),s("p",[t._v("Java 虚拟机提供了一套内存自动管理方案，我们不需要手动去回收内存，降低了编程的难度。")]),t._v(" "),s("p",[t._v("垃圾回收 （Garbage Collection，简称 GC）指的是内存中不在被使用的对象需要被回收掉，释放掉占着的内存。")]),t._v(" "),s("h3",{attrs:{id:"可达性分析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#可达性分析"}},[t._v("#")]),t._v(" 可达性分析")]),t._v(" "),s("p",[t._v("怎么样才能判断一个对象是否可以被回收呢？通过 "),s("code",[t._v("GC Roots")]),t._v(" 的根对象开始，根据引用关系向下搜索（搜索过程走的路径称为 "),s("code",[t._v("引用链")]),t._v("）,如果对象和 "),s("code",[t._v("GC Roots")]),t._v(" 之间没有引用链，那么这个对象就可以视为 “垃圾” ，可以被回收。")]),t._v(" "),s("img",{staticStyle:{zoom:"50%"},attrs:{src:a(354),alt:"可以作为GC Roots的对象"}}),t._v(" "),s("p",[s("strong",[t._v("在 java 中可以看做 GC Roots 的有：")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("静态变量的引用")])]),t._v(" "),s("li",[s("p",[t._v("Java 虚拟机中常驻对象（Class 对象）或者字符串常量池")])]),t._v(" "),s("li",[s("p",[t._v("方法中被调用时使用到的参数、局部变量等")])])]),t._v(" "),s("p",[t._v("方法的调用是通过在虚拟机栈中对栈帧压栈和弹栈完成的。每次函数的调用都有对应的一个栈帧压入到虚拟机栈中，函数调用结束都会有一个对应的栈帧弹出。栈帧中保存了当前函数的局部变量等结果。")]),t._v(" "),s("p",[s("img",{attrs:{src:a(355),alt:"栈帧"}})]),t._v(" "),s("p",[t._v("因此当一个方法调用结束后，局部变量指向的对象如果没有 GC ROOTS 可达就会被回收掉。")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 运行时 jvm 参数 -XX:+PrintGC -Xms150m -Xmx150m")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StackGC")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("gc")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" arr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("gc")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gc 方法内触发 gc"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StackGC")]),t._v(" stackGC "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StackGC")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        stackGC"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("gc")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"StackGC.gc 调用之后触发 gc"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("gc")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("strong",[t._v("程序输出结果如下：")])]),t._v(" "),s("div",{staticClass:"language-txt extra-class"},[s("pre",{pre:!0,attrs:{class:"language-txt"}},[s("code",[t._v("[GC (System.gc())  55870K->52243K(147456K), 0.0021458 secs]\n[Full GC (System.gc())  52243K->52046K(147456K), 0.0065241 secs]\ngc 方法内触发 gc\nStackGC.gc 调用之后触发 gc\n[GC (System.gc())  52824K->52110K(147456K), 0.0014795 secs]\n[Full GC (System.gc())  52110K->757K(147456K), 0.0055150 secs]\n")])])]),s("p",[t._v("::: tips")]),t._v(" "),s("p",[t._v("从 gc 日志可以看到，gc 方法内局部变量 gc 持有数组的引用，当我们手动调用 gc 时，可以看到内存并没有被回收。")]),t._v(" "),s("p",[t._v("当 gc 方法调用结束时，它对应的栈帧弹栈，数组并没有 gc root 可达，所以在 main 方法中手动 gc 可以触发内存回收。")]),t._v(" "),s("p",[t._v(":::")]),t._v(" "),s("p",[s("strong",[t._v("gc root 没有可达时，内存被回收掉例子")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 运行时 jvm 参数 -XX:+PrintGC -Xms150m -Xmx150m")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StackGC")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("gc")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" arr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 只改变了这一处")]),t._v("\n        arr"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("gc")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gc 方法内触发 gc"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StackGC")]),t._v(" stackGC "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StackGC")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        stackGC"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("gc")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"StackGC.gc 调用之后触发 gc"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("gc")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("div",{staticClass:"language-txt extra-class"},[s("pre",{pre:!0,attrs:{class:"language-txt"}},[s("code",[t._v("[GC (System.gc())  55870K->52223K(147456K), 0.0017527 secs]\n[Full GC (System.gc())  52223K->846K(147456K), 0.0059592 secs]\ngc 方法内触发 gc\nStackGC.gc 调用之后触发 gc\n[GC (System.gc())  1625K->910K(147456K), 0.0009974 secs]\n[Full GC (System.gc())  910K->731K(147456K), 0.0024071 secs]\n")])])]),s("p",[t._v("::: tips")]),t._v(" "),s("p",[t._v("从 gc 日志可以看到，gc 方法内手动垃圾回收，内存回收掉了。这是因为字节数组没有 gc root 可达，所以可以回收。")]),t._v(" "),s("p",[t._v(":::")]),t._v(" "),s("h3",{attrs:{id:"垃圾回收算法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#垃圾回收算法"}},[t._v("#")]),t._v(" 垃圾回收算法")]),t._v(" "),s("p",[s("img",{attrs:{src:a(356),alt:"jvm堆空间"}})]),t._v(" "),s("p",[t._v("新生代采用 "),s("code",[t._v("标记-复制算法")]),t._v(" ,new 对象首先分配到 eden 区，当经历一次垃圾回收还存活，对象会从 eden 复制到 s0，然后清空 eden 区，当再经历一次垃圾回收，对象会从 eden 到 s1，s0 存活的对象复制到 s1。")]),t._v(" "),s("p",[t._v("标记-复制算法，会浪费一部分内存，但是它回收效率高速度快，不会产生内存碎片。")]),t._v(" "),s("p",[t._v("老年代通常使用 "),s("code",[t._v("标记-整理算法")]),t._v(" 和 "),s("code",[t._v("标记-清除算法")]),t._v(" （CMS 垃圾收集器老年代采用此算法 ）。")]),t._v(" "),s("p",[t._v("gc 线程进行垃圾回收的时候，用户线程需要暂停执行业务代码，等到 gc 完成之后用户线程才可以执行业务代码。")]),t._v(" "),s("h4",{attrs:{id:"垃圾收集器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#垃圾收集器"}},[t._v("#")]),t._v(" 垃圾收集器")]),t._v(" "),s("p",[t._v("垃圾回收器有很多，通常使用组合是的是：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("1.8 默认是 Parallel Scavenge (年轻代)+Serial Old (老年代) ，-XX:+UseParallelGC 使用此组合")])]),t._v(" "),s("li",[s("p",[t._v("ParNew (年轻代)+CMS(老年代，默认使用 CMS，CMS 失败会使用 Serial Old )，jvm 参数只要添加 -XX:+UseConcMarkSweepGC 就可使用此组合")])]),t._v(" "),s("li",[s("p",[t._v("Parallel Scavenge (年轻代)+Parallel Old (老年代)，-XX:+UseParallelOldGC")])]),t._v(" "),s("li",[s("p",[t._v("G1(年轻代+老年代)，大内存（java 堆 8g 内存以上）基本使用它，1.9 以上默认使用的垃圾回收器，-XX:+UseG1GC")])])]),t._v(" "),s("p",[t._v("cms 和 g1 是为了较少的用户暂停时间。")]),t._v(" "),s("p",[t._v("而 ps + po 是为了追求吞吐量。")]),t._v(" "),s("p",[t._v("吞吐量=用户代码运行时间/(用户代码运行时间+垃圾回收时间)。")]),t._v(" "),s("p",[t._v("停顿时间越短，越适合需要与用户交互或者保证服务响应的程序。")]),t._v(" "),s("p",[t._v("高吞吐量可以更好的利用 cpu 资源，尽可能快的完成运算任务而不需要太多的交互。")]),t._v(" "),s("p",[t._v("垃圾回收的时候会出现 "),s("code",[t._v("Stop The World")]),t._v(" 现象，这样的情况下，用户代码暂停执行。")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// -Xms1g -Xmx1g")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("STWDemo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LocalDateTime")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("now")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArrayList")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" objects "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArrayList")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("980")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            objects"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),t._v(" list "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArrayList")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("size")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("900")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("clear")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("980")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("512")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("如果没有进行垃圾回收的时候，基本上时间打印间隔为 50ms 。但由于 gc 导致 STW 导致程序严重执行受影响。")]),t._v(" "),s("div",{staticClass:"language-txt extra-class"},[s("pre",{pre:!0,attrs:{class:"language-txt"}},[s("code",[t._v("2021-03-29T18:45:01.522\n2021-03-29T18:45:01.581\n2021-03-29T18:45:01.634\n2021-03-29T18:45:01.761\n// 从这里开始执行，gc 影响了程序运行\n2021-03-29T18:45:02.267\n2021-03-29T18:45:02.429\n2021-03-29T18:45:02.775\n")])])]),s("h3",{attrs:{id:"常用的-jvm-参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用的-jvm-参数"}},[t._v("#")]),t._v(" 常用的 JVM 参数")]),t._v(" "),s("p",[t._v("标准： - 开头，所有的 HotSpot 都支持")]),t._v(" "),s("p",[t._v("非标准：-X 开头，特定版本 HotSpot 支持特定命令")]),t._v(" "),s("p",[t._v("不稳定：-XX 开头，下个版本可能取消。")]),t._v(" "),s("p",[t._v("布尔选项配置："),s("code",[t._v("-XX:+OptionName")]),t._v(" 启用布尔选项，使用减号 "),s("code",[t._v("-XX:-OptionName")]),t._v(" 禁用布尔选项。")]),t._v(" "),s("p",[t._v("非布尔配置：-XX:OptionName=value")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# java [-options] class [args...]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("java")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-Dfile.encoding")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("UTF-8 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-Xms1g")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-Xmx1g")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-Xloggc:gc.log")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-XX:+PrintGCDetails")]),t._v(" com.fly.blog.jvm.STWDemo\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# java [-options] -jar jarfile [args...]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("java")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-Dfile.encoding")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("UTF-8 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-Xms1g")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-Xmx1g")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-Xloggc:gc.log")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-XX:+PrintGCDetails")]),t._v(" a.jar\n")])])]),s("p",[t._v("我们通常会调整年轻代，老年代大小，eden s0 s1 大小，打印 gc 日志")]),t._v(" "),s("h4",{attrs:{id:"查看-jvm-参数值"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看-jvm-参数值"}},[t._v("#")]),t._v(" 查看 JVM 参数值")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 打印 JVM 自动优化参数")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("java")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-XX:+PrintCommandLineFlags")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-version")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看初始值")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("java")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-XX:+PrintFlagsInitial")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-version")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看虚拟机使用最终参数，=未修改过，:=人为或JVM修改过")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("java")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-XX:+PrintFlagsFinal")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-version")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 也可以通过 jinfo 查看设置的值。或者动态修改一些参数")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看当前 java 进程，MetaspaceSize 的值")]),t._v("\njinfo "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-flag")]),t._v(" MetaspaceSize pid\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 动态修改布尔类型值")]),t._v("\njinfo "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-flag")]),t._v(" +UseParallelGC pid\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 动态修改数值型")]),t._v("\njinfo "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-flag")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("NewRatio")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" pid\n")])])]),s("h4",{attrs:{id:"选择垃圾回收器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#选择垃圾回收器"}},[t._v("#")]),t._v(" 选择垃圾回收器")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("参数")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("-XX:+UseParallelGC")]),t._v(" "),s("td",[t._v("1.8 默认是 Parallel Scavenge (年轻代)+Serial Old (老年代)")])]),t._v(" "),s("tr",[s("td",[t._v("-XX:+UseConcMarkSweepGC")]),t._v(" "),s("td",[t._v("ParNew (年轻代)+CMS(老年代，默认使用 CMS，CMS 失败会使用 Serial Old )")])]),t._v(" "),s("tr",[s("td",[t._v("-XX:+UseParallelOldGC")]),t._v(" "),s("td",[t._v("Parallel Scavenge (年轻代)+Parallel Old (老年代)")])]),t._v(" "),s("tr",[s("td",[t._v("-XX:+UseG1GC")]),t._v(" "),s("td",[t._v("G1(年轻代+老年代)，大内存（java 堆 8g 内存以上）基本使用它，1.9 以上的默认垃圾回收器")])])])]),t._v(" "),s("h4",{attrs:{id:"通用-jvm-参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#通用-jvm-参数"}},[t._v("#")]),t._v(" 通用 JVM 参数")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("参数")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("-Xms")]),t._v(" "),s("td",[t._v("设置堆的初始大小，通常和-Xmx 一样大，减少堆扩容带来的损耗，-Xms1g 或者 -Xms100m 或者 -Xms100k")])]),t._v(" "),s("tr",[s("td",[t._v("-Xmx")]),t._v(" "),s("td",[t._v("设置堆的最终大小。-Xmx1g 或者 -Xmx100m 或者 -Xmx100k")])]),t._v(" "),s("tr",[s("td",[t._v("-Xss")]),t._v(" "),s("td",[t._v("虚拟机栈的大小，。线程数乘于-Xss 指定的大小，为线程占用的栈内存大小")])]),t._v(" "),s("tr",[s("td",[t._v("-Xmn")]),t._v(" "),s("td",[t._v("调整堆中年轻代的大小")])]),t._v(" "),s("tr",[s("td",[t._v("-XX:NewRatio")]),t._v(" "),s("td",[t._v("-XX:NewRatio=4")])]),t._v(" "),s("tr",[s("td",[t._v("-XX:SurvivorRatio")]),t._v(" "),s("td",[t._v("默认 -XX:SurvivorRatio=8，设置 eden 与 s0 的比值。当为 8 的时候，eden 占年轻代 8/10 ,s0 s1 各占 1/10")])]),t._v(" "),s("tr",[s("td",[t._v("-XX:MetaspaceSize")]),t._v(" "),s("td",[t._v("-XX:MetaspaceSize=64m 设置元空间初始大小")])]),t._v(" "),s("tr",[s("td",[t._v("-XX:MaxMetaspaceSize")]),t._v(" "),s("td",[t._v("-XX:MaxMetaspaceSize=128m 设置元空间最大大小")])]),t._v(" "),s("tr",[s("td",[t._v("-XX:MaxDirectMemorySize")]),t._v(" "),s("td",[t._v("设置 nio 使用的直接内存（堆外）最大大小。")])]),t._v(" "),s("tr",[s("td",[t._v("-XX:MaxTenuringThreshold")]),t._v(" "),s("td",[t._v("-XX:MaxTenuringThreshold=15，新生代的对象经历了多少次垃圾回收之后放入到老年代 （对象对象头中记录分代年龄）,取值范围 0-15")])]),t._v(" "),s("tr",[s("td",[t._v("-XX:PretenureSizeThreshold")]),t._v(" "),s("td",[t._v("-XX:PretenureSizeThreshold=5m，对象初始化占用内存大于这个值，直接分配到 老年代")])]),t._v(" "),s("tr",[s("td",[t._v("-XX:+UseTLAB")]),t._v(" "),s("td",[t._v("默认启用 TLAB")])]),t._v(" "),s("tr",[s("td",[t._v("-XX:+PrintTLAB")]),t._v(" "),s("td",[t._v("打印 TLAB 使用的情况")])]),t._v(" "),s("tr",[s("td",[t._v("-XX:+HeapDumpOnOutOfMemoryError")]),t._v(" "),s("td",[t._v("默认关闭的，当 oom dump 当前内存。")])]),t._v(" "),s("tr",[s("td",[t._v("-XX:HeapDumpPath")]),t._v(" "),s("td",[t._v("-XX:HeapDumpPath=a.hprof，和 -XX:+HeapDumpOnOutOfMemoryError 配合一起使用")])]),t._v(" "),s("tr",[s("td",[t._v("-XX:+PrintGCDateStamps")]),t._v(" "),s("td",[t._v("打印每次 gc 的时间")])]),t._v(" "),s("tr",[s("td",[t._v("-XX:+PrintGCTimeStamps")]),t._v(" "),s("td",[t._v("每次 gc 的时间戳（距离 jvm 启动之后的时间戳）")])]),t._v(" "),s("tr",[s("td",[t._v("-XX:+PrintHeapAtGC")]),t._v(" "),s("td",[t._v("打印 gc 之后的堆信息")])]),t._v(" "),s("tr",[s("td",[t._v("-XX:+PrintGCApplicationStoppedTime")]),t._v(" "),s("td",[t._v("打印 gc stw 的时间")])]),t._v(" "),s("tr",[s("td",[t._v("-Xloggc")]),t._v(" "),s("td",[t._v("-Xloggc:gc.log，相对路径的话路径相对于 user.dir")])])])]),t._v(" "),s("h4",{attrs:{id:"g1-常用参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#g1-常用参数"}},[t._v("#")]),t._v(" G1 常用参数")]),t._v(" "),s("ul",[s("li",[t._v("-XX:+UseG1GC")])]),t._v(" "),s("p",[t._v("使用 G1 垃圾收集器")]),t._v(" "),s("ul",[s("li",[t._v("-XX:MaxGCPauseMillis=200")])]),t._v(" "),s("p",[t._v("设置期望达到的最大 GC 停顿时间指标，JVM 会尽力实现，但不保证达到")]),t._v(" "),s("ul",[s("li",[t._v("-XX:GCPauseIntervalMillis")])]),t._v(" "),s("p",[t._v("设置 gc 停顿间隔时间")])])}),[],!1,null,null,null);s.default=e.exports}}]);