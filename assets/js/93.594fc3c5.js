(window.webpackJsonp=window.webpackJsonp||[]).push([[93],{457:function(t,a,s){"use strict";s.r(a);var e=s(9),v=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"http-cache-有什么好处"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http-cache-有什么好处"}},[t._v("#")]),t._v(" Http Cache 有什么好处？")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("减轻服务器压力，节省带宽和流量")])]),t._v(" "),a("li",[a("p",[t._v("浏览器能提高首屏渲染的速度，提升用户体验。")])])]),t._v(" "),a("h3",{attrs:{id:"浏览器缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#浏览器缓存"}},[t._v("#")]),t._v(" 浏览器缓存")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("memory cache")]),t._v(":它是将资源文件缓存到内存中，缓存有效直接从内存加载。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("disk cache")]),t._v(": 它是将资源文件缓存到硬盘中，缓存有效直接从硬盘中加载。")])])]),t._v(" "),a("p",[t._v("先从 "),a("code",[t._v("memory cache")]),t._v(" 找，找不到从 "),a("code",[t._v("disk cache")]),t._v(" 找，再找不到，请求网络资源。")]),t._v(" "),a("h2",{attrs:{id:"缓存分类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缓存分类"}},[t._v("#")]),t._v(" 缓存分类")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("协商缓存")])]),t._v(" "),a("li",[a("code",[t._v("强缓存")])])]),t._v(" "),a("p",[a("code",[t._v("协商缓存")]),t._v(" 每次都要去服务器询问缓存是否过期，没有过期使用本地的缓存。")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("协商缓存每次会发送请求去服务器校验缓存，但是当缓存没有过期，服务端只返回响应头（304），而没有响应体的。")]),t._v(" "),a("p",[t._v("缓存过期了，会返回 200，也就是正常响应。")])]),t._v(" "),a("p",[a("code",[t._v("强缓存")]),t._v(" 会有缓存过期时间，在有效期内不会去服务端校验缓存，直接使用本地缓存。")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("强缓存也就是浏览器不会发送 http 请求，去请求资源。")])]),t._v(" "),a("p",[a("code",[t._v("webpack")]),t._v(" 可以根据文件内容的 "),a("code",[t._v("hash")]),t._v(" 生产类似 "),a("code",[t._v("app.asdfa21342.js")]),t._v(" 这样的文件。")]),t._v(" "),a("p",[t._v("其实就是想使用强缓存，当网站更新，新的页面会解析加载不一样的资源，从而降低缓存校验对服务器性能的损耗。")]),t._v(" "),a("h3",{attrs:{id:"协商缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#协商缓存"}},[t._v("#")]),t._v(" 协商缓存")]),t._v(" "),a("p",[t._v("协商缓存有以下两种分类：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("ETag/if-None-Match")])]),t._v(" "),a("li",[a("code",[t._v("Last-Modified/if-Modify-Since")])])]),t._v(" "),a("p",[t._v("http 协议规定，当这两种响应头都存在的时候，必须都要满足，才能使用缓存。")]),t._v(" "),a("p",[t._v("浏览器第一次访问一个资源的时候，响应头 "),a("code",[t._v("Last-Modified")]),t._v(" 返回，标识文件的最后修改时间。")]),t._v(" "),a("p",[t._v("当浏览器再次正常访问（不强制刷新资源）相同资源，请求头会加上 "),a("code",[t._v("If-Modified-Since")]),t._v("，该值为之前资源响应返回的 "),a("code",[t._v("Last-Modified")]),t._v(" ；服务端将请求头 "),a("code",[t._v("If-Modified-Since")]),t._v(" 和资源的最后修改时间("),a("code",[t._v("Last-Modified")]),t._v(")进行比较，值相同则命中缓存，返回 304，否则返回资源，状态码为 200，并更新缓存时间。")]),t._v(" "),a("p",[a("code",[t._v("ETag")]),t._v(" 为缓存的 hash 值（服务端返回），请求的时候 "),a("code",[t._v("if-None-Match")]),t._v(" 的值是它，然后服务端比较有没有变化，没变化，返回 304，变化了就返回 200。")]),t._v(" "),a("h3",{attrs:{id:"强制缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#强制缓存"}},[t._v("#")]),t._v(" 强制缓存")]),t._v(" "),a("h4",{attrs:{id:"expires"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#expires"}},[t._v("#")]),t._v(" Expires")]),t._v(" "),a("p",[a("code",[t._v("Expires")]),t._v(" 是 "),a("code",[t._v("http1.0")]),t._v(" 的规范，它的值是一个绝对时间的 GMT 格式的时间字符串。这个时间代表的该资源的失效时间，如果在该时间之前请求的话，则都是从缓存里面读取的。如果服务端和客户端时区不一致会导致判断不准确。")]),t._v(" "),a("h4",{attrs:{id:"cache-control-推荐"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cache-control-推荐"}},[t._v("#")]),t._v(" Cache-Control（推荐）")]),t._v(" "),a("p",[a("code",[t._v("Cache-Control")]),t._v(" 是 "),a("code",[t._v("http1.1")]),t._v(" 的规范，它是利用该字段 "),a("code",[t._v("max-age")]),t._v(" 值进行判断的。该值是一个相对时间，比如 "),a("code",[t._v("Cache-Control: max-age=3600")]),t._v(" 代表该资源的有效期是 3600 秒。除了该字段外，我们还有如下字段可以设置：")]),t._v(" "),a("p",[a("strong",[t._v("no-cache:")]),t._v(" 需要进行协商缓存，发送请求到服务器确认是否使用缓存。")]),t._v(" "),a("p",[t._v("**no-store：**禁止使用缓存，每一次都要重新请求数据。")]),t._v(" "),a("p",[t._v("**public：**可以被所有的用户缓存，包括终端用户和 CDN 等中间代理服务器。")]),t._v(" "),a("p",[t._v("**private：**只能被终端用户的浏览器缓存，不允许 CDN 等中继缓存服务器对其缓存。")]),t._v(" "),a("h2",{attrs:{id:"推荐实践"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#推荐实践"}},[t._v("#")]),t._v(" 推荐实践")]),t._v(" "),a("p",[t._v("Index.html 可以使用协商缓存，别的静态资源，css,js 等图片可以使用强缓存。现在的工具会给这些路径加上 hash 值。")]),t._v(" "),a("ul",[a("li",[t._v("Html 页面")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Cache-Control")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" max"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("age=0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" private"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" must"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("revalidate\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Etag")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Content-Encoding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" gzip\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Last-Modified")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Vary")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Accept"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Encoding\n")])])]),a("ul",[a("li",[t._v("Css,js,img")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("Cache-Control: public, max-age"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("31536000")]),t._v("\nEtag:\nContent-Encoding: "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("gzip")]),t._v("\nLast-Modified:\nVary: Accept-Encoding\n")])])])])}),[],!1,null,null,null);a.default=v.exports}}]);